{"cells":[{"cell_type":"code","source":"# ==============================================================================\n# Google Colab Notebook for EquiLend ETF Securities Finance Report\n# Author: Bob Sheehan, CFA, CMT\n# Date: July 10, 2025\n#\n# Instructions:\n# 1. Open Google Colab (colab.research.google.com).\n# 2. Create a new notebook.\n# 3. Copy and paste the code from this document into a single cell in the notebook.\n# 4. Run the cell. The charts will be generated and saved as PNG files.\n# ==============================================================================\n\n# --- 1. Setup and Imports ---\n# First, we import the necessary libraries for plotting.\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport pandas as pd\n\nprint(\"Setup complete. Libraries imported.\")\n\n# --- 2. Chart 1: YoY Growth in Unique ETFs Utilized (Orange & Blue) ---\n# This chart visualizes the significant year-over-year growth in the number\n# of unique ETFs being borrowed, using the exact figures from the DataLend UI.\n\nprint(\"\\nGenerating Chart 1: YoY Growth...\")\n\n# Data based on figures from the DataLend UI\nlabels_growth = ['Global', 'North America']\njuly_2023_counts = [3668, 2418]\njune_2025_counts = [5561, 3508]\n\n# Define the color palette\ncolor_blue = '#0072B2'\ncolor_orange = '#D55E00'\n\nx_growth = np.arange(len(labels_growth))\nwidth_growth = 0.35\n\nfig1, ax1 = plt.subplots(figsize=(8, 6))\nrects1 = ax1.bar(x_growth - width_growth/2, july_2023_counts, width_growth, label='July 2023', color=color_blue)\nrects2 = ax1.bar(x_growth + width_growth/2, june_2025_counts, width_growth, label='June 2025', color=color_orange)\n\n# Add labels, title, and formatting\nax1.set_ylabel('Number of Unique ETFs Borrowed')\nax1.set_title('Growth in Unique ETFs Utilized in Securities Lending', pad=20)\nax1.set_xticks(x_growth)\nax1.set_xticklabels(labels_growth)\nax1.legend()\nax1.spines['top'].set_visible(False)\nax1.spines['right'].set_visible(False)\nax1.get_yaxis().set_major_formatter(plt.FuncFormatter(lambda y, p: format(int(y), ',')))\n\n# Function to attach a data label above each bar with the exact, un-rounded number\ndef autolabel(rects, ax):\n    for rect in rects:\n        height = rect.get_height()\n        ax.annotate(f'{format(height, \",\")}',\n                    xy=(rect.get_x() + rect.get_width() / 2, height),\n                    xytext=(0, 3),  # 3 points vertical offset\n                    textcoords=\"offset points\",\n                    ha='center', va='bottom')\n\nautolabel(rects1, ax1)\nautolabel(rects2, ax1)\n\nfig1.tight_layout()\nplt.savefig('YoY_Growth_Chart.png', dpi=300)\nplt.show()\nprint(\"Chart 1 saved as 'YoY_Growth_Chart.png'\")\n\n\n# --- 3. Chart 2: On-Loan Value vs. Utilization (Scatter Plot) ---\n# This is the more analytical chart we designed to show the relationship\n# between the scale of borrowing (On-Loan Value) and the conviction (Utilization).\n\nprint(\"\\nGenerating Chart 2: On-Loan Value vs. Utilization...\")\n\n# Data for the key ETFs from our analysis\netf_data = {\n    'LQD': {'value': 6.0, 'util': 71.6, 'color': color_blue},\n    'IWM': {'value': 3.9, 'util': 79.6, 'color': color_orange},\n    'SPY': {'value': 4.1, 'util': 25.0, 'color': '#585858'}, # Using grey for SPY as a reference point\n    'INDA': {'value': 1.6, 'util': 62.4, 'color': '#785EF0'} # Purple\n}\n\nfig2, ax2 = plt.subplots(figsize=(10, 7))\n\n# Plot each point\nfor ticker, data in etf_data.items():\n    ax2.scatter(data['util'], data['value'], s=250, color=data['color'], alpha=0.7, edgecolors='w', linewidth=1.5, label=ticker)\n    ax2.text(data['util'] + 1, data['value'], ticker, fontsize=12, va='center_baseline', color=data['color'])\n\n# Add formatting and labels\nax2.set_xlabel('Utilization (%)', fontsize=12)\nax2.set_ylabel('On-Loan Value ($ Billions)', fontsize=12)\nax2.set_title('On-Loan Value vs. Utilization for Key ETFs (June 2025)', fontsize=14, pad=20)\nax2.grid(True, which='both', linestyle='--', linewidth=0.5)\nax2.spines['top'].set_visible(False)\nax2.spines['right'].set_visible(False)\nax2.set_xlim(20, 85)\nax2.set_ylim(0, 8)\n\n# Add explanatory quadrant text\nax2.text(84, 7.8, 'High Value / High Utilization\\n(Potential Crowding / Conviction)', ha='right', va='top', fontsize=10, color='grey')\nax2.text(21, 7.8, 'High Value / Low Utilization\\n(Broad Hedging / Positioning)', ha='left', va='top', fontsize=10, color='grey')\n\nfig2.tight_layout()\nplt.savefig('OnLoan_vs_Utilization_Chart.png', dpi=300)\nplt.show()\nprint(\"Chart 2 saved as 'OnLoan_vs_Utilization_Chart.png'\")\n\n\n# --- 4. Chart 3: Key ETF On-Loan Value (Horizontal Bar Chart) ---\n# This is the alternative single-color bar chart for the key ETFs,\n# included here for completeness.\n\nprint(\"\\nGenerating Chart 3: Key ETF On-Loan Value (Bar Chart)...\")\n\n# Data is the same as the scatter plot\ns_data = {\n    'LQD (Investment-Grade)': 6.0,\n    'SPY (S&P 500)': 4.1,\n    'IWM (Russell 2000)': 3.9,\n    'INDA (India)': 1.6\n}\ns = pd.Series(s_data).sort_values(ascending=True)\n\nfig3, ax3 = plt.subplots(figsize=(10, 6))\nbars = ax3.barh(s.index, s.values, color=color_blue)\n\n# Add formatting and labels\nax3.set_xlabel('On-Loan Value (USD Billions)')\nax3.set_title('On-Loan Value for Key ETFs (June 2025)', pad=20)\nax3.grid(False)\nax3.spines['top'].set_visible(False)\nax3.spines['right'].set_visible(False)\nax3.spines['left'].set_visible(False)\nax3.tick_params(axis='y', length=0)\n\n# Add data labels to the end of the bars\nfor bar in bars:\n    width = bar.get_width()\n    ax3.annotate(f'${width:.1f}B',\n                xy=(width, bar.get_y() + bar.get_height() / 2),\n                xytext=(5, 0),\n                textcoords=\"offset points\",\n                ha='left', va='center')\n\nfig3.tight_layout()\nplt.savefig('Key_ETFs_Bar_Chart.png', dpi=300)\nplt.show()\nprint(\"Chart 3 saved as 'Key_ETFs_Bar_Chart.png'\")","outputs":[],"execution_count":null,"metadata":{}}],"metadata":{"colab":{"from_bard":true},"kernelspec":{"display_name":"Python 3","name":"python3"}},"nbformat":4,"nbformat_minor":0}