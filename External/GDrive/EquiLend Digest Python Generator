{"cells":[{"cell_type":"code","source":["import pandas as pd\n","from datetime import datetime\n","\n","# --- Configuration ---\n","# The output file will be named with today's date.\n","# Using a fixed date for this example as requested.\n","today_str = \"August 4, 2025\"\n","OUTPUT_HTML_PATH = f\"equilend_daily_digest_{today_str.replace(', ', '_').replace(' ', '_')}.html\"\n","\n","# --- 1. Hardcoded Content and Data ---\n","\n","def get_hardcoded_content():\n","    \"\"\"\n","    Returns all the text content for the digest.\n","    This section can be updated with the day's specific narrative content.\n","    \"\"\"\n","    content = {\n","        'date': today_str,\n","        'market_notes': {\n","            'avg_fee_bps': '70.73',\n","            'avg_fee_change': 83.1,\n","            'avg_util_percent': '7.12',\n","            'avg_util_change': 2.05,\n","            'on_loan_value': '3.04T',\n","            'on_loan_value_change': 1.62,\n","            'lendable_value': '42.8T',\n","            'lendable_value_change': -0.42\n","        },\n","        'headlines': [\n","            {\n","                'title': 'U.S. Labor Market Shows Signs of Cooling',\n","                'description': \"The latest U.S. nonfarm payrolls report indicated job gains that fell short of expectations, accompanied by notable downward revisions to the previous two months' data. This development suggests moderation in the labor market, which may be an indication of slowing economic momentum. The unemployment rate also ticked higher to 4.2% from 4.1%.\",\n","                'data_insight': 'The cooling labor market data appears to be fueling concerns about future consumer demand for high-end, big-ticket items. Our data shows a notable increase in short interest for EV manufacturer Lucid Group (LCID US), which saw its shares on loan increase by 42 million over the past week.'\n","            },\n","            {\n","                'title': 'U.S. Second Quarter GDP Rebounds, But Underlying Activity is Weaker',\n","                'description': \"The preliminary estimate for U.S. GDP in the second quarter showed a 3% annualized increase, rebounding from a contraction in the first quarter. However, underlying domestic demand, excluding contributions from net trade and inventories, was up a more modest 1.1%, the weakest reading since 2022. This could be signaling a downshift in economic activity despite the headline strength.\",\n","                'data_insight': \"The weaker underlying details in the GDP report may be leading investors to position against economically sensitive growth stocks. Our data shows a significant increase in shares on loan for Plug Power Inc. (PLUG US), with over 30 million shares added on loan last week, suggesting a bet that a slowdown in underlying economic activity will create headwinds for speculative technology companies.\"\n","            },\n","            {\n","                'title': 'Paramount Given Green Light for $8 million Merger',\n","                'description': 'The FCC have approved a significant $8 million merger between Paramount Global and Skydance Media sparking investor interest amid the media upheaval. The newly combined ‘Paramount Skydance Corporation’ will debut on August 7th (trading under the PSKY ticker) with major structural changes planned by Skydance CEO David Ellison. These changes will include new editorial oversight of Paramount-owned CBS who recently had to pay a $16 million lawsuit settlement to President Trump.',\n","                'data_insight': \"Following the merger announcement, hedge fund interest has rocketed in Paramount Global (PARA).\"\n","            }\n","        ],\n","        'key_takeaways': [\n","            \"Negative Guidance from a Sector Leader May Trigger Broader Hedging: The weak outlook from Meta Platforms appears to have possibly created a contagion effect, prompting an increase in short interest in other tech bellwethers. This could suggest that investors are interpreting the news not as an isolated issue for Meta, but as a potential signal of a broader slowdown in enterprise technology spending.\",\n","            \"Macro Labor Data Is Directly Informing Consumer Sector Sentiment: The uptick in weekly jobless claims, a key macroeconomic indicator, correlates with a rise in bearish positioning in consumer discretionary names. This may indicate that market participants are translating signs of a softening labor market directly into expectations for weaker consumer spending.\",\n","            \"Highly Concentrated Shorting Activity Signals Intense Pressure on Speculative Names: Beyond broad market themes, our data reveals pockets of highly concentrated bearish sentiment in more speculative areas of the market. The significant borrow costs suggest a strong conviction in company-specific headwinds independent of the wider market narrative.\"\n","        ]\n","    }\n","    return content\n","\n","def get_hardcoded_tables_html():\n","    \"\"\"\n","    Returns HTML for the two data tables using the hardcoded data.\n","    \"\"\"\n","    # Data for \"Hot & Getting Hotter\"\n","    ht_borrow_data = [\n","        {\"TICKER\": \"ABVE\", \"Company Name\": \"ABOVE FOC\", \"Industry\": \"Food, Beverage\", \"Price\": \"$1.72\", \"Fee 1 Week (bps)\": \"15567.15\"},\n","        {\"TICKER\": \"WBUY\", \"Company Name\": \"WEBUY GL\", \"Industry\": \"Food and Staples\", \"Price\": \"$3.50\", \"Fee 1 Week (bps)\": \"5446.74\"},\n","        {\"TICKER\": \"PAPL\", \"Company Name\": \"PINEAPPLE\", \"Industry\": \"Diversified\", \"Price\": \"$4.31\", \"Fee 1 Week (bps)\": \"12527.37\"},\n","        {\"TICKER\": \"BMGL\", \"Company Name\": \"BASEL MED\", \"Industry\": \"Health Care\", \"Price\": \"$2.02\", \"Fee 1 Week (bps)\": \"4660.43\"},\n","        {\"TICKER\": \"BGL\", \"Company Name\": \"BLUE GOLD\", \"Industry\": \"Metals and Mining\", \"Price\": \"$12.35\", \"Fee 1 Week (bps)\": \"2894.82\"},\n","    ]\n","\n","    # Data for \"Market Technicals & Squeeze Metrics\"\n","    squeeze_data = [\n","        {\"TICKER\": \"WOLF\", \"Company Name\": \"WOLFSPEED\", \"Industry\": \"Semiconductors\", \"Price\": \"$1.52\", \"SSS\": 86, \"SSS WoW\": \"1\"},\n","        {\"TICKER\": \"CELC\", \"Company Name\": \"CELCUITY INC\", \"Industry\": \"Biotechnology\", \"Price\": \"$39.91\", \"SSS\": 81, \"SSS WoW\": \"55\"},\n","        {\"TICKER\": \"PHLT\", \"Company Name\": \"PERFORMA Health Care\", \"Industry\": \"Health Care\", \"Price\": \"$7.64\", \"SSS\": 70, \"SSS WoW\": \"62\"},\n","        {\"TICKER\": \"ZIMV\", \"Company Name\": \"ZIMVIE INC\", \"Industry\": \"Health Care\", \"Price\": \"$18.76\", \"SSS\": 70, \"SSS WoW\": \"-4\"},\n","        {\"TICKER\": \"STEM\", \"Company Name\": \"STEM INC\", \"Industry\": \"Capital Goods\", \"Price\": \"$12.23\", \"SSS\": 69, \"SSS WoW\": \"-1\"},\n","    ]\n","\n","    def format_change(value, unit=' BPS'):\n","        try:\n","            cleaned_value = str(value).replace(',', '').strip()\n","            val = float(cleaned_value)\n","            color = '#16a34a' if val > 0 else '#dc2626'\n","            sign = '+' if val > 0 else ''\n","            # Format without decimals for WoW change, with for BPS\n","            if unit == \"\":\n","                 return f'<span style=\"color:{color}; font-size:14px;\">{sign}{int(val)}{unit}</span>'\n","            else:\n","                 return f'<span style=\"color:{color}; font-size:14px;\">{sign}{val:,.2f}{unit}</span>'\n","        except (ValueError, TypeError):\n","            return str(value).strip() if pd.notna(value) else ''\n","\n","    ht_borrow_html = \"\"\n","    for row in ht_borrow_data:\n","        ht_borrow_html += f\"\"\"\n","        <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","            <td style=\"padding:4px 8px;\">{row.get(\"TICKER\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Company Name\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Industry\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Price\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{format_change(row.get(\"Fee 1 Week (bps)\"))}</td>\n","        </tr>\"\"\"\n","\n","    squeeze_html = \"\"\n","    for row in squeeze_data:\n","        squeeze_html += f\"\"\"\n","        <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","            <td style=\"padding:4px 8px;\">{row.get(\"TICKER\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Company Name\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Industry\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Price\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"SSS\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{format_change(row.get(\"SSS WoW\"), unit=\"\")}</td>\n","        </tr>\"\"\"\n","\n","    return ht_borrow_html, squeeze_html\n","\n","\n","# --- 2. HTML Generation ---\n","\n","def create_digest_html(content, table_html_tuple):\n","    \"\"\"\n","    Generates the final HTML for the digest by populating a template.\n","    \"\"\"\n","    if not content:\n","        return \"<h1>Error: Could not generate content.</h1>\"\n","\n","    ht_borrow_table, squeeze_table = table_html_tuple\n","\n","    def format_market_note_change(value):\n","        color = '#16a34a' if value >= 0 else '#dc2626'\n","        sign = '+' if value >= 0 else ''\n","        return f'<span style=\"color:{color}; font-size:14px;\">{sign}{value:.2f}%</span>'\n","\n","    market_notes = content.get('market_notes', {})\n","    avg_fee_bps = market_notes.get('avg_fee_bps', 'N/A')\n","    avg_fee_change = format_market_note_change(market_notes.get('avg_fee_change', 0))\n","    avg_util_percent = market_notes.get('avg_util_percent', 'N/A')\n","    avg_util_change = format_market_note_change(market_notes.get('avg_util_change', 0))\n","    on_loan_value = market_notes.get('on_loan_value', 'N/A')\n","    on_loan_value_change = format_market_note_change(market_notes.get('on_loan_value_change', 0))\n","    lendable_value = market_notes.get('lendable_value', 'N/A')\n","    lendable_value_change = format_market_note_change(market_notes.get('lendable_value_change', 0))\n","\n","    headlines_html = \"\"\n","    for headline in content.get('headlines', []):\n","        headlines_html += f\"\"\"\n","        <div style=\"margin-top:20px;\">\n","            <strong style=\"font-size:16px;\">{headline['title']}</strong>\n","            <p style=\"margin:5px 0 0; white-space: pre-wrap;\">{headline['description']}</p>\n","            <div style=\"background-color: #f0f5fa; border-left: 4px solid #0056b3; padding: 10px 15px; margin: 10px 0; font-size: 14px; line-height: 1.5;\">\n","                <strong>What Our Data Shows:</strong> {headline['data_insight']}\n","            </div>\n","        </div>\n","        \"\"\"\n","\n","    takeaways_html = \"\".join([f'<li><span style=\"font-size:1.2em; margin-right: 5px;\">&#x1F4A1;</span>{item}</li>' for item in content.get('key_takeaways', [])])\n","\n","    html_template = f\"\"\"\n","<!DOCTYPE html>\n","<html lang=\"en\">\n","<head>\n","  <meta charset=\"UTF-8\">\n","  <title>EquiLend D&A Daily Digest - {content['date']}</title>\n","</head>\n","<body style=\"margin:0; padding:0; font-family: Arial, sans-serif; background-color:#f1f5f9;\">\n","  <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"#f1f5f9\">\n","    <tr>\n","      <td align=\"center\">\n","        <table width=\"800\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"#ffffff\" style=\"margin:20px 0; border-radius:4px; overflow:hidden;\">\n","          <!-- Header -->\n","          <tr>\n","            <td bgcolor=\"#002D62\" style=\"padding:20px; text-align:center;\">\n","              <h1 style=\"margin:0; font-size:24px; color:#ffffff;\">EquiLend D&amp;A Daily Digest</h1>\n","              <p style=\"margin:5px 0 0; font-size:16px; color:#e0e0e0;\">{content['date']}</p>\n","            </td>\n","          </tr>\n","          <!-- Content -->\n","          <tr>\n","            <td style=\"padding:20px; color:#334155; font-size:14px; line-height:1.5;\">\n","\n","              <!-- Market Notes -->\n","              <h2 style=\"font-size:18px; margin-bottom:10px; color:#002D62;\">&#x1F4BC; Market Notes</h2>\n","              <table width=\"100%\" cellpadding=\"5\" cellspacing=\"0\" border=\"0\" bgcolor=\"#f8fafc\" style=\"margin-bottom:20px; border: 1px solid #e2e8f0;\">\n","                <tr>\n","                  <td align=\"center\" width=\"50%\" style=\"border-right: 1px solid #e2e8f0;\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Average Fee</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      {avg_fee_bps} bps {avg_fee_change}\n","                    </p>\n","                  </td>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">On Loan Value</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      ${on_loan_value} {on_loan_value_change}\n","                    </p>\n","                  </td>\n","                </tr>\n","                 <tr style=\"border-top: 1px solid #e2e8f0;\">\n","                  <td align=\"center\" width=\"50%\" style=\"border-right: 1px solid #e2e8f0;\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Average Utilization</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      {avg_util_percent}% {avg_util_change}\n","                    </p>\n","                  </td>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Total Lendable Value</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      ${lendable_value} {lendable_value_change}\n","                    </p>\n","                  </td>\n","                </tr>\n","              </table>\n","\n","              <!-- Headlines -->\n","              <h2 style=\"font-size:18px; margin-bottom:10px; color:#002D62;\">&#x1F4F0; Major Headlines and What Our Data Shows</h2>\n","              {headlines_html}\n","\n","              <!-- Tables Section -->\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#002D62;\">&#x1F525; Hot & Getting Hotter</h2>\n","              <div style=\"font-size:14px; font-style:italic; color:#334155; margin-bottom:10px; padding-left:5px;\">Top 5 Stocks with the highest borrow costs</div>\n","              <table cellpadding=\"0\" cellspacing=\"0\" border=\"1\" style=\"border-collapse:collapse; margin-bottom:20px; border-color:#dddddd; font-size:12px;\" width=\"100%\">\n","                <thead>\n","                  <tr bgcolor=\"#002D62\" style=\"color:#ffffff; font-weight:bold; text-align:left;\">\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Ticker</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Company Name</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Industry</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Price</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Fee 1 Week (bps)</th>\n","                  </tr>\n","                </thead>\n","                <tbody>\n","                  {ht_borrow_table}\n","                </tbody>\n","              </table>\n","\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#002D62;\">&#x1F52C; Market Technicals & Squeeze Metrics</h2>\n","              <table cellpadding=\"0\" cellspacing=\"0\" border=\"1\" style=\"border-collapse:collapse; border-color:#dddddd; font-size:12px;\" width=\"100%\">\n","                <thead>\n","                  <tr bgcolor=\"#002D62\" style=\"color:#ffffff; font-weight:bold; text-align:left;\">\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Ticker</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Company Name</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Industry</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Price</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Short Squeeze Score (SSS)</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">SSS WoW</th>\n","                  </tr>\n","                </thead>\n","                <tbody>\n","                  {squeeze_table}\n","                </tbody>\n","              </table>\n","\n","              <!-- Key Takeaways -->\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#002D62;\">&#x1F4A1; Key Takeaways</h2>\n","              <ul style=\"padding-left:20px; color:#334155; font-size:14px; margin:0; list-style-type: none;\">\n","                {takeaways_html}\n","              </ul>\n","\n","            </td>\n","          </tr>\n","          <!-- Footer -->\n","          <tr>\n","            <td align=\"center\" style=\"padding:10px; font-size:12px; color:#64748b;\">\n","              Source: EquiLend Data &amp; Analytics\n","            </td>\n","          </tr>\n","        </table>\n","      </td>\n","    </tr>\n","  </table>\n","</body>\n","</html>\n","    \"\"\"\n","    return html_template\n","\n","# --- 3. Main Execution ---\n","\n","def main():\n","    \"\"\"\n","    Main function to generate and save the HTML file.\n","    \"\"\"\n","    # Get content and table HTML\n","    hardcoded_content = get_hardcoded_content()\n","    table_html = get_hardcoded_tables_html()\n","\n","    # Create the final HTML\n","    final_html = create_digest_html(hardcoded_content, table_html)\n","\n","    # Save the HTML to a file\n","    try:\n","        with open(OUTPUT_HTML_PATH, 'w', encoding='utf-8') as f:\n","            f.write(final_html)\n","        print(f\"Successfully generated HTML file: {OUTPUT_HTML_PATH}\")\n","    except IOError as e:\n","        print(f\"Error writing to file {OUTPUT_HTML_PATH}: {e}\")\n","\n","if __name__ == \"__main__\":\n","    main()"],"outputs":[{"output_type":"stream","name":"stdout","text":["Successfully generated HTML file: equilend_daily_digest_August_4_2025.html\n"]}],"execution_count":1,"metadata":{"id":"wvkgS52fNXIX","executionInfo":{"status":"ok","timestamp":1754343749862,"user_tz":240,"elapsed":1260,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"97059d71-f840-43b6-8b90-14479f19edaa","colab":{"base_uri":"https://localhost:8080/"}}}],"metadata":{"colab":{"provenance":[]},"kernelspec":{"display_name":"Python 3","name":"python3"}},"nbformat":4,"nbformat_minor":0}