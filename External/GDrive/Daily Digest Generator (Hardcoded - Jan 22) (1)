{"cells":[{"cell_type":"code","source":["import pandas as pd\n","from datetime import datetime\n","import re\n","import numpy as np\n","\n","# --- Configuration ---\n","# The output file will be named with today's date.\n","OUTPUT_HTML_PATH = f\"equilend_daily_digest_{datetime.now().strftime('%Y_%m_%d')}.html\"\n","\n","# --- 1. Hardcoded Content and Data ---\n","\n","def get_hardcoded_content():\n","    \"\"\"\n","    Returns all the text content for the digest.\n","    This section can be updated with the day's specific narrative content.\n","    \"\"\"\n","    content = {\n","        'market_notes': {\n","            'avg_fee_bps': '44.5',\n","            'avg_fee_change': -1.26,\n","            'avg_util_percent': '7.07',\n","            'avg_util_change': 0.37\n","        },\n","        'headlines': [\n","            {\n","                'title': 'Japan’s Stocks Mixed After Election:',\n","                'description': 'The Japanese Yen climbed ~0.9% as the ruling coalition lost its upper house majority, amplifying concerns about fiscal stability and upcoming trade talks ahead of the August 1st deadline.',\n","                'data_insight': 'Since the announcement of the ‘Liberation Day’ tariffs, EquiLend’s Data & Analytics has seen borrowing cost rise throughout Q2, reaching a peak of 74 bps at the end of the quarter (up from 48 bps in early April). This may indicate heightened hedge fund interest throughout this period with uncertainty of a suitable trade deal being agreed upon with the US.'\n","            },\n","            {\n","                'title': 'Luxury UK Car Manufacturers Crash into Geopolitical Barriers:',\n","                'description': 'Luxury, high-performance UK car makers, such as McLaren, Aston Martin and Morgan, face challenges which ‘threaten competitiveness and growth’ according to a report by the SMMT. The report refers to trouble with volatile trading conditions, decarbonisation rules and production cost pressures. These concerns were underlined by the uncertainty generated by the threat of a 25% tariff on exports to the US before the UK-US trade deal was established.',\n","                'data_insight': 'Aston Martin Lagonda have seen a dramatic upturn in borrowing interest in the past year, reaching peak values for borrowing cost and On Loan Quantity recently. Borrowing fees for the British equity exceeded 1,200 bps last week (up from only 13 bps at the same time last year) as well as On Loan Quantity fluctuating around 80 million shares, again rising from around 10 millions shares this time last year.'\n","            },\n","            {\n","                'title': 'U.S. Consumer Shows Resilience with June Retail Sales Rebound, Supporting Growth Outlook',\n","                'description': 'Following a weak prior month, U.S. retail sales bounced back more strongly than forecasted, reinforcing the narrative of a durable American consumer. This resilience, supported by a firm labor market, provides a crucial pillar for U.S. economic growth and corporate revenues. It may also give the Federal Reserve more leeway to maintain its current policy stance without needing to stimulate demand.',\n","                'data_insight': 'Consumer discretionary equities have faced the brunt of the tariff volatility in 2025 and as a consequence EquiLend D&A has seen a significant upturn in lending activity. Examples such as Quantumspace Corporation have been documented, with the EV Battery manufacturer seeing its year-to-date average On Loan Quantity at 78.6 million shares, increasing by 23 million shares compared to 2024.'\n","            }\n","        ],\n","        'key_takeaways': [\n","            \"Political uncertainty in Japan following the election could be leading to a cautious outlook on Japanese equities, as reflected in rising borrowing costs during Q2.\",\n","            \"UK luxury automakers face significant headwinds from geopolitical and regulatory pressures, with a dramatic increase in borrowing costs for names like Aston Martin signaling heightened investor concern.\",\n","            \"Despite a strong rebound in U.S. retail sales, high short interest in some consumer discretionary names may indicate investor skepticism about the durability of this trend.\"\n","        ]\n","    }\n","    return content\n","\n","def get_hardcoded_tables_html():\n","    \"\"\"\n","    Returns HTML for the two data tables using the hardcoded data for Jan 22.\n","    \"\"\"\n","    # Data for \"Hot & Getting Hotter\" Table\n","    ht_borrow_data = [\n","        {\"TICKER\": \"FOXX\", \"Security Description\": \"FOXX DEVELOPMENT HOLDINGS INC COM\", \"Industry\": \"Technology Hardware and Equipment\", \"Price\": \"$5.40\", \"Fee Band\": \"90,000+\", \"Fee WoW (BPS)\": \"881.77\"},\n","        {\"TICKER\": \"SLRX\", \"Security Description\": \"SALARIUS PHARMACEUTICALS INC COM (POST REV SPL)\", \"Industry\": \"Biotechnology\", \"Price\": \"$0.73\", \"Fee Band\": \"70,000 to 89,999\", \"Fee WoW (BPS)\": \"4387.14\"},\n","        {\"TICKER\": \"ABVE\", \"Security Description\": \"ABOVE FOOD INGREDIENTS INC COM NPV\", \"Industry\": \"Food, Beverage and Tobacco\", \"Price\": \"$2.42\", \"Fee Band\": \"50,00 to 69,999\", \"Fee WoW (BPS)\": \"10732.3\"},\n","        {\"TICKER\": \"CYCC\", \"Security Description\": \"CYCLACEL PHARMACEUTICALS INC COM (POST SPLIT)\", \"Industry\": \"Biotechnology\", \"Price\": \"$11.66\", \"Fee Band\": \"50,00 to 69,999\", \"Fee WoW (BPS)\": \"52224.68\"},\n","        {\"TICKER\": \"BMGL\", \"Security Description\": \"BASEL MEDICAL GROUP LTD COM NPV\", \"Industry\": \"Health Care Providers and Services\", \"Price\": \"$2.34\", \"Fee Band\": \"50,00 to 69,999\", \"Fee WoW (BPS)\": \"6798.96\"},\n","    ]\n","\n","    # Data for \"Market Technicals & Squeeze Metrics\"\n","    squeeze_data = [\n","        {\"TICKER\": \"VOR\", \"Security Description\": \"VOR BIOPHARMA INC COM\", \"Industry\": \"Biotechnology\", \"Price\": \"$2.05\", \"Squeeze Score\": 89, \"Squeeze Score WoW\": 1},\n","        {\"TICKER\": \"OPEN\", \"Security Description\": \"OPENDOOR TECHNOLOGIES INC COM\", \"Industry\": \"Real Estate Management & Development\", \"Price\": \"$3.21\", \"Squeeze Score\": 87, \"Squeeze Score WoW\": 44},\n","        {\"TICKER\": \"ETHT\", \"Security Description\": \"PROSHARES TRUST ULTRA ETHER ETF NEW (R/S)\", \"Industry\": \"Technology\", \"Price\": \"$83.46\", \"Squeeze Score\": 80, \"Squeeze Score WoW\": 51},\n","        {\"TICKER\": \"NKTR\", \"Security Description\": \"NEKTAR THERAPEUTICS COM (POST SPT)\", \"Industry\": \"Pharmaceuticals\", \"Price\": \"$24.79\", \"Squeeze Score\": 77, \"Squeeze Score WoW\": 1},\n","        {\"TICKER\": \"MGRM\", \"Security Description\": \"MONOGRAM TECHNOLOGIES INC COM\", \"Industry\": \"Health Care Equipment and Supplies\", \"Price\": \"$5.69\", \"Squeeze Score\": 76, \"Squeeze Score WoW\": 8},\n","    ]\n","\n","    def format_change(value, unit=' BPS'):\n","        try:\n","            cleaned_value = str(value).replace(',', '').strip()\n","            val = float(cleaned_value)\n","            color = '#16a34a' if val > 0 else '#dc2626'\n","            sign = '+' if val > 0 else ''\n","            return f'<span style=\"color:{color}; font-size:14px;\">{sign}{val:,.2f}{unit}</span>'\n","        except (ValueError, TypeError):\n","            return str(value).strip() if pd.notna(value) else ''\n","\n","    ht_borrow_html = \"\"\n","    for row in ht_borrow_data:\n","        ht_borrow_html += f\"\"\"\n","        <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","            <td style=\"padding:4px 8px;\">{row.get(\"TICKER\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Security Description\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Industry\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Price\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Fee Band\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{format_change(row.get(\"Fee WoW (BPS)\"))}</td>\n","        </tr>\"\"\"\n","\n","    squeeze_html = \"\"\n","    for row in squeeze_data:\n","        squeeze_html += f\"\"\"\n","        <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","            <td style=\"padding:4px 8px;\">{row.get(\"TICKER\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Security Description\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Industry\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Price\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Squeeze Score\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{format_change(row.get(\"Squeeze Score WoW\"), unit=\"\")}</td>\n","        </tr>\"\"\"\n","\n","    return ht_borrow_html, squeeze_html\n","\n","\n","# --- 2. HTML Generation ---\n","\n","def create_digest_html(content, table_html_tuple):\n","    \"\"\"\n","    Generates the final HTML for the digest by populating a template.\n","    \"\"\"\n","    if not content:\n","        return \"<h1>Error: Could not generate content.</h1>\"\n","\n","    ht_borrow_table, squeeze_table = table_html_tuple\n","\n","    def format_market_note_change(value):\n","        color = '#16a34a' if value > 0 else '#dc2626'\n","        sign = '+' if value > 0 else ''\n","        return f'<span style=\"color:{color}; font-size:14px;\">{sign}{value:.2f}%</span>'\n","\n","    market_notes = content.get('market_notes', {})\n","    avg_fee_bps = market_notes.get('avg_fee_bps', 'N/A')\n","    avg_fee_change = format_market_note_change(market_notes.get('avg_fee_change', 0))\n","    avg_util_percent = market_notes.get('avg_util_percent', 'N/A')\n","    avg_util_change = format_market_note_change(market_notes.get('avg_util_change', 0))\n","\n","    headlines_html = \"\"\n","    for headline in content.get('headlines', []):\n","        headlines_html += f\"\"\"\n","        <div style=\"margin-top:20px;\">\n","            <strong style=\"font-size:16px;\">{headline['title']}</strong>\n","            <p style=\"margin:5px 0 0; white-space: pre-wrap;\">{headline['description']}</p>\n","            <ul style=\"margin:10px 0 0; padding-left:20px; color:#334155; list-style-type: disc;\">\n","              <li><strong>What Our Data Shows:</strong> {headline['data_insight']}</li>\n","            </ul>\n","        </div>\n","        \"\"\"\n","\n","    takeaways_html = \"\".join([f\"<li>{item}</li>\" for item in content.get('key_takeaways', [])])\n","\n","    html_template = f\"\"\"\n","<!DOCTYPE html>\n","<html lang=\"en\">\n","<head>\n","  <meta charset=\"UTF-8\">\n","  <title>EquiLend D&A Daily Digest - January 22, 2025</title>\n","</head>\n","<body style=\"margin:0; padding:0; font-family: Arial, sans-serif; background-color:#f1f5f9;\">\n","  <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"#f1f5f9\">\n","    <tr>\n","      <td align=\"center\">\n","        <table width=\"800\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"#ffffff\" style=\"margin:20px 0; border-radius:4px; overflow:hidden;\">\n","          <!-- Header -->\n","          <tr>\n","            <td bgcolor=\"#0284c7\" style=\"padding:20px; text-align:center;\">\n","              <h1 style=\"margin:0; font-size:24px; color:#ffffff;\">EquiLend D&amp;A Daily Digest</h1>\n","              <p style=\"margin:5px 0 0; font-size:16px; color:#bae6fd;\">January 22, 2025</p>\n","            </td>\n","          </tr>\n","          <!-- Content -->\n","          <tr>\n","            <td style=\"padding:20px; color:#333333; font-size:14px; line-height:1.5;\">\n","\n","              <!-- Market Notes -->\n","              <h2 style=\"font-size:18px; margin-bottom:10px; color:#0284c7;\">&#x1F4BC; Market Notes</h2>\n","              <table width=\"100%\" cellpadding=\"5\" cellspacing=\"0\" border=\"0\" bgcolor=\"#f8fafc\" style=\"margin-bottom:20px;\">\n","                <tr>\n","                  <td align=\"center\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Average Fee</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      {avg_fee_bps} bps {avg_fee_change}\n","                    </p>\n","                  </td>\n","                  <td align=\"center\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Average Utilization</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      {avg_util_percent}% {avg_util_change}\n","                    </p>\n","                  </td>\n","                </tr>\n","              </table>\n","\n","              <!-- Headlines -->\n","              <h2 style=\"font-size:18px; margin-bottom:10px; color:#0284c7;\">&#x1F4F0; Major Headlines and What Our Data Shows</h2>\n","              {headlines_html}\n","\n","              <!-- Tables Section -->\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F525; Hot & Getting Hotter</h2>\n","              <table cellpadding=\"0\" cellspacing=\"0\" border=\"1\" style=\"border-collapse:collapse; margin-bottom:20px; border-color:#dddddd; font-size:12px;\" width=\"100%\">\n","                <thead>\n","                  <tr bgcolor=\"#0284c7\" style=\"color:#ffffff; font-weight:bold; text-align:left;\">\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Ticker</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Security Description</th>\n","                    <th style=\"padding:5px 8px; white--space: nowrap;\">Industry</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Price</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Fee Band</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Fee WoW (BPS)</th>\n","                  </tr>\n","                </thead>\n","                <tbody>\n","                  {ht_borrow_table}\n","                </tbody>\n","              </table>\n","\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F52C; Market Technicals & Squeeze Metrics</h2>\n","              <table cellpadding=\"0\" cellspacing=\"0\" border=\"1\" style=\"border-collapse:collapse; border-color:#dddddd; font-size:12px;\" width=\"100%\">\n","                <thead>\n","                  <tr bgcolor=\"#0284c7\" style=\"color:#ffffff; font-weight:bold; text-align:left;\">\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Ticker</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Security Description</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Industry</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Price</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Squeeze Score</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Squeeze Score WoW</th>\n","                  </tr>\n","                </thead>\n","                <tbody>\n","                  {squeeze_table}\n","                </tbody>\n","              </table>\n","\n","              <!-- Key Takeaways -->\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F4A1; Key Takeaways</h2>\n","              <ul style=\"padding-left:20px; color:#334155; font-size:14px; margin:0;\">\n","                {takeaways_html}\n","              </ul>\n","\n","            </td>\n","          </tr>\n","          <!-- Footer -->\n","          <tr>\n","            <td align=\"center\" style=\"padding:10px; font-size:12px; color:#64748b;\">\n","              Source: EquiLend Data &amp; Analytics\n","            </td>\n","          </tr>\n","        </table>\n","      </td>\n","    </tr>\n","  </table>\n","</body>\n","</html>\n","    \"\"\"\n","    return html_template\n","\n","# --- Main Execution ---\n","if __name__ == \"__main__\":\n","    print(\"Starting daily digest generation...\")\n","\n","    # 1. Get hardcoded content\n","    print(\"Loading hardcoded content...\")\n","    hardcoded_content = get_hardcoded_content()\n","\n","    # 2. Get HTML for the hardcoded tables\n","    print(\"Generating tables from hardcoded data...\")\n","    table_html = get_hardcoded_tables_html()\n","\n","    # 3. Generate the final HTML file\n","    print(\"Generating final HTML digest...\")\n","    final_html = create_digest_html(hardcoded_content, table_html)\n","\n","    # 4. Save the HTML to a file\n","    with open(OUTPUT_HTML_PATH, 'w', encoding='utf-8') as f:\n","        f.write(final_html)\n","\n","    print(f\"\\nSuccessfully generated digest: {OUTPUT_HTML_PATH}\")\n","    print(\"This version is fully hardcoded and does not depend on external files.\")"],"outputs":[{"output_type":"stream","name":"stdout","text":["Starting daily digest generation...\n","Loading hardcoded content...\n","Generating tables from hardcoded data...\n","Generating final HTML digest...\n","\n","Successfully generated digest: equilend_daily_digest_2025_07_22.html\n","This version is fully hardcoded and does not depend on external files.\n"]}],"execution_count":1,"metadata":{"id":"c4Zd3_9GgEK2","executionInfo":{"status":"ok","timestamp":1753193932847,"user_tz":240,"elapsed":745,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"0ef6d92e-9189-4d10-ca8f-1ddc447ba8f5","colab":{"base_uri":"https://localhost:8080/"}}}],"metadata":{"colab":{"provenance":[]},"kernelspec":{"display_name":"Python 3","name":"python3"}},"nbformat":4,"nbformat_minor":0}