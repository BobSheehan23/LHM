{"cells":[{"cell_type":"code","source":["import pandas as pd\n","from datetime import datetime\n","import re\n","import numpy as np\n","\n","# --- Configuration ---\n","# The output file will be named with the specified date.\n","OUTPUT_HTML_PATH = \"equilend_daily_digest_August_05_2025.html\"\n","DIGEST_DATE = \"August 5, 2025\"\n","\n","# --- 1. Content and Data ---\n","\n","def get_digest_content():\n","    \"\"\"\n","    Returns all the text content and structured data for the digest.\n","    This section is populated with the content from the August 5th document.\n","    \"\"\"\n","    # Helper function to extract numerical change from strings like \"(-40.1%)\"\n","    def parse_change(text):\n","        match = re.search(r'\\((.*?)%\\)', text)\n","        if match:\n","            try:\n","                return float(match.group(1))\n","            except (ValueError, TypeError):\n","                return 0\n","        return 0\n","\n","    content = {\n","        'market_notes': {\n","            'avg_fee_bps': '42.27',\n","            'avg_fee_change': parse_change(\"(-40.1%)\"),\n","            'avg_util_percent': '7.2',\n","            'avg_util_change': parse_change(\"(+2.13%)\"),\n","            'on_loan_value': '3.06T',\n","            'on_loan_value_change': parse_change(\"(+1.86%)\"),\n","            'lendable_value': '42.6T',\n","            'lendable_value_change': parse_change(\"(-0.26%)\")\n","        },\n","        'headlines': [\n","            {\n","                'title': 'US Tariffs on India and South Korea Trigger Market Volatility',\n","                'description': 'The US has introduced new tariffs on imports from several countries, including India and South Korea. The announcement has created uncertainty and has already been a factor in market volatility. For example, copper prices initially rose on supply concerns, while Indian and South Korean equities experienced selling pressure. The move could signal a potential re-escalation of global trade tensions.',\n","                'data_insight': 'Borrowing demand in Asia as a whole has been significantly heightened in the past months due to the impact of turbulent tariff negotiations. With this increased demand for securities, our data highlights the rising cost to borrow in the region, with average fees for Asian equities reaching a peak of 206 bps last week, a jump of around 40 bps compared to the same time in 2024.'\n","            },\n","            {\n","                'title': 'Strong Big Tech Earnings Drive Nasdaq and S&P 500',\n","                'description': 'Major technology companies have reported strong quarterly earnings, with several beating analyst expectations. Companies like Microsoft and Meta Platforms, in particular, delivered results that reinforced the ongoing momentum behind artificial intelligence as a key growth driver. The positive earnings reports helped to support the Nasdaq and S&P 500, which had been under pressure due to other macro factors.',\n","                'data_insight': 'Many AI startup companies have come under the spotlight in recent months with big tech names, such as Meta and Microsoft, looking at expanding and acquiring in this field. According to our data, the latest AI company to be heating up is Rezolve AI (RZLV) following an announcement of a $50 million, long-term investment from Citadel. The volume of shares on loan has risen sharply in recent weeks, rising by 2.5 million shares in the past week to a record of 18.3 million shares on loan.'\n","            },\n","            {\n","                'title': 'Meme Stock Mania Continues with Controversial American Eagle Ad Campaign',\n","                'description': 'Shares in the US clothing brand American Eagle have jumped 24%, the biggest movement for the company since 2000. The rise comes following an advertisement campaign, released last week, featuring celebrity Sydney Sweeney, which has been criticized due to a controversial slogan used to advertise their jeans. However, President Trump has since publicly praised the ad, adding to the frenzy of media attention and activity on Wall Street.',\n","                'data_insight': 'Due to the lack of concrete financial basis for American Eagle (AEO) shares rising, hedge fund interest has been peaked with the inflated stock prices not expected to be sustainable. This increase in short interest has been prevalent in our data, with the number of AEO shares on loan rising by 40% in the last week to 31.3 million and in turn, the cost of borrowing these shares has followed a similar trend.'\n","            }\n","        ],\n","        'key_takeaways': [\n","            \"Tariff discussions are still yet to meet a conclusion between the U.S. and several Asian countries resulting in ongoing volatility throughout Asian markets.\",\n","            \"AI mania continues to fuel progression in U.S. equity markets, with Nasdaq and the S&P 500 benefitting as a consequence.\",\n","            \"American Eagle are the latest to be a part of a recent flurry of Meme stock activity, as a controversial ad campaign sparks backlash amongst certain parties within the media.\"\n","        ]\n","    }\n","    return content\n","\n","def get_tables_html():\n","    \"\"\"\n","    Returns HTML for the two data tables using the data from August 5th.\n","    \"\"\"\n","    # Data for \"Hot & Getting Hotter\"\n","    ht_borrow_data = [\n","        {\"TICKER\": \"VWAV\", \"Company Name\": \"VISIONWAVE HOLDINGS\", \"Industry\": \"Capital Goods\", \"Price\": \"$7.25\", \"Fee 1 WoW (bps)\": 52979.59},\n","        {\"TICKER\": \"DGNX\", \"Company Name\": \"DIGINEX LIMITED\", \"Industry\": \"Software & Services\", \"Price\": \"$52.59\", \"Fee 1 WoW (bps)\": 3442.89},\n","        {\"TICKER\": \"ABVE\", \"Company Name\": \"ABOVE FOOD INGRED,\", \"Industry\": \"Food, Beverage & Tobacco\", \"Price\": \"$1.71\", \"Fee 1 WoW (bps)\": 1611.35},\n","        {\"TICKER\": \"PAPL\", \"Company Name\": \"PINEAPPLE FINANCIAL\", \"Industry\": \"Diversified Financials\", \"Price\": \"$3.53\", \"Fee 1 WoW (bps)\": 1541.26},\n","        {\"TICKER\": \"WBUY\", \"Company Name\": \"WEBUY GLOBAL\", \"Industry\": \"Food & Staples Retailing\", \"Price\": \"$3.53\", \"Fee 1 WoW (bps)\": 568.19},\n","    ]\n","\n","    # Data for \"Market Technicals & Squeeze Metrics\"\n","    squeeze_data = [\n","        {\"TICKER\": \"4935 JP\", \"Company Name\": \"LIBERTA CO LTD NPV\", \"Industry\": \"Retailing\", \"Price\": \"$21.97\", \"SSS\": 73, \"SSS WoW\": 23},\n","        {\"TICKER\": \"3715 TT\", \"Company Name\": \"DYNAMIC HOLDING CO LTD\", \"Industry\": \"Tech Hardware & Equip\", \"Price\": \"$2.76\", \"SSS\": 72, \"SSS WoW\": 28},\n","        {\"TICKER\": \"6731 JP\", \"Company Name\": \"PIXELA CORPORATION NPV\", \"Industry\": \"Tech Hardware & Equip\", \"Price\": \"$0.66\", \"SSS\": 67, \"SSS WoW\": 2},\n","        {\"TICKER\": \"2334 JP\", \"Company Name\": \"EOLE INC NPV\", \"Industry\": \"Interactive Media & Services\", \"Price\": \"$26.14\", \"SSS\": 65, \"SSS WoW\": 13},\n","        {\"TICKER\": \"281A JP\", \"Company Name\": \"INFORMETIS CO LTD NPV\", \"Industry\": \"Software & Services\", \"Price\": \"$13.44\", \"SSS\": 65, \"SSS WoW\": 0},\n","    ]\n","\n","    # Helper function to format numerical changes with color\n","    def format_change(value, unit=' BPS'):\n","        try:\n","            cleaned_value = str(value).replace(',', '').strip()\n","            val = float(cleaned_value)\n","            color = '#16a34a' if val > 0 else ('#dc2626' if val < 0 else '#334155') # Green for positive, red for negative, gray for zero\n","            sign = '+' if val > 0 else ''\n","            return f'<span style=\"color:{color}; font-weight:bold;\">{sign}{val:,.2f}{unit}</span>'\n","        except (ValueError, TypeError):\n","            return str(value).strip() if pd.notna(value) else ''\n","\n","    # Generate HTML rows for the \"Hot & Getting Hotter\" table\n","    ht_borrow_html = \"\"\n","    for row in ht_borrow_data:\n","        ht_borrow_html += f\"\"\"\n","        <tr style=\"font-size:12px; background-color:#ffffff; text-align:left; border-bottom: 1px solid #e2e8f0;\">\n","            <td style=\"padding:8px;\">{row.get(\"TICKER\", \"\")}</td>\n","            <td style=\"padding:8px;\">{row.get(\"Company Name\", \"\")}</td>\n","            <td style=\"padding:8px;\">{row.get(\"Industry\", \"\")}</td>\n","            <td style=\"padding:8px;\">{row.get(\"Price\", \"\")}</td>\n","            <td style=\"padding:8px;\">{format_change(row.get(\"Fee 1 WoW (bps)\"))}</td>\n","        </tr>\"\"\"\n","\n","    # Generate HTML rows for the \"Market Technicals & Squeeze Metrics\" table\n","    squeeze_html = \"\"\n","    for row in squeeze_data:\n","        squeeze_html += f\"\"\"\n","        <tr style=\"font-size:12px; background-color:#ffffff; text-align:left; border-bottom: 1px solid #e2e8f0;\">\n","            <td style=\"padding:8px;\">{row.get(\"TICKER\", \"\")}</td>\n","            <td style=\"padding:8px;\">{row.get(\"Company Name\", \"\")}</td>\n","            <td style=\"padding:8px;\">{row.get(\"Industry\", \"\")}</td>\n","            <td style=\"padding:8px;\">{row.get(\"Price\", \"\")}</td>\n","            <td style=\"padding:8px;\">{row.get(\"SSS\", \"\")}</td>\n","            <td style=\"padding:8px;\">{format_change(row.get(\"SSS WoW\"), unit=\"\")}</td>\n","        </tr>\"\"\"\n","\n","    return ht_borrow_html, squeeze_html\n","\n","\n","# --- 2. HTML Generation ---\n","\n","def create_digest_html(content, table_html_tuple):\n","    \"\"\"\n","    Generates the final HTML for the digest by populating a template.\n","    \"\"\"\n","    if not content:\n","        return \"<h1>Error: Could not generate content.</h1>\"\n","\n","    ht_borrow_table, squeeze_table = table_html_tuple\n","\n","    # Helper function to format the market note percentage changes\n","    def format_market_note_change(value):\n","        color = '#16a34a' if value >= 0 else '#dc2626'\n","        sign = '+' if value >= 0 else ''\n","        return f'<span style=\"color:{color}; font-size:14px; font-weight:bold;\">({sign}{value:.2f}%)</span>'\n","\n","    market_notes = content.get('market_notes', {})\n","    avg_fee_bps = market_notes.get('avg_fee_bps', 'N/A')\n","    avg_fee_change = format_market_note_change(market_notes.get('avg_fee_change', 0))\n","    avg_util_percent = market_notes.get('avg_util_percent', 'N/A')\n","    avg_util_change = format_market_note_change(market_notes.get('avg_util_change', 0))\n","    on_loan_value = market_notes.get('on_loan_value', 'N/A')\n","    on_loan_value_change = format_market_note_change(market_notes.get('on_loan_value_change', 0))\n","    lendable_value = market_notes.get('lendable_value', 'N/A')\n","    lendable_value_change = format_market_note_change(market_notes.get('lendable_value_change', 0))\n","\n","    # Generate HTML for each headline section\n","    headlines_html = \"\"\n","    for headline in content.get('headlines', []):\n","        headlines_html += f\"\"\"\n","        <div style=\"margin-top:20px; padding-bottom: 15px; border-bottom: 1px solid #e2e8f0;\">\n","            <strong style=\"font-size:16px; color: #1e293b;\">{headline['title']}</strong>\n","            <p style=\"margin:8px 0 0; white-space: normal;\">{headline['description']}</p>\n","            <div style=\"margin-top:12px; padding:10px; background-color:#f0f9ff; border-left: 4px solid #0ea5e9; color:#334155;\">\n","                <strong style=\"color:#0c4a6e;\">What Our Data Shows:</strong> {headline['data_insight']}\n","            </div>\n","        </div>\n","        \"\"\"\n","    # Remove the last border\n","    if headlines_html.endswith('border-bottom: 1px solid #e2e8f0;\">'):\n","        headlines_html = headlines_html[:-len('border-bottom: 1px solid #e2e8f0;\">')] + '\">'\n","\n","    # Generate HTML for the key takeaways list\n","    takeaways_html = \"\".join([f'<li style=\"margin-bottom:8px;\">{item}</li>' for item in content.get('key_takeaways', [])])\n","\n","    # The main HTML template for the email\n","    html_template = f\"\"\"\n","<!DOCTYPE html>\n","<html lang=\"en\">\n","<head>\n","  <meta charset=\"UTF-8\">\n","  <title>EquiLend D&A Daily Digest - {DIGEST_DATE}</title>\n","</head>\n","<body style=\"margin:0; padding:0; font-family: Arial, sans-serif; background-color:#f1f5f9;\">\n","  <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"#f1f5f9\">\n","    <tr>\n","      <td align=\"center\">\n","        <table width=\"800\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"#ffffff\" style=\"margin:20px 0; border-radius:8px; overflow:hidden; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);\">\n","          <!-- Header -->\n","          <tr>\n","            <td bgcolor=\"#067db6\" style=\"padding:24px; text-align:center;\">\n","              <h1 style=\"margin:0; font-size:28px; color:#ffffff; font-weight:bold;\">EquiLend D&amp;A Daily Digest</h1>\n","              <p style=\"margin:5px 0 0; font-size:16px; color:#e0f2fe;\">{DIGEST_DATE}</p>\n","            </td>\n","          </tr>\n","          <!-- Content -->\n","          <tr>\n","            <td style=\"padding:24px; color:#334155; font-size:14px; line-height:1.6;\">\n","\n","              <!-- Market Notes -->\n","              <h2 style=\"font-size:20px; margin-top:0; margin-bottom:15px; color:#067db6; border-bottom: 2px solid #067db6; padding-bottom: 5px;\">&#x1F4BC; Market Notes</h2>\n","              <table width=\"100%\" cellpadding=\"10\" cellspacing=\"0\" border=\"0\" style=\"margin-bottom:25px; text-align:center;\">\n","                <tr>\n","                  <td width=\"50%\" style=\"background-color:#f8fafc; border-radius: 4px 0 0 4px;\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Average Fee</p>\n","                    <p style=\"margin:5px 0 0; font-size:20px; font-weight:bold; color:#334155;\">\n","                      {avg_fee_bps} bps {avg_fee_change}\n","                    </p>\n","                  </td>\n","                  <td width=\"50%\" style=\"background-color:#f8fafc; border-radius: 0 4px 4px 0;\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">On Loan Value</p>\n","                    <p style=\"margin:5px 0 0; font-size:20px; font-weight:bold; color:#334155;\">\n","                      ${on_loan_value} {on_loan_value_change}\n","                    </p>\n","                  </td>\n","                </tr>\n","                 <tr style=\"height: 10px;\"><td colspan=\"2\"></td></tr>\n","                <tr>\n","                  <td width=\"50%\" style=\"background-color:#f8fafc; border-radius: 4px 0 0 4px;\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Average Utilization</p>\n","                    <p style=\"margin:5px 0 0; font-size:20px; font-weight:bold; color:#334155;\">\n","                      {avg_util_percent}% {avg_util_change}\n","                    </p>\n","                  </td>\n","                  <td width=\"50%\" style=\"background-color:#f8fafc; border-radius: 0 4px 4px 0;\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Total Lendable Value</p>\n","                    <p style=\"margin:5px 0 0; font-size:20px; font-weight:bold; color:#334155;\">\n","                      ${lendable_value} {lendable_value_change}\n","                    </p>\n","                  </td>\n","                </tr>\n","              </table>\n","\n","              <!-- Headlines -->\n","              <h2 style=\"font-size:20px; margin-bottom:15px; color:#067db6; border-bottom: 2px solid #067db6; padding-bottom: 5px;\">&#x1F4F0; Major Headlines and What Our Data Shows</h2>\n","              {headlines_html}\n","\n","              <!-- Tables Section -->\n","              <h2 style=\"font-size:20px; margin:30px 0 15px; color:#dc2626; border-bottom: 2px solid #dc2626; padding-bottom: 5px;\">&#x1F525; Hot & Getting Hotter</h2>\n","              <div style=\"font-size:14px; font-style:italic; color:#334155; margin-bottom:10px;\">Top stocks with fees > 50,000 bps & rising</div>\n","              <table cellpadding=\"0\" cellspacing=\"0\" style=\"border-collapse:collapse; margin-bottom:25px; font-size:12px;\" width=\"100%\">\n","                <thead>\n","                  <tr bgcolor=\"#334155\" style=\"color:#ffffff; font-weight:bold; text-align:left;\">\n","                    <th style=\"padding:8px; white-space: nowrap;\">Ticker</th>\n","                    <th style=\"padding:8px; white-space: nowrap;\">Company Name</th>\n","                    <th style=\"padding:8px; white-space: nowrap;\">Industry</th>\n","                    <th style=\"padding:8px; white-space: nowrap;\">Price</th>\n","                    <th style=\"padding:8px; white-space: nowrap;\">Fee WoW (bps)</th>\n","                  </tr>\n","                </thead>\n","                <tbody>\n","                  {ht_borrow_table}\n","                </tbody>\n","              </table>\n","\n","              <h2 style=\"font-size:20px; margin:30px 0 15px; color:#16a34a; border-bottom: 2px solid #16a34a; padding-bottom: 5px;\">&#x1F52C; Market Technicals & Squeeze Metrics</h2>\n","              <table cellpadding=\"0\" cellspacing=\"0\" style=\"border-collapse:collapse; font-size:12px;\" width=\"100%\">\n","                <thead>\n","                  <tr bgcolor=\"#334155\" style=\"color:#ffffff; font-weight:bold; text-align:left;\">\n","                    <th style=\"padding:8px; white-space: nowrap;\">Ticker</th>\n","                    <th style=\"padding:8px; white-space: nowrap;\">Company Name</th>\n","                    <th style=\"padding:8px; white-space: nowrap;\">Industry</th>\n","                    <th style=\"padding:8px; white-space: nowrap;\">Price</th>\n","                    <th style=\"padding:8px; white-space: nowrap;\">SSS</th>\n","                    <th style=\"padding:8px; white-space: nowrap;\">SSS WoW</th>\n","                  </tr>\n","                </thead>\n","                <tbody>\n","                  {squeeze_table}\n","                </tbody>\n","              </table>\n","\n","              <!-- Key Takeaways -->\n","              <h2 style=\"font-size:20px; margin:30px 0 15px; color:#7c3aed; border-bottom: 2px solid #7c3aed; padding-bottom: 5px;\">&#x1F4A1; Key Takeaways</h2>\n","              <ul style=\"padding-left:20px; color:#334155; font-size:14px; margin:0; list-style-type: disc;\">\n","                {takeaways_html}\n","              </ul>\n","\n","            </td>\n","          </tr>\n","          <!-- Footer -->\n","          <tr>\n","            <td align=\"center\" style=\"padding:20px; font-size:12px; color:#64748b; background-color:#f8fafc;\">\n","              Source: EquiLend Data &amp; Analytics\n","            </td>\n","          </tr>\n","        </table>\n","      </td>\n","    </tr>\n","  </table>\n","</body>\n","</html>\n","    \"\"\"\n","    return html_template\n","\n","# --- Main Execution ---\n","if __name__ == \"__main__\":\n","    print(\"Starting daily digest generation...\")\n","\n","    # 1. Get content and data for the digest\n","    print(\"Loading content for August 5, 2025...\")\n","    digest_content = get_digest_content()\n","\n","    # 2. Generate HTML for the data tables\n","    print(\"Generating tables...\")\n","    table_html = get_tables_html()\n","\n","    # 3. Generate the final HTML file by populating the template\n","    print(\"Generating final HTML digest...\")\n","    final_html = create_digest_html(digest_content, table_html)\n","\n","    # 4. Save the HTML to a file\n","    with open(OUTPUT_HTML_PATH, 'w', encoding='utf-8') as f:\n","        f.write(final_html)\n","\n","    print(f\"\\nSuccessfully generated digest: {OUTPUT_HTML_PATH}\")"],"outputs":[{"output_type":"stream","name":"stdout","text":["Starting daily digest generation...\n","Loading content for August 5, 2025...\n","Generating tables...\n","Generating final HTML digest...\n","\n","Successfully generated digest: equilend_daily_digest_August_05_2025.html\n"]}],"execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"bq4PgFVPCO8l","executionInfo":{"status":"ok","timestamp":1754394134912,"user_tz":240,"elapsed":1153,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"574bbaf8-6b0c-417c-ec7f-73493018cb56"}},{"cell_type":"markdown","metadata":{"id":"1b9210d4"},"source":["# Task\n","Update the notebook to pull data from the SharePoint document \"https://equilend-my.sharepoint.com/:w:/r/personal/rsheehan_equilend_com/_layouts/15/Doc.aspx?sourcedoc=%7BC334DB95-84F8-4021-8D56-E34366FFC54D%7D&file=daily_content.docx&action=default&mobileredirect=true&DefaultItemOpen=1\" for generating the daily digest."]},{"cell_type":"markdown","metadata":{"id":"ea86fe12"},"source":["## Manual data extraction\n","\n","### Subtask:\n","Manually access the SharePoint document, extract the content for market notes, headlines, tables, and key takeaways, and save it into a structured format (e.g., a JSON file or a Python dictionary within a separate file).\n"]},{"cell_type":"markdown","metadata":{"id":"3b3fb09a"},"source":["## Modify `get digest content`\n","\n","### Subtask:\n","Update the `get_digest_content` function to read the structured data from the local file created in the previous step instead of using hardcoded values.\n"]},{"cell_type":"markdown","metadata":{"id":"44980a63"},"source":["**Reasoning**:\n","Import the `digest_data` module and modify the `get_digest_content` function to return the data from this module.\n","\n"]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":454},"id":"74b65a08","executionInfo":{"status":"error","timestamp":1754498121227,"user_tz":240,"elapsed":56,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"a29dee19-44db-43b5-afb8-292e8e6cfae7"},"source":["import digest_data\n","\n","# --- 1. Content and Data ---\n","\n","def get_digest_content():\n","    \"\"\"\n","    Returns all the text content and structured data for the digest\n","    from the digest_data module.\n","    \"\"\"\n","    # Return the content dictionary directly from the imported module\n","    return digest_data.digest_content\n","\n","def get_tables_html():\n","    \"\"\"\n","    Returns HTML for the two data tables using the data from August 5th.\n","    \"\"\"\n","    # Data for \"Hot & Getting Hotter\"\n","    ht_borrow_data = [\n","        {\"TICKER\": \"VWAV\", \"Company Name\": \"VISIONWAVE HOLDINGS\", \"Industry\": \"Capital Goods\", \"Price\": \"$7.25\", \"Fee 1 WoW (bps)\": 52979.59},\n","        {\"TICKER\": \"DGNX\", \"Company Name\": \"DIGINEX LIMITED\", \"Industry\": \"Software & Services\", \"Price\": \"$52.59\", \"Fee 1 WoW (bps)\": 3442.89},\n","        {\"TICKER\": \"ABVE\", \"Company Name\": \"ABOVE FOOD INGRED,\", \"Industry\": \"Food, Beverage & Tobacco\", \"Price\": \"$1.71\", \"Fee 1 WoW (bps)\": 1611.35},\n","        {\"TICKER\": \"PAPL\", \"Company Name\": \"PINEAPPLE FINANCIAL\", \"Industry\": \"Diversified Financials\", \"Price\": \"$3.53\", \"Fee 1 WoW (bps)\": 1541.26},\n","        {\"TICKER\": \"WBUY\", \"Company Name\": \"WEBUY GLOBAL\", \"Industry\": \"Food & Staples Retailing\", \"Price\": \"$3.53\", \"Fee 1 WoW (bps)\": 568.19},\n","    ]\n","\n","    # Data for \"Market Technicals & Squeeze Metrics\"\n","    squeeze_data = [\n","        {\"TICKER\": \"4935 JP\", \"Company Name\": \"LIBERTA CO LTD NPV\", \"Industry\": \"Retailing\", \"Price\": \"$21.97\", \"SSS\": 73, \"SSS WoW\": 23},\n","        {\"TICKER\": \"3715 TT\", \"Company Name\": \"DYNAMIC HOLDING CO LTD\", \"Industry\": \"Tech Hardware & Equip\", \"Price\": \"$2.76\", \"SSS\": 72, \"SSS WoW\": 28},\n","        {\"TICKER\": \"6731 JP\", \"Company Name\": \"PIXELA CORPORATION NPV\", \"Industry\": \"Tech Hardware & Equip\", \"Price\": \"$0.66\", \"SSS\": 67, \"SSS WoW\": 2},\n","        {\"TICKER\": \"2334 JP\", \"Company Name\": \"EOLE INC NPV\", \"Industry\": \"Interactive Media & Services\", \"Price\": \"$26.14\", \"SSS\": 65, \"SSS WoW\": 13},\n","        {\"TICKER\": \"281A JP\", \"Company Name\": \"INFORMETIS CO LTD NPV\", \"Industry\": \"Software & Services\", \"Price\": \"$13.44\", \"SSS\": 65, \"SSS WoW\": 0},\n","    ]\n","\n","    # Helper function to format numerical changes with color\n","    def format_change(value, unit=' BPS'):\n","        try:\n","            cleaned_value = str(value).replace(',', '').strip()\n","            val = float(cleaned_value)\n","            color = '#16a34a' if val > 0 else ('#dc2626' if val < 0 else '#334155') # Green for positive, red for negative, gray for zero\n","            sign = '+' if val > 0 else ''\n","            return f'<span style=\"color:{color}; font-weight:bold;\">{sign}{val:,.2f}{unit}</span>'\n","        except (ValueError, TypeError):\n","            return str(value).strip() if pd.notna(value) else ''\n","\n","    # Generate HTML rows for the \"Hot & Getting Hotter\" table\n","    ht_borrow_html = \"\"\n","    for row in ht_borrow_data:\n","        ht_borrow_html += f\"\"\"\n","        <tr style=\"font-size:12px; background-color:#ffffff; text-align:left; border-bottom: 1px solid #e2e8f0;\">\n","            <td style=\"padding:8px;\">{row.get(\"TICKER\", \"\")}</td>\n","            <td style=\"padding:8px;\">{row.get(\"Company Name\", \"\")}</td>\n","            <td style=\"padding:8px;\">{row.get(\"Industry\", \"\")}</td>\n","            <td style=\"padding:8px;\">{row.get(\"Price\", \"\")}</td>\n","            <td style=\"padding:8px;\">{format_change(row.get(\"Fee 1 WoW (bps)\"))}</td>\n","        </tr>\"\"\"\n","\n","    # Generate HTML rows for the \"Market Technicals & Squeeze Metrics\" table\n","    squeeze_html = \"\"\n","    for row in squeeze_data:\n","        squeeze_html += f\"\"\"\n","        <tr style=\"font-size:12px; background-color:#ffffff; text-align:left; border-bottom: 1px solid #e2e8f0;\">\n","            <td style=\"padding:8px;\">{row.get(\"TICKER\", \"\")}</td>\n","            <td style=\"padding:8px;\">{row.get(\"Company Name\", \"\")}</td>\n","            <td style=\"padding:8px;\">{row.get(\"Industry\", \"\")}</td>\n","            <td style=\"padding:8px;\">{row.get(\"Price\", \"\")}</td>\n","            <td style=\"padding:8px;\">{row.get(\"SSS\", \"\")}</td>\n","            <td style=\"padding:8px;\">{format_change(row.get(\"SSS WoW\"), unit=\"\")}</td>\n","        </tr>\"\"\"\n","\n","    return ht_borrow_html, squeeze_html\n","\n","\n","# --- 2. HTML Generation ---\n","\n","def create_digest_html(content, table_html_tuple):\n","    \"\"\"\n","    Generates the final HTML for the digest by populating a template.\n","    \"\"\"\n","    if not content:\n","        return \"<h1>Error: Could not generate content.</h1>\"\n","\n","    ht_borrow_table, squeeze_table = table_html_tuple\n","\n","    # Helper function to format the market note percentage changes\n","    def format_market_note_change(value):\n","        color = '#16a34a' if value >= 0 else '#dc2626'\n","        sign = '+' if value >= 0 else ''\n","        return f'<span style=\"color:{color}; font-size:14px; font-weight:bold;\">({sign}{value:.2f}%)</span>'\n","\n","    market_notes = content.get('market_notes', {})\n","    avg_fee_bps = market_notes.get('avg_fee_bps', 'N/A')\n","    avg_fee_change = format_market_note_change(market_notes.get('avg_fee_change', 0))\n","    avg_util_percent = market_notes.get('avg_util_percent', 'N/A')\n","    avg_util_change = format_market_note_change(market_notes.get('avg_util_change', 0))\n","    on_loan_value = market_notes.get('on_loan_value', 'N/A')\n","    on_loan_value_change = format_market_note_change(market_notes.get('on_loan_value_change', 0))\n","    lendable_value = market_notes.get('lendable_value', 'N/A')\n","    lendable_value_change = format_market_note_change(market_notes.get('lendable_value_change', 0))\n","\n","    # Generate HTML for each headline section\n","    headlines_html = \"\"\n","    for headline in content.get('headlines', []):\n","        headlines_html += f\"\"\"\n","        <div style=\"margin-top:20px; padding-bottom: 15px; border-bottom: 1px solid #e2e8f0;\">\n","            <strong style=\"font-size:16px; color: #1e293b;\">{headline['title']}</strong>\n","            <p style=\"margin:8px 0 0; white-space: normal;\">{headline['description']}</p>\n","            <div style=\"margin-top:12px; padding:10px; background-color:#f0f9ff; border-left: 4px solid #0ea5e9; color:#334155;\">\n","                <strong style=\"color:#0c4a6e;\">What Our Data Shows:</strong> {headline['data_insight']}\n","            </div>\n","        </div>\n","        \"\"\"\n","    # Remove the last border\n","    if headlines_html.endswith('border-bottom: 1px solid #e2e8f0;\">'):\n","        headlines_html = headlines_html[:-len('border-bottom: 1px solid #e2e8f0;\">')] + '\">'\n","\n","    # Generate HTML for the key takeaways list\n","    takeaways_html = \"\".join([f'<li style=\"margin-bottom:8px;\">{item}</li>' for item in content.get('key_takeaways', [])])\n","\n","    # The main HTML template for the email\n","    html_template = f\"\"\"\n","<!DOCTYPE html>\n","<html lang=\"en\">\n","<head>\n","  <meta charset=\"UTF-8\">\n","  <title>EquiLend D&A Daily Digest - {DIGEST_DATE}</title>\n","</head>\n","<body style=\"margin:0; padding:0; font-family: Arial, sans-serif; background-color:#f1f5f9;\">\n","  <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"#f1f5f9\">\n","    <tr>\n","      <td align=\"center\">\n","        <table width=\"800\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"#ffffff\" style=\"margin:20px 0; border-radius:8px; overflow:hidden; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);\">\n","          <!-- Header -->\n","          <tr>\n","            <td bgcolor=\"#067db6\" style=\"padding:24px; text-align:center;\">\n","              <h1 style=\"margin:0; font-size:28px; color:#ffffff; font-weight:bold;\">EquiLend D&amp;A Daily Digest</h1>\n","              <p style=\"margin:5px 0 0; font-size:16px; color:#e0f2fe;\">{DIGEST_DATE}</p>\n","            </td>\n","          </tr>\n","          <!-- Content -->\n","          <tr>\n","            <td style=\"padding:24px; color:#334155; font-size:14px; line-height:1.6;\">\n","\n","              <!-- Market Notes -->\n","              <h2 style=\"font-size:20px; margin-top:0; margin-bottom:15px; color:#067db6; border-bottom: 2px solid #067db6; padding-bottom: 5px;\">&#x1F4BC; Market Notes</h2>\n","              <table width=\"100%\" cellpadding=\"10\" cellspacing=\"0\" border=\"0\" style=\"margin-bottom:25px; text-align:center;\">\n","                <tr>\n","                  <td width=\"50%\" style=\"background-color:#f8fafc; border-radius: 4px 0 0 4px;\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Average Fee</p>\n","                    <p style=\"margin:5px 0 0; font-size:20px; font-weight:bold; color:#334155;\">\n","                      {avg_fee_bps} bps {avg_fee_change}\n","                    </p>\n","                  </td>\n","                  <td width=\"50%\" style=\"background-color:#f8fafc; border-radius: 0 4px 4px 0;\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">On Loan Value</p>\n","                    <p style=\"margin:5px 0 0; font-size:20px; font-weight:bold; color:#334155;\">\n","                      ${on_loan_value} {on_loan_value_change}\n","                    </p>\n","                  </td>\n","                </tr>\n","                 <tr style=\"height: 10px;\"><td colspan=\"2\"></td></tr>\n","                <tr>\n","                  <td width=\"50%\" style=\"background-color:#f8fafc; border-radius: 4px 0 0 4px;\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Average Utilization</p>\n","                    <p style=\"margin:5px 0 0; font-size:20px; font-weight:bold; color:#334155;\">\n","                      {avg_util_percent}% {avg_util_change}\n","                    </p>\n","                  </td>\n","                  <td width=\"50%\" style=\"background-color:#f8fafc; border-radius: 0 4px 4px 0;\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Total Lendable Value</p>\n","                    <p style=\"margin:5px 0 0; font-size:20px; font-weight:bold; color:#334155;\">\n","                      ${lendable_value} {lendable_value_change}\n","                    </p>\n","                  </td>\n","                </tr>\n","              </table>\n","\n","              <!-- Headlines -->\n","              <h2 style=\"font-size:20px; margin-bottom:15px; color:#067db6; border-bottom: 2px solid #067db6; padding-bottom: 5px;\">&#x1F4F0; Major Headlines and What Our Data Shows</h2>\n","              {headlines_html}\n","\n","              <!-- Tables Section -->\n","              <h2 style=\"font-size:20px; margin:30px 0 15px; color:#dc2626; border-bottom: 2px solid #dc2626; padding-bottom: 5px;\">&#x1F525; Hot & Getting Hotter</h2>\n","              <div style=\"font-size:14px; font-style:italic; color:#334155; margin-bottom:10px;\">Top stocks with fees > 50,000 bps & rising</div>\n","              <table cellpadding=\"0\" cellspacing=\"0\" style=\"border-collapse:collapse; margin-bottom:25px; font-size:12px;\" width=\"100%\">\n","                <thead>\n","                  <tr bgcolor=\"#334155\" style=\"color:#ffffff; font-weight:bold; text-align:left;\">\n","                    <th style=\"padding:8px; white-space: nowrap;\">Ticker</th>\n","                    <th style=\"padding:8px; white-space: nowrap;\">Company Name</th>\n","                    <th style=\"padding:8px; white-space: nowrap;\">Industry</th>\n","                    <th style=\"padding:8px; white-space: nowrap;\">Price</th>\n","                    <th style=\"padding:8px; white-space: nowrap;\">Fee WoW (bps)</th>\n","                  </tr>\n","                </thead>\n","                <tbody>\n","                  {ht_borrow_table}\n","                </tbody>\n","              </table>\n","\n","              <h2 style=\"font-size:20px; margin:30px 0 15px; color:#16a34a; border-bottom: 2px solid #16a34a; padding-bottom: 5px;\">&#x1F52C; Market Technicals & Squeeze Metrics</h2>\n","              <table cellpadding=\"0\" cellspacing=\"0\" style=\"border-collapse:collapse; font-size:12px;\" width=\"100%\">\n","                <thead>\n","                  <tr bgcolor=\"#334155\" style=\"color:#ffffff; font-weight:bold; text-align:left;\">\n","                    <th style=\"padding:8px; white-space: nowrap;\">Ticker</th>\n","                    <th style=\"padding:8px; white-space: nowrap;\">Company Name</th>\n","                    <th style=\"padding:8px; white-space: nowrap;\">Industry</th>\n","                    <th style=\"padding:8px; white-space: nowrap;\">Price</th>\n","                    <th style=\"padding:8px; white-space: nowrap;\">SSS</th>\n","                    <th style=\"padding:8px; white-space: nowrap;\">SSS WoW</th>\n","                  </tr>\n","                </thead>\n","                <tbody>\n","                  {squeeze_table}\n","                </tbody>\n","              </table>\n","\n","              <!-- Key Takeaways -->\n","              <h2 style=\"font-size:20px; margin:30px 0 15px; color:#7c3aed; border-bottom: 2px solid #7c3aed; padding-bottom: 5px;\">&#x1F4A1; Key Takeaways</h2>\n","              <ul style=\"padding-left:20px; color:#334155; font-size:14px; margin:0; list-style-type: disc;\">\n","                {takeaways_html}\n","              </ul>\n","\n","            </td>\n","          </tr>\n","          <!-- Footer -->\n","          <tr>\n","            <td align=\"center\" style=\"padding:20px; font-size:12px; color:#64748b; background-color:#f8fafc;\">\n","              Source: EquiLend Data &amp; Analytics\n","            </td>\n","          </tr>\n","        </table>\n","      </td>\n","    </tr>\n","  </table>\n","</body>\n","</html>\n","    \"\"\"\n","    return html_template\n","\n","# --- Main Execution ---\n","if __name__ == \"__main__\":\n","    print(\"Starting daily digest generation...\")\n","\n","    # 1. Get content and data for the digest\n","    print(\"Loading content for August 5, 2025...\")\n","    digest_content = get_digest_content()\n","\n","    # 2. Generate HTML for the data tables\n","    print(\"Generating tables...\")\n","    table_html = get_tables_html()\n","\n","    # 3. Generate the final HTML file by populating the template\n","    print(\"Generating final HTML digest...\")\n","    final_html = create_digest_html(digest_content, table_html)\n","\n","    # 4. Save the HTML to a file\n","    with open(OUTPUT_HTML_PATH, 'w', encoding='utf-8') as f:\n","        f.write(final_html)\n","\n","    print(f\"\\nSuccessfully generated digest: {OUTPUT_HTML_PATH}\")"],"execution_count":2,"outputs":[{"output_type":"error","ename":"ModuleNotFoundError","evalue":"No module named 'digest_data'","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mModuleNotFoundError\u001b[0m                       Traceback (most recent call last)","\u001b[0;32m/tmp/ipython-input-3726515752.py\u001b[0m in \u001b[0;36m<cell line: 0>\u001b[0;34m()\u001b[0m\n\u001b[0;32m----> 1\u001b[0;31m \u001b[0;32mimport\u001b[0m \u001b[0mdigest_data\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m      2\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      3\u001b[0m \u001b[0;31m# --- 1. Content and Data ---\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      4\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      5\u001b[0m \u001b[0;32mdef\u001b[0m \u001b[0mget_digest_content\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;31mModuleNotFoundError\u001b[0m: No module named 'digest_data'","","\u001b[0;31m---------------------------------------------------------------------------\u001b[0;32m\nNOTE: If your import is failing due to a missing package, you can\nmanually install dependencies using either !pip or !apt.\n\nTo view examples of installing some common dependencies, click the\n\"Open Examples\" button below.\n\u001b[0;31m---------------------------------------------------------------------------\u001b[0m\n"],"errorDetails":{"actions":[{"action":"open_url","actionText":"Open Examples","url":"/notebooks/snippets/importing_libraries.ipynb"}]}}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"171764cf","executionInfo":{"status":"ok","timestamp":1754498721951,"user_tz":240,"elapsed":8386,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"40cb266e-8b1a-453a-96a2-6fa087339fd8"},"source":["!pip install python-docx"],"execution_count":3,"outputs":[{"output_type":"stream","name":"stdout","text":["Collecting python-docx\n","  Downloading python_docx-1.2.0-py3-none-any.whl.metadata (2.0 kB)\n","Requirement already satisfied: lxml>=3.1.0 in /usr/local/lib/python3.11/dist-packages (from python-docx) (5.4.0)\n","Requirement already satisfied: typing_extensions>=4.9.0 in /usr/local/lib/python3.11/dist-packages (from python-docx) (4.14.1)\n","Downloading python_docx-1.2.0-py3-none-any.whl (252 kB)\n","\u001b[?25l   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m0.0/253.0 kB\u001b[0m \u001b[31m?\u001b[0m eta \u001b[36m-:--:--\u001b[0m\r\u001b[2K   \u001b[91m━━━━━━━━━━━━━━━━\u001b[0m\u001b[90m╺\u001b[0m\u001b[90m━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m102.4/253.0 kB\u001b[0m \u001b[31m2.8 MB/s\u001b[0m eta \u001b[36m0:00:01\u001b[0m\r\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m253.0/253.0 kB\u001b[0m \u001b[31m4.2 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hInstalling collected packages: python-docx\n","Successfully installed python-docx-1.2.0\n"]}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":106},"id":"831eeb74","executionInfo":{"status":"error","timestamp":1754498988041,"user_tz":240,"elapsed":18,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"24ebedf2-fe07-48e4-8b13-b498cfb50654"},"source":["from docx import Document\n","import re\n","\n","def extract_digest_data_from_docx(docx_path):\n","    \"\"\"\n","    Extracts market notes, headlines, and key takeaways from the docx file.\n","    \"\"\"\n","    document = Document(docx_path)\n","    data = {\n","        'market_notes': {},\n","        'headlines': [],\n","        'key_takeaways': []\n","    }\n","\n","    # Simple state machine to track the current section\n","    current_section = None\n","    headline_title = None\n","    headline_description = []\n","    headline_data_insight = []\n","\n","    # Flags to help with parsing headlines\n","    is_description = False\n","    is_data_insight = False\n","\n","\n","    for paragraph in document.paragraphs:\n","        text = paragraph.text.strip()\n","\n","        # Identify sections based on headings or keywords\n","        if \"Market Notes\" in text:\n","            current_section = 'market_notes'\n","            # Reset headline flags when a new section is found\n","            is_description = False\n","            is_data_insight = False\n","            continue\n","        elif \"Major Headlines and What Our Data Shows\" in text:\n","            # Before starting headlines, save any pending headline data\n","            if headline_title:\n","                 data['headlines'].append({\n","                    'title': headline_title,\n","                    'description': ' '.join(headline_description).strip(),\n","                    'data_insight': ' '.join(headline_data_insight).strip()\n","                })\n","            # Reset for the next section\n","            headline_title = None\n","            headline_description = []\n","            headline_data_insight = []\n","            is_description = False\n","            is_data_insight = False\n","            current_section = 'headlines'\n","            continue\n","        elif \"Key Takeaways\" in text:\n","            # Before starting key takeaways, save any pending headline data\n","            if headline_title:\n","                 data['headlines'].append({\n","                    'title': headline_title,\n","                    'description': ' '.join(headline_description).strip(),\n","                    'data_insight': ' '.join(headline_data_insight).strip()\n","                })\n","            # Reset for the next section\n","            headline_title = None\n","            headline_description = []\n","            headline_data_insight = []\n","            is_description = False\n","            is_data_insight = False\n","            current_section = 'key_takeaways'\n","            continue\n","        elif text == \"\" and current_section != 'headlines':\n","            # Ignore empty lines unless in headlines section (for descriptions/insights)\n","            continue\n","\n","        # Process content based on the current section\n","        if current_section == 'market_notes':\n","            # Attempt to extract market notes data (this might need refinement based on exact doc structure)\n","            # Assuming a format like \"Average Fee: 42.27 bps (-40.1%)\"\n","            if ':' in text:\n","                key_value = text.split(':', 1)\n","                if len(key_value) == 2:\n","                    key = key_value[0].strip().lower().replace(' ', '_').replace('.', '')\n","                    value = key_value[1].strip()\n","\n","                    # Extract numerical value and change for specific keys\n","                    if key in ['average_fee', 'average_utilization', 'on_loan_value', 'total_lendable_value']:\n","                        match = re.match(r'([^()]+)\\s*(\\(.*\\))?', value)\n","                        if match:\n","                            num_value = match.group(1).strip()\n","                            change_text = match.group(2)\n","                            data['market_notes'][key.replace('average_', 'avg_').replace('total_', '').replace('_value', '_value')] = num_value\n","                            if change_text:\n","                                # Parse the change percentage\n","                                change_match = re.search(r'\\((.*?)\\)', change_text)\n","                                if change_match:\n","                                    try:\n","                                        # Convert to float, handling potential '+' or '-'\n","                                        change_value = float(change_match.group(1).replace('%', ''))\n","                                        data['market_notes'][key.replace('average_', 'avg_').replace('total_', '').replace('_value', '_value') + '_change'] = change_value\n","                                    except (ValueError, TypeError):\n","                                        data['market_notes'][key.replace('average_', 'avg_').replace('total_', '').replace('_value', '_value') + '_change'] = 0\n","                                else:\n","                                     data['market_notes'][key.replace('average_', 'avg_').replace('total_', '').replace('_value', '_value') + '_change'] = 0\n","                        else:\n","                             data['market_notes'][key.replace('average_', 'avg_').replace('total_', '').replace('_value', '_value')] = value\n","                             data['market_notes'][key.replace('average_', 'avg_').replace('total_', '').replace('_value', '_value') + '_change'] = 0\n","                    else:\n","                         data['market_notes'][key] = value\n","\n","\n","        elif current_section == 'headlines':\n","            if text.startswith(\"What Our Data Shows:\"):\n","                # End of a headline's description, start of data insight\n","                is_description = False\n","                is_data_insight = True\n","                headline_data_insight.append(text.replace(\"What Our Data Shows:\", \"\").strip())\n","            elif text and not headline_title:\n","                # Assuming the first non-empty line after the section header is the headline title\n","                headline_title = text\n","                is_description = True # The next lines should be the description\n","            elif is_description and text:\n","                 # If we are in the description section and the line is not empty, add it\n","                headline_description.append(text)\n","            elif is_data_insight and text:\n","                 # If we are in the data insight section and the line is not empty, add it\n","                headline_data_insight.append(text)\n","            elif not text and headline_title and (is_description or is_data_insight):\n","                # An empty line might indicate the end of a headline section (description or data insight)\n","                # If we have a title and were in description or data insight, this headline is complete\n","                 data['headlines'].append({\n","                    'title': headline_title,\n","                    'description': ' '.join(headline_description).strip(),\n","                    'data_insight': ' '.join(headline_data_insight).strip()\n","                })\n","                # Reset for the next headline\n","                headline_title = None\n","                headline_description = []\n","                headline_data_insight = []\n","                is_description = False\n","                is_data_insight = False\n","\n","\n","        elif current_section == 'key_takeaways':\n","             # Assuming each non-empty paragraph in this section is a takeaway\n","             if text: # Only add non-empty lines\n","                data['key_takeaways'].append(text)\n","\n","    # Add the last headline after the loop if there's one incomplete\n","    if headline_title:\n","         data['headlines'].append({\n","            'title': headline_title,\n","            'description': ' '.join(headline_description).strip(),\n","            'data_insight': ' '.join(headline_data_insight).strip()\n","        })\n","\n","\n","    return data\n","\n","# Define the path to the uploaded document\n","docx_file_path = '/content/daily_content.docx'\n","\n","# Extract the data\n","digest_data = extract_digest_data_from_docx(docx_file_path)\n","\n","# Print the extracted data to verify\n","import json\n","print(json.dumps(digest_data, indent=4))"],"execution_count":14,"outputs":[{"output_type":"error","ename":"IndentationError","evalue":"unindent does not match any outer indentation level (<tokenize>, line 133)","traceback":["\u001b[0;36m  File \u001b[0;32m\"<tokenize>\"\u001b[0;36m, line \u001b[0;32m133\u001b[0m\n\u001b[0;31m    headline_title = None\u001b[0m\n\u001b[0m    ^\u001b[0m\n\u001b[0;31mIndentationError\u001b[0m\u001b[0;31m:\u001b[0m unindent does not match any outer indentation level\n"]}]}],"metadata":{"colab":{"provenance":[]},"kernelspec":{"display_name":"Python 3","name":"python3"}},"nbformat":4,"nbformat_minor":0}