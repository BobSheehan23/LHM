{"cells":[{"cell_type":"code","source":["import pandas as pd\n","from datetime import datetime\n","import re\n","import numpy as np\n","\n","# --- Configuration ---\n","# The output file will be named with today's date.\n","OUTPUT_HTML_PATH = f\"equilend_daily_digest_{datetime.now().strftime('%Y_%m_%d')}.html\"\n","\n","# --- 1. Hardcoded Content and Data ---\n","\n","def get_hardcoded_content():\n","    \"\"\"\n","    Returns all the text content for the digest.\n","    This section can be updated with the day's specific narrative content.\n","    \"\"\"\n","    content = {\n","        'market_notes': {\n","            'avg_fee_bps': '44.8',\n","            'avg_fee_change': 1.13,\n","            'avg_util_percent': '7.15',\n","            'avg_util_change': 1.43,\n","            'on_loan_value': '3.07T',\n","            'on_loan_value_change': 1.65,\n","            'lendable_value': '42.92T',\n","            'lendable_value_change': 0.21\n","        },\n","        'headlines': [\n","            {\n","                'title': 'Trump Announces Trade Deal with Japan:',\n","                'description': 'The US President has announced a trade deal with Japan that sets tariffs on imports at 15%. This includes automobiles, which was the biggest component of deficit between the countries, originally set at a 25% rate. In turn, manufacturers Nikkei and Toyota have seen shares surge overnight following the announcement.',\n","                'data_insight': 'Japanese motor giants, Nissan have seen high levels of volatility throughout the negotiations. Initially, short interest appeared to fall in the months that followed the ‘Liberation Day’ tariff announcement. However, since the start of this month, borrowing cost and On Loan Quantity have rocketed, with fees going from 20 bps in early July to ~70 bps this week and likewise the number of shares on loan going from 209 million to 630 million this week. This surge could indicate that hedge funds and other institutions are actively positioning themselves for the deal’s final implementation and potential market shifts.'\n","            },\n","            {\n","                'title': 'Intensification of Armenia-Azerbaijan Border Ceasefire Violations',\n","                'description': 'Reports indicate an intensification of ceasefire violations along the Armenia-Azerbaijan border in recent weeks, raising concerns about a potential resurgence of conflict. This comes as the two nations approach a possible peace agreement in 2026. Heightened tensions in this region could contribute to broader geopolitical instability and potentially impact energy transit routes.',\n","                'data_insight': 'Heightened geopolitical risk in the region may be prompting investors to hedge against potential energy disruptions. Our data for New Fortress Energy (NFE), an energy infrastructure company, shows an increase in the quantity of shares on loan of 573,689 in one day. In addition, we see an increase in on-loan quantity for Predator Oil & Gas (PRD LN) of 2,810,600 shares in the past week.'\n","            },\n","            {\n","                'title': 'Plant-based ‘Meat’ Market set to Expand:',\n","                'description': 'The global plant-based meat market is set to grow from $10.2 billion in 2025 to $45 billion by 2034, according to market reports earlier this month. Innovation in the market and strategic partnerships are leading this surge as ‘Ethical consumerism’ gains increasing popularity.',\n","                'data_insight': 'US-based, Beyond Meat Inc. are an example of a company who have emerged with the rise in plant-based food alternatives. Our data highlights the hedge-fund interest that has been taken in the company with On Loan Quantity up 7 million shares to 27 million for July so far from the same month last year. Borrowing costs, however, are showing conflicting trends, fluctuating this year between 6,700 bps and 2,100 bps with the average fee for July so far of 3,900 bps being significantly down from last year at 8,500 bps.'\n","            }\n","        ],\n","        'key_takeaways': [\n","            \"A new US-Japan trade deal appears to be shifting sentiment around Japanese automakers, though a recent surge in borrowing activity for names like Nissan could signal that some investors are hedging against the deal's long-term stability.\",\n","            \"Heightened geopolitical risk in the Caucasus region may be driving hedging in the energy sector, as indicated by rising short interest in related energy infrastructure and exploration companies.\",\n","            \"While the plant-based meat market shows strong growth potential, conflicting signals in borrowing costs and on-loan quantity for key players like Beyond Meat suggest investor uncertainty about valuations and competition.\"\n","        ]\n","    }\n","    return content\n","\n","def get_hardcoded_tables_html():\n","    \"\"\"\n","    Returns HTML for the two data tables using the hardcoded data.\n","    \"\"\"\n","    # Data for \"Hot & Getting Hotter\"\n","    ht_borrow_data = [\n","        {\"TICKER\": \"WBUY\", \"Company Name\": \"WEBUY GLOBAL LTD COM\", \"Industry\": \"Food and Staples Retaili\", \"Price\": \"$7.39\", \"Fee Band\": \"90,000+\", \"Fee WoW (bps)\": \"4463\"},\n","        {\"TICKER\": \"SLRX\", \"Company Name\": \"SALARIUS PHARMACEUTI\", \"Industry\": \"Biotechnology\", \"Price\": \"$0.70\", \"Fee Band\": \"80,000+\", \"Fee WoW (bps)\": \"6268\"},\n","        {\"TICKER\": \"CYCC\", \"Company Name\": \"CYCLACEL PHARMACEUT\", \"Industry\": \"Biotechnology\", \"Price\": \"$14.00\", \"Fee Band\": \"60,000+\", \"Fee WoW (bps)\": \"13962\"},\n","        {\"TICKER\": \"GITS\", \"Company Name\": \"GLOBAL INTERACTIVE TE\", \"Industry\": \"Interactive Media & Servi\", \"Price\": \"$2.86\", \"Fee Band\": \"50,000+\", \"Fee WoW (bps)\": \"303\"},\n","        {\"TICKER\": \"NUWE\", \"Company Name\": \"NUWELLIS INC COM (POS\", \"Industry\": \"Health Care Equipment &\", \"Price\": \"$13.83\", \"Fee Band\": \"50,000+\", \"Fee WoW (bps)\": \"47846\"},\n","    ]\n","\n","    # Data for \"Market Technicals & Squeeze Metrics\"\n","    squeeze_data = [\n","        {\"TICKER\": \"VOR\", \"Company Name\": \"VOR BIOPHARMA\", \"Industry\": \"Biotechnology\", \"Price\": \"$2.05\", \"SSS\": 89, \"SSS Week Diff\": 1},\n","        {\"TICKER\": \"WOLF\", \"Company Name\": \"WOLFSPEED INC\", \"Industry\": \"Semiconductors & Equip\", \"Price\": \"$1.42\", \"SSS\": 85, \"SSS Week Diff\": 57},\n","        {\"TICKER\": \"ABVX\", \"Company Name\": \"ABIVAX SPON\", \"Industry\": \"Biotechnology\", \"Price\": \"$10.00\", \"SSS\": 82, \"SSS Week Diff\": 49},\n","        {\"TICKER\": \"AEHR\", \"Company Name\": \"AEHR TEST SYSTEMS\", \"Industry\": \"Semiconductors & Equip\", \"Price\": \"$20.10\", \"SSS\": 76, \"SSS Week Diff\": 33},\n","        {\"TICKER\": \"IOVA\", \"Company Name\": \"IOVANCE BIOTHERAPEUT\", \"Industry\": \"Biotechnology\", \"Price\": \"$3.13\", \"SSS\": 76, \"SSS Week Diff\": 50},\n","    ]\n","\n","    def format_change(value, unit=' BPS'):\n","        try:\n","            cleaned_value = str(value).replace(',', '').strip()\n","            val = float(cleaned_value)\n","            color = '#16a34a' if val > 0 else '#dc2626'\n","            sign = '+' if val > 0 else ''\n","            return f'<span style=\"color:{color}; font-size:14px;\">{sign}{val:,.0f}{unit}</span>'\n","        except (ValueError, TypeError):\n","            return str(value).strip() if pd.notna(value) else ''\n","\n","    ht_borrow_html = \"\"\n","    for row in ht_borrow_data:\n","        ht_borrow_html += f\"\"\"\n","        <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","            <td style=\"padding:4px 8px;\">{row.get(\"TICKER\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Company Name\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Industry\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Price\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Fee Band\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{format_change(row.get(\"Fee WoW (bps)\"))}</td>\n","        </tr>\"\"\"\n","\n","    squeeze_html = \"\"\n","    for row in squeeze_data:\n","        squeeze_html += f\"\"\"\n","        <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","            <td style=\"padding:4px 8px;\">{row.get(\"TICKER\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Company Name\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Industry\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Price\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"SSS\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{format_change(row.get(\"SSS Week Diff\"), unit=\"\")}</td>\n","        </tr>\"\"\"\n","\n","    return ht_borrow_html, squeeze_html\n","\n","\n","# --- 2. HTML Generation ---\n","\n","def create_digest_html(content, table_html_tuple):\n","    \"\"\"\n","    Generates the final HTML for the digest by populating a template.\n","    \"\"\"\n","    if not content:\n","        return \"<h1>Error: Could not generate content.</h1>\"\n","\n","    ht_borrow_table, squeeze_table = table_html_tuple\n","\n","    def format_market_note_change(value):\n","        color = '#16a34a' if value > 0 else '#dc2626'\n","        sign = '+' if value > 0 else ''\n","        return f'<span style=\"color:{color}; font-size:14px;\">{sign}{value:.2f}%</span>'\n","\n","    market_notes = content.get('market_notes', {})\n","    avg_fee_bps = market_notes.get('avg_fee_bps', 'N/A')\n","    avg_fee_change = format_market_note_change(market_notes.get('avg_fee_change', 0))\n","    avg_util_percent = market_notes.get('avg_util_percent', 'N/A')\n","    avg_util_change = format_market_note_change(market_notes.get('avg_util_change', 0))\n","    on_loan_value = market_notes.get('on_loan_value', 'N/A')\n","    on_loan_value_change = format_market_note_change(market_notes.get('on_loan_value_change', 0))\n","    lendable_value = market_notes.get('lendable_value', 'N/A')\n","    lendable_value_change = format_market_note_change(market_notes.get('lendable_value_change', 0))\n","\n","    headlines_html = \"\"\n","    for headline in content.get('headlines', []):\n","        headlines_html += f\"\"\"\n","        <div style=\"margin-top:20px;\">\n","            <strong style=\"font-size:16px;\">{headline['title']}</strong>\n","            <p style=\"margin:5px 0 0; white-space: pre-wrap;\">{headline['description']}</p>\n","            <ul style=\"margin:10px 0 0; padding-left:20px; color:#334155; list-style-type: disc;\">\n","              <li><strong>What Our Data Shows:</strong> {headline['data_insight']}</li>\n","            </ul>\n","        </div>\n","        \"\"\"\n","\n","    takeaways_html = \"\".join([f\"<li>{item}</li>\" for item in content.get('key_takeaways', [])])\n","\n","    html_template = f\"\"\"\n","<!DOCTYPE html>\n","<html lang=\"en\">\n","<head>\n","  <meta charset=\"UTF-8\">\n","  <title>EquiLend D&A Daily Digest - {datetime.now().strftime('%B %d, %Y')}</title>\n","</head>\n","<body style=\"margin:0; padding:0; font-family: Arial, sans-serif; background-color:#f1f5f9;\">\n","  <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"#f1f5f9\">\n","    <tr>\n","      <td align=\"center\">\n","        <table width=\"800\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"#ffffff\" style=\"margin:20px 0; border-radius:4px; overflow:hidden;\">\n","          <!-- Header -->\n","          <tr>\n","            <td bgcolor=\"#0284c7\" style=\"padding:20px; text-align:center;\">\n","              <h1 style=\"margin:0; font-size:24px; color:#ffffff;\">EquiLend D&amp;A Daily Digest</h1>\n","              <p style=\"margin:5px 0 0; font-size:16px; color:#bae6fd;\">{datetime.now().strftime('%B %d, %Y')}</p>\n","            </td>\n","          </tr>\n","          <!-- Content -->\n","          <tr>\n","            <td style=\"padding:20px; color:#333333; font-size:14px; line-height:1.5;\">\n","\n","              <!-- Market Notes -->\n","              <h2 style=\"font-size:18px; margin-bottom:10px; color:#0284c7;\">&#x1F4BC; Market Notes</h2>\n","              <table width=\"100%\" cellpadding=\"5\" cellspacing=\"0\" border=\"0\" bgcolor=\"#f8fafc\" style=\"margin-bottom:20px;\">\n","                <tr>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Average Fee</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      {avg_fee_bps} bps {avg_fee_change}\n","                    </p>\n","                  </td>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Average Utilization</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      {avg_util_percent}% {avg_util_change}\n","                    </p>\n","                  </td>\n","                </tr>\n","                <tr>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">On Loan Value</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      ${on_loan_value} {on_loan_value_change}\n","                    </p>\n","                  </td>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Total Lendable Value</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      ${lendable_value} {lendable_value_change}\n","                    </p>\n","                  </td>\n","                </tr>\n","              </table>\n","\n","              <!-- Headlines -->\n","              <h2 style=\"font-size:18px; margin-bottom:10px; color:#0284c7;\">&#x1F4F0; Major Headlines and What Our Data Shows</h2>\n","              {headlines_html}\n","\n","              <!-- Tables Section -->\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F525; Hot & Getting Hotter</h2>\n","              <table cellpadding=\"0\" cellspacing=\"0\" border=\"1\" style=\"border-collapse:collapse; margin-bottom:20px; border-color:#dddddd; font-size:12px;\" width=\"100%\">\n","                <thead>\n","                  <tr bgcolor=\"#0284c7\" style=\"color:#ffffff; font-weight:bold; text-align:left;\">\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Ticker</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Company Name</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Industry</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Price</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Fee Band</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Fee WoW (bps)</th>\n","                  </tr>\n","                </thead>\n","                <tbody>\n","                  {ht_borrow_table}\n","                </tbody>\n","              </table>\n","\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F52C; Market Technicals & Squeeze Metrics</h2>\n","              <table cellpadding=\"0\" cellspacing=\"0\" border=\"1\" style=\"border-collapse:collapse; border-color:#dddddd; font-size:12px;\" width=\"100%\">\n","                <thead>\n","                  <tr bgcolor=\"#0284c7\" style=\"color:#ffffff; font-weight:bold; text-align:left;\">\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Ticker</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Company Name</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Industry</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Price</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">SSS</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">SSS Week Diff</th>\n","                  </tr>\n","                </thead>\n","                <tbody>\n","                  {squeeze_table}\n","                </tbody>\n","              </table>\n","\n","              <!-- Key Takeaways -->\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F4A1; Key Takeaways</h2>\n","              <ul style=\"padding-left:20px; color:#334155; font-size:14px; margin:0;\">\n","                {takeaways_html}\n","              </ul>\n","\n","            </td>\n","          </tr>\n","          <!-- Footer -->\n","          <tr>\n","            <td align=\"center\" style=\"padding:10px; font-size:12px; color:#64748b;\">\n","              Source: EquiLend Data &amp; Analytics\n","            </td>\n","          </tr>\n","        </table>\n","      </td>\n","    </tr>\n","  </table>\n","</body>\n","</html>\n","    \"\"\"\n","    return html_template\n","\n","# --- Main Execution ---\n","if __name__ == \"__main__\":\n","    print(\"Starting daily digest generation...\")\n","\n","    # 1. Get hardcoded content\n","    print(\"Loading hardcoded content...\")\n","    hardcoded_content = get_hardcoded_content()\n","\n","    # 2. Get HTML for the hardcoded tables\n","    print(\"Generating tables from hardcoded data...\")\n","    table_html = get_hardcoded_tables_html()\n","\n","    # 3. Generate the final HTML file\n","    print(\"Generating final HTML digest...\")\n","    final_html = create_digest_html(hardcoded_content, table_html)\n","\n","    # 4. Save the HTML to a file\n","    with open(OUTPUT_HTML_PATH, 'w', encoding='utf-8') as f:\n","        f.write(final_html)\n","\n","    print(f\"\\nSuccessfully generated digest: {OUTPUT_HTML_PATH}\")\n","    print(\"This version is fully hardcoded and does not depend on external files.\")"],"outputs":[{"output_type":"stream","name":"stdout","text":["Starting daily digest generation...\n","Loading hardcoded content...\n","Generating tables from hardcoded data...\n","Generating final HTML digest...\n","\n","Successfully generated digest: equilend_daily_digest_2025_07_24.html\n","This version is fully hardcoded and does not depend on external files.\n"]}],"execution_count":1,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"bH7DrwN5d40q","executionInfo":{"status":"ok","timestamp":1753361140168,"user_tz":240,"elapsed":1279,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"220109ff-fdab-4f50-ebb3-74d4c6977b9c"}}],"metadata":{"colab":{"provenance":[]},"kernelspec":{"display_name":"Python 3","name":"python3"}},"nbformat":4,"nbformat_minor":0}