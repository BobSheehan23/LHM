{"cells":[{"cell_type":"code","source":["import http.server\n","import socketserver\n","import webbrowser\n","import os\n","import base64\n","import requests\n","\n","# --- Script Configuration ---\n","FILENAME = \"treasury_foundations_presentation_full.html\"\n","PORT = 8000\n","# --------------------------\n","\n","# Dictionary of all 14 chart images to download.\n","chart_urls = {\n","    \"auction_analysis\": \"https://i.imgur.com/unnamed (6).png\",\n","    \"buyer_composition\": \"https://i.imgur.com/unnamed (5).png\",\n","    \"foreign_participation\": \"https://i.imgur.com/unnamed (4).png\", # Left side of the dual chart\n","    \"dealer_absorption\": \"https://i.imgur.com/unnamed (4).png\", # Right side of the dual chart\n","    \"gross_vs_net\": \"https://i.imgur.com/unnamed (3).jpg\",\n","    \"accumulation_momentum\": \"https://i.imgur.com/unnamed (1).png\",\n","    \"stablecoin_holdings\": \"https://i.imgur.com/unnamed (3).png\",\n","    \"bills_vs_bonds\": \"https://i.imgur.com/unnamed (2).png\",\n","    \"supply_surge\": \"https://i.imgur.com/t1.jpg\",\n","    \"stress_scenarios\": \"https://i.imgur.com/unnamed (8).png\",\n","    \"stress_dashboard\": \"https://i.imgur.com/unnamed.jpg\",\n","    \"z_score\": \"https://i.imgur.com/unnamed (1).jpg\",\n","    \"rolling_volatility\": \"https://i.imgur.com/unnamed (2).jpg\",\n","    \"position_changes\": \"https://i.imgur.com/unnamed.png\" # This seems to be a duplicate of accumulation, will use for context\n","}\n","\n","def get_image_as_base64(url):\n","    \"\"\"Downloads an image and returns it as a Base64 encoded string.\"\"\"\n","    try:\n","        response = requests.get(url, timeout=15)\n","        response.raise_for_status()\n","        encoded_string = base64.b64encode(response.content).decode('utf-8')\n","        # The mime type can be derived from the URL or response headers if needed, assuming png for simplicity\n","        return f\"data:image/png;base64,{encoded_string}\"\n","    except requests.RequestException as e:\n","        print(f\"‚ùå Error fetching image {url}: {e}\")\n","        return \"\"\n","\n","print(\"Downloading and embedding chart images...\")\n","base64_images = {name: get_image_as_base64(url) for name, url in chart_urls.items()}\n","print(\"‚úÖ All charts ready.\")\n","\n","# --- Slide Content ---\n","slides_content = [\n","    # Slide 1: Title\n","    \"\"\"\n","    <div style=\"text-align: center;\">\n","        <h1 style=\"font-size: 42px; font-weight: 700; color: #00529B; border-bottom: 2px solid #00529B; padding-bottom: 1rem; margin-bottom: 2rem;\">Treasury Market: Weakening Foundations?</h1>\n","        <p style=\"font-size: 24px; color: #4b5563; margin-top: 1rem;\">An Analysis of Supply, Demand, and Dealer Capacity</p>\n","        <p style=\"font-size: 20px; color: #6b7280; margin-top: 3rem;\">Bob Sheehan, CFA, CMT</p>\n","        <p style=\"font-size: 16px; color: #9ca3af;\">VP, Market Strategy & Research</p>\n","    </div>\n","    \"\"\",\n","    # Slide 2: Auction Weakness\n","    f\"\"\"\n","    <h2 class=\"slide-title\">The Canary: A Tailed Auction</h2>\n","    <table class=\"slide-table\"><tr><td class=\"chart-cell\"><img src=\"{base64_images['auction_analysis']}\" alt=\"Auction Analysis\" class=\"chart-img\"></td><td class=\"text-cell\"><p><strong>The Signal:</strong> The August 6th 10-year auction tailed by 1.1 basis points, the first tail in six months. The Treasury expected to pay 4.244% but had to offer 4.255% to clear the $42B auction.</p><p><strong>Waning Demand:</strong> Foreign buyers (indirects) retreated to just 63.8% of the auction, well below the 70%+ average. This forced Primary Dealers to absorb 16.8% of the issue.</p><p><strong>A Persistent Trend:</strong> 45% of Treasury auctions in 2025 have tailed, suggesting a persistent weakness is emerging at the long end of the curve.</p></td></tr></table>\n","    \"\"\",\n","    # Slide 3: Changing Buyer Base\n","    f\"\"\"\n","    <h2 class=\"slide-title\">The Changing Buyer Base</h2>\n","    <table class=\"slide-table\"><tr><td class=\"chart-cell\"><img src=\"{base64_images['buyer_composition']}\" alt=\"Buyer Composition\" class=\"chart-img\"></td><td class=\"text-cell\"><p><strong>The Shift:</strong> The composition of Treasury buyers has changed significantly since 2020. Foreign central banks have reduced their market share from 45% to just 28% today.</p><p><strong>Who's Picking Up the Slack?</strong> Domestic banks have increased their share from 20% to 35%, and Primary Dealers have grown from 15% to 25%.</p><p><strong>The Problem:</strong> These are not natural, long-term holders. They are intermediaries being forced to warehouse risk as traditional buyers retreat.</p></td></tr></table>\n","    \"\"\",\n","    # Slide 4: Foreign Retreat\n","    f\"\"\"\n","    <h2 class=\"slide-title\">Foreign Participation Declines, Dealers Absorb More</h2>\n","    <table class=\"slide-table\"><tr><td class=\"chart-cell\"><img src=\"{base64_images['foreign_participation']}\" alt=\"Foreign Participation\" class=\"chart-img\"></td></tr></table>\n","    \"\"\",\n","    # Slide 5: Gross vs Net\n","    f\"\"\"\n","    <h2 class=\"slide-title\">Dealer Inventory: Gross vs. Net</h2>\n","    <table class=\"slide-table\"><tr><td class=\"chart-cell\"><img src=\"{base64_images['gross_vs_net']}\" alt=\"Gross vs Net Positions\" class=\"chart-img\"></td><td class=\"text-cell\"><p><strong>Gross Inventory Surges:</strong> Dealers' gross Treasury inventory has surged to ~$120B, approaching highs seen before the Sep. 2019 repo crisis. This is the collateral they must finance daily.</p><p><strong>Net Position is Flat:</strong> Their net position (longs minus shorts) is nearly flat, indicating they are well-hedged and not making a large directional bet.</p><p><strong>The Real Risk:</strong> The risk isn't directional; it's a mechanical funding risk. The massive gross inventory creates immense demand for repo funding, making the system vulnerable.</p></td></tr></table>\n","    \"\"\",\n","    # Slide 6: Accumulation Momentum\n","    f\"\"\"\n","    <h2 class=\"slide-title\">Dealer Accumulation Momentum</h2>\n","    <table class=\"slide-table\"><tr><td class=\"chart-cell\"><img src=\"{base64_images['accumulation_momentum']}\" alt=\"Accumulation Momentum\" class=\"chart-img\"></td><td class=\"text-cell\"><p><strong>Measuring the Flow:</strong> This chart compares the 26-week moving average of dealer inventory to the 52-week moving average.</p><p><strong>Rapid Accumulation:</strong> The pink zones highlight periods of rapid accumulation, where the short-term trend exceeds the long-term. We are currently in such a period.</p><p><strong>A Leading Indicator:</strong> This momentum reveals hidden stress. Sustained periods of rapid accumulation, like in 2024-25, have historically preceded market instability.</p></td></tr></table>\n","    \"\"\",\n","     # Slide 7: 3-Month Position Changes\n","    f\"\"\"\n","    <h2 class=\"slide-title\">3-Month Position Changes: Back in Accumulation Mode</h2>\n","    <table class=\"slide-table\"><tr><td class=\"chart-cell\"><img src=\"{base64_images['position_changes']}\" alt=\"3-Month Position Changes\" class=\"chart-img\"></td><td class=\"text-cell\"><p><strong>Short-Term View:</strong> Looking at the 3-month change confirms the recent shift. After shedding inventory through late 2024, dealers have been consistently adding to their positions throughout 2025.</p><p><strong>Accelerating Trend:</strong> The pace of accumulation has increased each quarter in 2025, culminating in the latest update showing a significant increase in inventory being absorbed.</p></td></tr></table>\n","    \"\"\",\n","    # Slide 8: Stablecoin Demand\n","    f\"\"\"\n","    <h2 class=\"slide-title\">The Stablecoin Factor: A New Source of Demand</h2>\n","    <table class=\"slide-table\"><tr><td class=\"chart-cell\"><img src=\"{base64_images['stablecoin_holdings']}\" alt=\"Stablecoin Holdings\" class=\"chart-img\"></td><td class=\"text-cell\"><p><strong>A Concentrated Buyer:</strong> A new, significant buyer has emerged. Stablecoin issuers now hold over $180B in T-Bills, with Tether alone holding $125B.</p><p><strong>Regulatory Arbitrage?</strong> These entities must back their tokens with ultra-safe, liquid assets, creating massive demand for T-bills (typically 90 days or less).</p><p><strong>Fragile Demand:</strong> This demand is a function of the crypto market, not fundamentals. A reversal in crypto or a regulatory crackdown could cause this demand to vanish quickly.</p></td></tr></table>\n","    \"\"\",\n","    # Slide 9: Bills vs Bonds\n","    f\"\"\"\n","    <h2 class=\"slide-title\">A Tale of Two Markets: Bills vs. Bonds</h2>\n","    <table class=\"slide-table\"><tr><td class=\"chart-cell\"><img src=\"{base64_images['bills_vs_bonds']}\" alt=\"Bills vs Bonds\" class=\"chart-img\"></td></tr><tr><td colspan=\"2\" style=\"font-size: 15px; text-align: center; padding-top: 15px;\"><p>A clear divergence: Demand for short-term T-Bills is robust, driven by collateral and stablecoin needs, while demand for long-term bonds is weakening, shown by falling bid-to-cover ratios.</p></td></tr></table>\n","    \"\"\",\n","    # Slide 10: Supply Surge\n","    f\"\"\"\n","    <h2 class=\"slide-title\">The Oncoming Supply Wave</h2>\n","    <table class=\"slide-table\"><tr><td class=\"chart-cell\"><img src=\"{base64_images['supply_surge']}\" alt=\"Supply Surge\" class=\"chart-img\"></td><td class=\"text-cell\"><p><strong>Issuance is Accelerating:</strong> The supply of new Treasury debt is compounding the demand problem. Net issuance is projected to hit $1.5T in the second half of 2025 alone.</p><p><strong>Poor Timing:</strong> This surge in supply is arriving at the precise moment when traditional foreign buyers are retreating and dealers are hitting their balance sheet constraints.</p></td></tr></table>\n","    \"\"\",\n","    # Slide 11: Stress Scenarios\n","    f\"\"\"\n","    <h2 class=\"slide-title\">Potential Market Impact Under Stress</h2>\n","    <table class=\"slide-table\"><tr><td class=\"chart-cell\"><img src=\"{base64_images['stress_scenarios']}\" alt=\"Stress Scenarios\" class=\"chart-img\"></td><td class=\"text-cell\"><p><strong>Quantifying the Risk:</strong> This chart models the potential impact as dealer inventory (a proxy for market stress) increases.</p><p><strong>Moderate Stress ($150B):</strong> If foreign demand continues to decline, 10-year yields could reach 4.75% - 5.00%.</p><p><strong>Severe Stress ($200B+):</strong> A severe scenario could push yields above 5% and lead to a violent bear-steepening of the yield curve.</p></td></tr></table>\n","    \"\"\",\n","    # Slide 12: Stress Dashboard\n","    f\"\"\"\n","    <h2 class=\"slide-title\">Treasury Market Stress Dashboard</h2>\n","    <table class=\"slide-table\"><tr><td class=\"chart-cell\" colspan=\"2\"><img src=\"{base64_images['stress_dashboard']}\" alt=\"Stress Dashboard\" class=\"chart-img\" style=\"max-height: 500px;\"></td></tr></table>\n","    \"\"\",\n","    # Slide 13: Z-Score\n","    f\"\"\"\n","    <h2 class=\"slide-title\">Dealer Balance Sheet Stress (Z-Score)</h2>\n","    <table class=\"slide-table\"><tr><td class=\"chart-cell\"><img src=\"{base64_images['z_score']}\" alt=\"Z-Score\" class=\"chart-img\"></td><td class=\"text-cell\"><p><strong>Normalizing the Data:</strong> This chart shows the Z-score of dealer net Treasury positions, measuring how many standard deviations the current position is from its historical average.</p><p><strong>Interpreting the Signal:</strong> Values between +2 and -2 are normal. Spikes beyond indicate significant stress.</p><p><strong>Current Reading:</strong> The current Z-score is well within the normal range, indicating that on a statistically normalized basis, dealer balance sheets are not yet at a breaking point.</p></td></tr></table>\n","    \"\"\",\n","    # Slide 14: Rolling Volatility\n","    f\"\"\"\n","    <h2 class=\"slide-title\">Rolling Volatility of Net Positions</h2>\n","    <table class=\"slide-table\"><tr><td class=\"chart-cell\"><img src=\"{base64_images['rolling_volatility']}\" alt=\"Rolling Volatility\" class=\"chart-img\"></td><td class=\"text-cell\"><p><strong>Measuring Instability:</strong> This chart tracks the rolling 13-week (short-term) and 52-week (long-term) volatility of dealer net positions.</p><p><strong>Spikes in Volatility:</strong> Periods where short-term vol (purple) spikes above long-term vol (grey) indicate market instability.</p><p><strong>Current Reading:</strong> Short-term volatility is elevated and has crossed above the long-term trend, suggesting the *rate of change* in positioning is becoming erratic.</p></td></tr></table>\n","    \"\"\",\n","    # Slide 15: Conclusion\n","    \"\"\"\n","    <h2 class=\"slide-title\">Conclusion & Key Takeaways</h2>\n","    <div style=\"font-size: 18px; line-height: 1.8; max-width: 800px; margin: auto; padding-top: 2rem;\"><ul style=\"list-style-type: disc; padding-left: 30px; text-align: left;\"><li style=\"margin-bottom: 20px;\"><strong>Weakening Foundations:</strong> Multiple data points indicate a structural weakening in the demand for long-term U.S. Treasury debt.</li><li style=\"margin-bottom: 20px;\"><strong>Dealer Constraints are Key:</strong> Primary dealers, the market's backstop, are absorbing massive duration and approaching their regulatory limits.</li><li style=\"margin-bottom: 20px;\"><strong>Supply is a Major Headwind:</strong> An accelerating wave of Treasury supply is set to hit the market just as demand is faltering.</li><li style=\"margin-bottom: 20px;\"><strong>Increased Risk of a \"Gap Higher\" in Yields:</strong> The combination of these factors increases the probability of a disorderly move higher in long-term interest rates.</li></ul></div>\n","    \"\"\"\n","]\n","\n","\n","# --- HTML and Server Boilerplate ---\n","final_slides_html = \"\"\n","for i, content in enumerate(slides_content):\n","    active_class = \"active\" if i == 0 else \"\"\n","    final_slides_html += f'<section class=\"slide {active_class}\">{content}</section>\\n'\n","\n","full_html_doc = f\"\"\"\n","<!DOCTYPE html><html lang=\"en\"><head><meta charset=\"UTF-8\"><meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"><title>Presentation Preview</title><style>body{{font-family: 'Inter', Arial, sans-serif;background-color: #374151;margin: 0;display: flex;justify-content: center;align-items: center;height: 100vh;}}#presentation-container{{width: 11in; height: 8.5in; position: relative;box-shadow: 0 10px 25px rgba(0,0,0,0.2);}}.slide{{display: none;width: 100%;height: 100%;padding: 0.5in;background-color: #FFFFFF;color: #1F2937;flex-direction: column;justify-content: flex-start;align-items: center;box-sizing: border-box;position: absolute;}}.slide.active{{display: flex;}}.slide-title{{font-size: 28px;font-weight: 700;color: #00529B;border-bottom: 2px solid #00529B;padding-bottom: 0.5rem;margin-bottom: 1rem;width: 100%;text-align: left;}}.slide-table{{width: 100%;height: 100%;border-spacing: 20px;border-collapse: separate;}}.chart-cell{{width: 50%;vertical-align: middle;text-align: center;}}.text-cell{{width: 50%;vertical-align: middle;font-size: 14px;line-height: 1.6;padding: 0 1rem;}}.text-cell p{{margin-bottom: 1em;}}.chart-img{{max-width: 100%;max-height: 100%;height: auto;border: 1px solid #e5e7eb;object-fit: contain;}}#nav-controls{{position: fixed;bottom: 20px;right: 20px;display: flex;gap: 10px; z-index: 100;}}.nav-btn{{background-color: #4B5563;color: white;border: none;border-radius: 50%;width: 50px;height: 50px;font-size: 24px;font-weight: bold;cursor: pointer;box-shadow: 0 4px 6px rgba(0,0,0,0.1);transition: background-color 0.2s;}}.nav-btn:hover{{background-color: #00529B;}}.slide-footer{{position: absolute;bottom: 0.5in;left: 0.5in;right: 0.5in;display: flex;justify-content: space-between;font-size: 12px;color: #6B7280;}}.logo{{font-weight: 700;color: #00529B;}}</style></head><body><div id=\"presentation-container\">{final_slides_html}</div><div id=\"nav-controls\"><button id=\"prevBtn\" class=\"nav-btn\">&lt;</button><button id=\"nextBtn\" class=\"nav-btn\">&gt;</button></div><script>const slides = document.querySelectorAll('.slide');const totalSlides = slides.length;let currentSlide = 0;function showSlide(index){{currentSlide=(index + totalSlides)%totalSlides;slides.forEach((slide, i) => {{slide.classList.toggle('active', i === currentSlide);}}); const slideElement = slides[currentSlide]; if (!slideElement.querySelector('.slide-footer')) {{ const footer = document.createElement('div'); footer.className = 'slide-footer'; slideElement.appendChild(footer); }} slideElement.querySelector('.slide-footer').innerHTML=`<div class=\"logo\">EquiLend Data & Analytics</div><div>${{currentSlide+1}}/${{totalSlides}}</div>`;}}document.getElementById('nextBtn').addEventListener('click', () => {{showSlide(currentSlide + 1);}});document.getElementById('prevBtn').addEventListener('click', () => {{showSlide(currentSlide - 1);}});document.addEventListener('keydown', (e) => {{if (e.key === 'ArrowRight'){{showSlide(currentSlide + 1);}} else if (e.key === 'ArrowLeft'){{showSlide(currentSlide - 1);}}}});showSlide(0);</script></body></html>\n","\"\"\"\n","\n","try:\n","    with open(FILENAME, \"w\", encoding=\"utf-8\") as f:\n","        f.write(full_html_doc)\n","    print(f\"‚úÖ Successfully created self-contained presentation: '{FILENAME}'\")\n","except IOError as e:\n","    print(f\"‚ùå Error writing file: {e}\")\n","    exit()\n","\n","Handler = http.server.SimpleHTTPRequestHandler\n","httpd = None\n","# Find an open port\n","while httpd is None:\n","    try:\n","        httpd = socketserver.TCPServer((\"\", PORT), Handler)\n","    except OSError:\n","        print(f\"‚ö†Ô∏è Port {PORT} is in use. Trying next port...\")\n","        PORT += 1\n","\n","url = f\"http://localhost:{PORT}/{FILENAME}\"\n","print(f\"üöÄ Starting server at: {url}\")\n","print(\"   Navigate with arrow keys or on-screen buttons.\")\n","print(\"   To stop the server, press Ctrl+C in this terminal.\")\n","webbrowser.open_new_tab(url)\n","\n","try:\n","    httpd.serve_forever()\n","except KeyboardInterrupt:\n","    print(\"\\n‚úÖ Server stopped.\")\n","    httpd.server_close()"],"outputs":[{"output_type":"stream","name":"stdout","text":["Downloading and embedding chart images...\n","‚ùå Error fetching image https://i.imgur.com/unnamed (6).png: 429 Client Error: Unknown Error for url: https://i.imgur.com/unnamed%20(6).png\n","‚ùå Error fetching image https://i.imgur.com/unnamed (5).png: 429 Client Error: Unknown Error for url: https://i.imgur.com/unnamed%20(5).png\n","‚ùå Error fetching image https://i.imgur.com/unnamed (4).png: 429 Client Error: Unknown Error for url: https://i.imgur.com/unnamed%20(4).png\n","‚ùå Error fetching image https://i.imgur.com/unnamed (4).png: 429 Client Error: Unknown Error for url: https://i.imgur.com/unnamed%20(4).png\n","‚ùå Error fetching image https://i.imgur.com/unnamed (3).jpg: 429 Client Error: Unknown Error for url: https://i.imgur.com/unnamed%20(3).jpg\n","‚ùå Error fetching image https://i.imgur.com/unnamed (1).png: 429 Client Error: Unknown Error for url: https://i.imgur.com/unnamed%20(1).png\n","‚ùå Error fetching image https://i.imgur.com/unnamed (3).png: 429 Client Error: Unknown Error for url: https://i.imgur.com/unnamed%20(3).png\n","‚ùå Error fetching image https://i.imgur.com/unnamed (2).png: 429 Client Error: Unknown Error for url: https://i.imgur.com/unnamed%20(2).png\n","‚ùå Error fetching image https://i.imgur.com/t1.jpg: 429 Client Error: Unknown Error for url: https://i.imgur.com/t1.jpg\n","‚ùå Error fetching image https://i.imgur.com/unnamed (8).png: 429 Client Error: Unknown Error for url: https://i.imgur.com/unnamed%20(8).png\n","‚ùå Error fetching image https://i.imgur.com/unnamed.jpg: 429 Client Error: Unknown Error for url: https://i.imgur.com/unnamed.jpg\n","‚ùå Error fetching image https://i.imgur.com/unnamed (1).jpg: 429 Client Error: Unknown Error for url: https://i.imgur.com/unnamed%20(1).jpg\n","‚ùå Error fetching image https://i.imgur.com/unnamed (2).jpg: 429 Client Error: Unknown Error for url: https://i.imgur.com/unnamed%20(2).jpg\n","‚ùå Error fetching image https://i.imgur.com/unnamed.png: 429 Client Error: Unknown Error for url: https://i.imgur.com/unnamed.png\n","‚úÖ All charts ready.\n","‚úÖ Successfully created self-contained presentation: 'treasury_foundations_presentation_full.html'\n","üöÄ Starting server at: http://localhost:8000/treasury_foundations_presentation_full.html\n","   Navigate with arrow keys or on-screen buttons.\n","   To stop the server, press Ctrl+C in this terminal.\n","\n","‚úÖ Server stopped.\n"]}],"execution_count":1,"metadata":{"id":"Y0RUfKXxIFiX","executionInfo":{"status":"ok","timestamp":1755167363652,"user_tz":240,"elapsed":7970,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"77183287-b915-4ef9-acd4-5be1c581da4b","colab":{"base_uri":"https://localhost:8080/"}}}],"metadata":{"colab":{"provenance":[]},"kernelspec":{"display_name":"Python 3","name":"python3"}},"nbformat":4,"nbformat_minor":0}