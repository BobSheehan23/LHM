{"cells":[{"cell_type":"code","source":["import pandas as pd\n","from datetime import datetime\n","import re\n","import numpy as np\n","\n","# --- Configuration ---\n","# The output file will be named with today's date.\n","OUTPUT_HTML_PATH = f\"equilend_daily_digest_{datetime.now().strftime('%Y_%m_%d')}.html\"\n","\n","# --- 1. Hardcoded Content and Data ---\n","\n","def get_hardcoded_content():\n","    \"\"\"\n","    Returns all the text content for the digest.\n","    This section can be updated with the day's specific narrative content.\n","    \"\"\"\n","    content = {\n","        'market_notes': {\n","            'avg_fee_bps': '45.13',\n","            'avg_fee_change': 1.26,\n","            'avg_util_percent': '7.07',\n","            'avg_util_change': 0.47,\n","            'on_loan_value': '3.05T',\n","            'on_loan_value_change': 0.90,\n","            'lendable_value': '43.06T',\n","            'lendable_value_change': 0.43\n","        },\n","        'headlines': [\n","            {\n","                'title': 'US and Japan Announce Trade Deal, US-EU Deal Reportedly Close',\n","                'description': 'The United States and Japan have announced a new trade deal, a significant development in international trade relations. This news, combined with reports that the US and the European Union are nearing their own trade agreement, has boosted global equity markets. These deals are seen as potentially reducing trade tensions and providing a more stable environment for global commerce.',\n","                'data_insight': 'The positive trade news appears to be reducing hedging demand for sectors most exposed to international tariffs. Our data for the SPDR S&P Kensho New Economies Composite ETF (KOMP), which has significant exposure to global supply chains, shows a one-day decrease in shares on loan of over 1.2 million. A reduction in short interest for a globally-focused ETF like this may indicate increased investor optimism.'\n","            },\n","            {\n","                'title': 'European Central Bank Holds Interest Rates Steady Amid Trade Uncertainty',\n","                'description': 'The European Central Bank (ECB) kept its key interest rates unchanged, pausing its rate-cutting cycle for the first time in over a year. The decision comes as the Eurozone\\'s inflation rate has returned to the ECB\\'s 2% target, but uncertainty surrounding a potential trade deal between the US and the EU looms. The ECB will likely seek more clarity on the trade situation before making further adjustments to its monetary policy.',\n","                'data_insight': 'The ECB\\'s decision to hold rates may be creating some caution in rate-sensitive sectors. We\\'ve observed a slight uptick in short interest for the iShares EURO STOXX Banks 30-15 UCITS ETF (EXX1 GR), where shares on loan have increased by approximately 350,000 over the past week. This could signal that some investors are hedging their positions in European banks amidst the current monetary policy uncertainty.'\n","            },\n","            {\n","                'title': 'Microsoft Identifies Chinese Hacking Groups Behind SharePoint Attacks',\n","                'description': 'Following up on recent reports of a major cyberattack, Microsoft has now publicly identified three hacking groups with links to the Chinese government as being responsible for exploiting vulnerabilities in its SharePoint software. This has led to breaches at over 100 organizations worldwide, including the US National Nuclear Security Administration. The attribution of these attacks to state-sponsored actors escalates the geopolitical significance of these cyber incidents.',\n","                'data_insight': 'Our data for Microsoft (MSFT) indicates a one-day increase in shares on loan of 2,239,944. This rise in short interest could be a reaction to the news, possibly reflecting concerns about reputational risk or potential financial liabilities associated with the breach.'\n","            }\n","        ],\n","        'key_takeaways': [\n","            \"Positive developments in international trade agreements appear to be boosting investor confidence, as indicated by a decrease in short-selling activity for ETFs with global exposure.\",\n","            \"The European Central Bank's decision to hold interest rates steady may be creating some short-term uncertainty in European markets, with a slight uptick in short interest for regional banking stocks.\",\n","            \"News of a significant cybersecurity breach at Microsoft may be leading to concerns about the company's near-term outlook, as reflected by a notable one-day increase in the number of its shares on loan.\"\n","        ]\n","    }\n","    return content\n","\n","def get_hardcoded_tables_html():\n","    \"\"\"\n","    Returns HTML for the two data tables using the hardcoded data.\n","    \"\"\"\n","    # Data for \"Hot & Getting Hotter\"\n","    ht_borrow_data = [\n","        {\"TICKER\": \"WBUY\", \"Company Name\": \"WEBUY GLOBAL LTD COM\", \"Industry\": \"Food and Staples Retaili\", \"Price\": \"$7.39\", \"Fee Band\": \"90,000+\", \"Fee WoW (bps)\": \"4463\"},\n","        {\"TICKER\": \"SLRX\", \"Company Name\": \"SALARIUS PHARMACEUTI\", \"Industry\": \"Biotechnology\", \"Price\": \"$0.70\", \"Fee Band\": \"80,000+\", \"Fee WoW (bps)\": \"6268\"},\n","        {\"TICKER\": \"CYCC\", \"Company Name\": \"CYCLACEL PHARMACEUT\", \"Industry\": \"Biotechnology\", \"Price\": \"$14.00\", \"Fee Band\": \"60,000+\", \"Fee WoW (bps)\": \"13962\"},\n","        {\"TICKER\": \"GITS\", \"Company Name\": \"GLOBAL INTERACTIVE TE\", \"Industry\": \"Interactive Media & Servi\", \"Price\": \"$2.86\", \"Fee Band\": \"50,000+\", \"Fee WoW (bps)\": \"303\"},\n","        {\"TICKER\": \"NUWE\", \"Company Name\": \"NUWELLIS INC COM (POS\", \"Industry\": \"Health Care Equipment &\", \"Price\": \"$13.83\", \"Fee Band\": \"50,000+\", \"Fee WoW (bps)\": \"47846\"},\n","    ]\n","\n","    # Data for \"Market Technicals & Squeeze Metrics\"\n","    squeeze_data = [\n","        {\"TICKER\": \"VOR\", \"Company Name\": \"VOR BIOPHARMA\", \"Industry\": \"Biotechnology\", \"Price\": \"$2.05\", \"SSS\": 89, \"SSS Week Diff\": 1},\n","        {\"TICKER\": \"WOLF\", \"Company Name\": \"WOLFSPEED INC\", \"Industry\": \"Semiconductors & Equip\", \"Price\": \"$1.42\", \"SSS\": 85, \"SSS Week Diff\": 57},\n","        {\"TICKER\": \"ABVX\", \"Company Name\": \"ABIVAX SPON\", \"Industry\": \"Biotechnology\", \"Price\": \"$10.00\", \"SSS\": 82, \"SSS Week Diff\": 49},\n","        {\"TICKER\": \"AEHR\", \"Company Name\": \"AEHR TEST SYSTEMS\", \"Industry\": \"Semiconductors & Equip\", \"Price\": \"$20.10\", \"SSS\": 76, \"SSS Week Diff\": 33},\n","        {\"TICKER\": \"IOVA\", \"Company Name\": \"IOVANCE BIOTHERAPEUT\", \"Industry\": \"Biotechnology\", \"Price\": \"$3.13\", \"SSS\": 76, \"SSS Week Diff\": 50},\n","    ]\n","\n","    def format_change(value, unit=' BPS'):\n","        try:\n","            cleaned_value = str(value).replace(',', '').strip()\n","            val = float(cleaned_value)\n","            color = '#16a34a' if val > 0 else '#dc2626'\n","            sign = '+' if val > 0 else ''\n","            return f'<span style=\"color:{color}; font-size:14px;\">{sign}{val:,.0f}{unit}</span>'\n","        except (ValueError, TypeError):\n","            return str(value).strip() if pd.notna(value) else ''\n","\n","    ht_borrow_html = \"\"\n","    for row in ht_borrow_data:\n","        ht_borrow_html += f\"\"\"\n","        <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","            <td style=\"padding:4px 8px;\">{row.get(\"TICKER\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Company Name\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Industry\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Price\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Fee Band\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{format_change(row.get(\"Fee WoW (bps)\"))}</td>\n","        </tr>\"\"\"\n","\n","    squeeze_html = \"\"\n","    for row in squeeze_data:\n","        squeeze_html += f\"\"\"\n","        <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","            <td style=\"padding:4px 8px;\">{row.get(\"TICKER\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Company Name\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Industry\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Price\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"SSS\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{format_change(row.get(\"SSS Week Diff\"), unit=\"\")}</td>\n","        </tr>\"\"\"\n","\n","    return ht_borrow_html, squeeze_html\n","\n","\n","# --- 2. HTML Generation ---\n","\n","def create_digest_html(content, table_html_tuple):\n","    \"\"\"\n","    Generates the final HTML for the digest by populating a template.\n","    \"\"\"\n","    if not content:\n","        return \"<h1>Error: Could not generate content.</h1>\"\n","\n","    ht_borrow_table, squeeze_table = table_html_tuple\n","\n","    def format_market_note_change(value):\n","        color = '#16a34a' if value > 0 else '#dc2626'\n","        sign = '+' if value > 0 else ''\n","        return f'<span style=\"color:{color}; font-size:14px;\">{sign}{value:.2f}%</span>'\n","\n","    market_notes = content.get('market_notes', {})\n","    avg_fee_bps = market_notes.get('avg_fee_bps', 'N/A')\n","    avg_fee_change = format_market_note_change(market_notes.get('avg_fee_change', 0))\n","    avg_util_percent = market_notes.get('avg_util_percent', 'N/A')\n","    avg_util_change = format_market_note_change(market_notes.get('avg_util_change', 0))\n","    on_loan_value = market_notes.get('on_loan_value', 'N/A')\n","    on_loan_value_change = format_market_note_change(market_notes.get('on_loan_value_change', 0))\n","    lendable_value = market_notes.get('lendable_value', 'N/A')\n","    lendable_value_change = format_market_note_change(market_notes.get('lendable_value_change', 0))\n","\n","    headlines_html = \"\"\n","    for headline in content.get('headlines', []):\n","        headlines_html += f\"\"\"\n","        <div style=\"margin-top:20px;\">\n","            <strong style=\"font-size:16px;\">{headline['title']}</strong>\n","            <p style=\"margin:5px 0 0; white-space: pre-wrap;\">{headline['description']}</p>\n","            <ul style=\"margin:10px 0 0; padding-left:20px; color:#334155; list-style-type: disc;\">\n","              <li><strong>What Our Data Shows:</strong> {headline['data_insight']}</li>\n","            </ul>\n","        </div>\n","        \"\"\"\n","\n","    takeaways_html = \"\".join([f\"<li>{item}</li>\" for item in content.get('key_takeaways', [])])\n","\n","    html_template = f\"\"\"\n","<!DOCTYPE html>\n","<html lang=\"en\">\n","<head>\n","  <meta charset=\"UTF-8\">\n","  <title>EquiLend D&A Daily Digest - {datetime.now().strftime('%B %d, %Y')}</title>\n","</head>\n","<body style=\"margin:0; padding:0; font-family: Arial, sans-serif; background-color:#f1f5f9;\">\n","  <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"#f1f5f9\">\n","    <tr>\n","      <td align=\"center\">\n","        <table width=\"800\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"#ffffff\" style=\"margin:20px 0; border-radius:4px; overflow:hidden;\">\n","          <!-- Header -->\n","          <tr>\n","            <td bgcolor=\"#0284c7\" style=\"padding:20px; text-align:center;\">\n","              <h1 style=\"margin:0; font-size:24px; color:#ffffff;\">EquiLend D&amp;A Daily Digest</h1>\n","              <p style=\"margin:5px 0 0; font-size:16px; color:#bae6fd;\">{datetime.now().strftime('%B %d, %Y')}</p>\n","            </td>\n","          </tr>\n","          <!-- Content -->\n","          <tr>\n","            <td style=\"padding:20px; color:#333333; font-size:14px; line-height:1.5;\">\n","\n","              <!-- Market Notes -->\n","              <h2 style=\"font-size:18px; margin-bottom:10px; color:#0284c7;\">&#x1F4BC; Market Notes</h2>\n","              <table width=\"100%\" cellpadding=\"5\" cellspacing=\"0\" border=\"0\" bgcolor=\"#f8fafc\" style=\"margin-bottom:20px;\">\n","                <tr>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Average Fee</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      {avg_fee_bps} bps {avg_fee_change}\n","                    </p>\n","                  </td>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Average Utilization</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      {avg_util_percent}% {avg_util_change}\n","                    </p>\n","                  </td>\n","                </tr>\n","                <tr>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">On Loan Value</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      ${on_loan_value} {on_loan_value_change}\n","                    </p>\n","                  </td>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Total Lendable Value</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      ${lendable_value} {lendable_value_change}\n","                    </p>\n","                  </td>\n","                </tr>\n","              </table>\n","\n","              <!-- Headlines -->\n","              <h2 style=\"font-size:18px; margin-bottom:10px; color:#0284c7;\">&#x1F4F0; Major Headlines and What Our Data Shows</h2>\n","              {headlines_html}\n","\n","              <!-- Tables Section -->\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F525; Hot & Getting Hotter</h2>\n","              <table cellpadding=\"0\" cellspacing=\"0\" border=\"1\" style=\"border-collapse:collapse; margin-bottom:20px; border-color:#dddddd; font-size:12px;\" width=\"100%\">\n","                <thead>\n","                  <tr bgcolor=\"#0284c7\" style=\"color:#ffffff; font-weight:bold; text-align:left;\">\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Ticker</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Company Name</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Industry</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Price</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Fee Band</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Fee WoW (bps)</th>\n","                  </tr>\n","                </thead>\n","                <tbody>\n","                  {ht_borrow_table}\n","                </tbody>\n","              </table>\n","\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F52C; Market Technicals & Squeeze Metrics</h2>\n","              <table cellpadding=\"0\" cellspacing=\"0\" border=\"1\" style=\"border-collapse:collapse; border-color:#dddddd; font-size:12px;\" width=\"100%\">\n","                <thead>\n","                  <tr bgcolor=\"#0284c7\" style=\"color:#ffffff; font-weight:bold; text-align:left;\">\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Ticker</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Company Name</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Industry</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Price</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">SSS</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">SSS Week Diff</th>\n","                  </tr>\n","                </thead>\n","                <tbody>\n","                  {squeeze_table}\n","                </tbody>\n","              </table>\n","\n","              <!-- Key Takeaways -->\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F4A1; Key Takeaways</h2>\n","              <ul style=\"padding-left:20px; color:#334155; font-size:14px; margin:0;\">\n","                {takeaways_html}\n","              </ul>\n","\n","            </td>\n","          </tr>\n","          <!-- Footer -->\n","          <tr>\n","            <td align=\"center\" style=\"padding:10px; font-size:12px; color:#64748b;\">\n","              Source: EquiLend Data &amp; Analytics\n","            </td>\n","          </tr>\n","        </table>\n","      </td>\n","    </tr>\n","  </table>\n","</body>\n","</html>\n","    \"\"\"\n","    return html_template\n","\n","# --- Main Execution ---\n","if __name__ == \"__main__\":\n","    print(\"Starting daily digest generation...\")\n","\n","    # 1. Get hardcoded content\n","    print(\"Loading hardcoded content...\")\n","    hardcoded_content = get_hardcoded_content()\n","\n","    # 2. Get HTML for the hardcoded tables\n","    print(\"Generating tables from hardcoded data...\")\n","    table_html = get_hardcoded_tables_html()\n","\n","    # 3. Generate the final HTML file\n","    print(\"Generating final HTML digest...\")\n","    final_html = create_digest_html(hardcoded_content, table_html)\n","\n","    # 4. Save the HTML to a file\n","    with open(OUTPUT_HTML_PATH, 'w', encoding='utf-8') as f:\n","        f.write(final_html)\n","\n","    print(f\"\\nSuccessfully generated digest: {OUTPUT_HTML_PATH}\")\n","    print(\"This version is fully hardcoded and does not depend on external files.\")"],"outputs":[{"output_type":"stream","name":"stdout","text":["Starting daily digest generation...\n","Loading hardcoded content...\n","Generating tables from hardcoded data...\n","Generating final HTML digest...\n","\n","Successfully generated digest: equilend_daily_digest_2025_07_24.html\n","This version is fully hardcoded and does not depend on external files.\n"]}],"execution_count":1,"metadata":{"id":"_vkf9FDefClP","executionInfo":{"status":"ok","timestamp":1753361435909,"user_tz":240,"elapsed":825,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"54c1eb69-8637-41a9-bc72-a12de0bc138b","colab":{"base_uri":"https://localhost:8080/"}}}],"metadata":{"colab":{"provenance":[]},"kernelspec":{"display_name":"Python 3","name":"python3"}},"nbformat":4,"nbformat_minor":0}