{"cells":[{"cell_type":"code","source":["import pandas as pd\n","from datetime import datetime\n","import re\n","import numpy as np\n","\n","# --- Configuration ---\n","# The output file will be named with today's date.\n","OUTPUT_HTML_PATH = f\"equilend_daily_digest_July_30_2025.html\"\n","\n","# --- 1. Hardcoded Content and Data ---\n","\n","def get_hardcoded_content():\n","    \"\"\"\n","    Returns all the text content for the digest.\n","    This section can be updated with the day's specific narrative content.\n","    \"\"\"\n","    content = {\n","        'market_notes': {\n","            'avg_fee_bps': '41.58',\n","            'avg_fee_change': -1.73,\n","            'avg_util_percent': '7.01',\n","            'avg_util_change': 0.43,\n","            'on_loan_value': '3.03T',\n","            'on_loan_value_change': 0.22,\n","            'lendable_value': '43.19T',\n","            'lendable_value_change': -0.21\n","        },\n","        'headlines': [\n","            {\n","                'title': 'US and EU Reach Tentative Trade Deal Ahead of Tariff Deadline',\n","                'description': 'The United States and the European Union are nearing a trade agreement, which could avert new tariffs set to begin on August 1st. This positive development has been met with enthusiasm in the markets, easing worries about a potential trade war that could slow global economic growth. Overall, the terms appear to be more favorable than many had expected.',\n","                'data_insight': 'With many European equities affected by the tariff dispute, the automobile industry has been a key focus. In an example of this, tariff uncertainty has generated increased short interest in Volvo Car AB (VOLCARB SF), with its borrowing cost rising 1,228% year-over-year to 263 bps.'\n","            },\n","            {\n","                'title': 'US 10-Year Treasury Yields Decline on Strong Auction Demand',\n","                'description': 'The yield on the US 10-year Treasury note has dropped to a 2.5-week low, as strong demand was noted during the latest auction. This indicates that investors are keen on longer-duration US government debt.',\n","                'data_insight': 'Amid ongoing market turbulence, our data shows heightened short interest in US Treasuries compared to last year. The value of Treasuries on loan has increased by $64B to an average of $889B for July, and the cost to borrow has risen from 7.3 bps to 8.9 bps.'\n","            },\n","            {\n","                'title': 'US and China Agree in Principle to Extend 90-Day Tariff Truce',\n","                'description': 'Final approval now rests with President Trump after the two sides held “constructive” talks and are working toward a 90-day extension to maintain the tariff pause. During this period, the impact of a 25% tariff on some Chinese imports, including EVs and auto parts, will remain in place.',\n","                'data_insight': 'Hong Kong EV manufacturer BYD has been one of the most heavily affected companies since the April tariff announcements. EquiLend data shows the on-loan quantity for BYD Company Ltd. (1211 HK) has increased by 1,005% year-over-year, reaching 201 million shares from 18 million this time last year.'\n","            }\n","        ],\n","        'key_takeaways': [\n","            \"Positive trade developments may stabilize markets, particularly for heavily shorted, export-dependent auto stocks like Volvo and BYD that saw significant increases in borrowing activity due to tariff concerns.\",\n","            \"Investor sentiment appears cautious, as illustrated by the simultaneous strong demand for US Treasuries and a year-over-year increase in short interest against them, suggesting hedging against policy uncertainty.\",\n","            \"Broad market data indicates stability, though a decrease in average borrowing fees alongside rising utilization may signal a shift in demand from high-cost 'specials' to general collateral.\"\n","        ]\n","    }\n","    return content\n","\n","def get_hardcoded_tables_html():\n","    \"\"\"\n","    Returns HTML for the two data tables using the hardcoded data for July 30.\n","    \"\"\"\n","    # Data for \"Hot & Getting Hotter\"\n","    ht_borrow_data = [\n","        {\"TICKER\": \"NXTT\", \"Company Name\": \"NEXT TECHNOLOGY HOLDING\", \"Industry\": \"Software and Services\", \"Price\": \"$2.05\", \"Fee 1 WoW (bps)\": \"5294.34\"},\n","        {\"TICKER\": \"CYCC\", \"Company Name\": \"CYCLACEL PHARMACEUTICALS\", \"Industry\": \"Biotechnology\", \"Price\": \"$13.25\", \"Fee 1 WoW (bps)\": \"4401.63\"},\n","        {\"TICKER\": \"LZMH\", \"Company Name\": \"LZ TECHNOLOGY HOLDINGS\", \"Industry\": \"Advertising\", \"Price\": \"$5.88\", \"Fee 1 WoW (bps)\": \"1098.64\"},\n","        {\"TICKER\": \"BMGL\", \"Company Name\": \"BASEL MEDICAL GROUP\", \"Industry\": \"Health Care Prvdrs & Srvcs\", \"Price\": \"$2.24\", \"Fee 1 WoW (bps)\": \"1617.43\"},\n","        {\"TICKER\": \"SGNS\", \"Company Name\": \"SCISPARK\", \"Industry\": \"Biotechnology\", \"Price\": \"$1.55\", \"Fee 1 WoW (bps)\": \"49958.78\"},\n","    ]\n","\n","    # Data for \"Market Technicals & Squeeze Metrics\"\n","    squeeze_data = [\n","        {\"TICKER\": \"ABVX FP\", \"Company Name\": \"ABIVAX\", \"Industry\": \"Biotechnology\", \"Price\": \"$69.69\", \"SSS\": 90, \"SSS WoW\": \"29\"},\n","        {\"TICKER\": \"IMU AU\", \"Company Name\": \"IMUGENE\", \"Industry\": \"Biotechnology\", \"Price\": \"$0.18\", \"SSS\": 88, \"SSS WoW\": \"-2\"},\n","        {\"TICKER\": \"HUBC\", \"Company Name\": \"HUB CYBER SECURITY\", \"Industry\": \"Software and Services\", \"Price\": \"$4.00\", \"SSS\": 88, \"SSS WoW\": \"24\"},\n","        {\"TICKER\": \"TDTH\", \"Company Name\": \"TRIDENT DIGITAL TECH\", \"Industry\": \"Software and Services\", \"Price\": \"$1.35\", \"SSS\": 86, \"SSS WoW\": \"6\"},\n","        {\"TICKER\": \"WOLF\", \"Company Name\": \"WOLFSPEED\", \"Industry\": \"Semiconductors\", \"Price\": \"$1.53\", \"SSS\": 85, \"SSS WoW\": \"25\"},\n","    ]\n","\n","    def format_change(value, unit=' BPS'):\n","        try:\n","            cleaned_value = str(value).replace(',', '').strip()\n","            val = float(cleaned_value)\n","            color = '#16a34a' if val > 0 else '#dc2626'\n","            sign = '+' if val > 0 else ''\n","            return f'<span style=\"color:{color}; font-size:14px;\">{sign}{val:,.2f}{unit}</span>'\n","        except (ValueError, TypeError):\n","            return str(value).strip() if pd.notna(value) else ''\n","\n","    ht_borrow_html = \"\"\n","    for row in ht_borrow_data:\n","        ht_borrow_html += f\"\"\"\n","        <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","            <td style=\"padding:4px 8px;\">{row.get(\"TICKER\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Company Name\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Industry\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Price\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{format_change(row.get(\"Fee 1 WoW (bps)\"))}</td>\n","        </tr>\"\"\"\n","\n","    squeeze_html = \"\"\n","    for row in squeeze_data:\n","        squeeze_html += f\"\"\"\n","        <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","            <td style=\"padding:4px 8px;\">{row.get(\"TICKER\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Company Name\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Industry\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Price\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"SSS\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{format_change(row.get(\"SSS WoW\"), unit=\"\")}</td>\n","        </tr>\"\"\"\n","\n","    return ht_borrow_html, squeeze_html\n","\n","\n","# --- 2. HTML Generation ---\n","\n","def create_digest_html(content, table_html_tuple):\n","    \"\"\"\n","    Generates the final HTML for the digest by populating a template.\n","    \"\"\"\n","    if not content:\n","        return \"<h1>Error: Could not generate content.</h1>\"\n","\n","    ht_borrow_table, squeeze_table = table_html_tuple\n","\n","    def format_market_note_change(value):\n","        color = '#16a34a' if value >= 0 else '#dc2626'\n","        sign = '+' if value >= 0 else ''\n","        return f'<span style=\"color:{color}; font-size:14px;\">{sign}{value:.2f}%</span>'\n","\n","    market_notes = content.get('market_notes', {})\n","    avg_fee_bps = market_notes.get('avg_fee_bps', 'N/A')\n","    avg_fee_change = format_market_note_change(market_notes.get('avg_fee_change', 0))\n","    avg_util_percent = market_notes.get('avg_util_percent', 'N/A')\n","    avg_util_change = format_market_note_change(market_notes.get('avg_util_change', 0))\n","    on_loan_value = market_notes.get('on_loan_value', 'N/A')\n","    on_loan_value_change = format_market_note_change(market_notes.get('on_loan_value_change', 0))\n","    lendable_value = market_notes.get('lendable_value', 'N/A')\n","    lendable_value_change = format_market_note_change(market_notes.get('lendable_value_change', 0))\n","\n","    headlines_html = \"\"\n","    for headline in content.get('headlines', []):\n","        headlines_html += f\"\"\"\n","        <div style=\"margin-top:20px;\">\n","            <strong style=\"font-size:16px;\">{headline['title']}</strong>\n","            <p style=\"margin:5px 0 0; white-space: pre-wrap;\">{headline['description']}</p>\n","            <ul style=\"margin:10px 0 0; padding-left:20px; color:#334155; list-style-type: d"],"outputs":[{"output_type":"error","ename":"SyntaxError","evalue":"incomplete input (ipython-input-863571021.py, line 139)","traceback":["\u001b[0;36m  File \u001b[0;32m\"/tmp/ipython-input-863571021.py\"\u001b[0;36m, line \u001b[0;32m139\u001b[0m\n\u001b[0;31m    headlines_html += f\"\"\"\u001b[0m\n\u001b[0m                      ^\u001b[0m\n\u001b[0;31mSyntaxError\u001b[0m\u001b[0;31m:\u001b[0m incomplete input\n"]}],"execution_count":2,"metadata":{"id":"ceVtmXTl4X-p","executionInfo":{"status":"error","timestamp":1754055952105,"user_tz":240,"elapsed":15,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"3272967a-af49-48dc-84ed-0ff62b6161a4","colab":{"base_uri":"https://localhost:8080/","height":106}}}],"metadata":{"colab":{"provenance":[]},"kernelspec":{"display_name":"Python 3","name":"python3"}},"nbformat":4,"nbformat_minor":0}