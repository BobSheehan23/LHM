{"cells":[{"cell_type":"code","source":"import os\n\n# --- DATA FOR THE REPORT ---\n# This data would typically be loaded from a database or CSV files.\n# For this example, it's hardcoded to reproduce the July 15, 2025 report.\n\nREPORT_DATE = \"July 15, 2025\"\n\nMARKET_NOTES = {\n    \"fee\": \"45.44 bps\",\n    \"fee_change\": \"-1.13%\",\n    \"fee_direction\": \"down\",\n    \"utilization\": \"6.99%\",\n    \"utilization_change\": \"+0.33%\",\n    \"utilization_direction\": \"up\"\n}\n\nHEADLINES = [\n    {\n        \"title\": \"Zuckerberg Announces Meta Data Centers\",\n        \"body\": \"Meta CEO Mark Zuckerberg said the company is building several massive data centers to power its AI efforts, the first of which is said to come online next year. This coincides with a $14.3 billion investment to claim a 49% stake in ScaleAI on June 16th as well as the announcement of a partnership with Oakley in June to produce â€˜oakleymetaâ€™ smart-glasses, all of which generated a 3-month high for Metaâ€™s stock price in early June.\",\n        \"data_shows\": \"With a turbulent start to June in Metaâ€™s stock price and a record quarterly dividend announcement, a heightened quantity of shares were borrowed, followed by a spike in On Loan Value of $5.23 billion on the 16th of June. Subsequently, Meta reached a 2-year low of $292 million on loan yesterday possibly indicating that investors are closing out short positions after profiting from the short term sell-off in the shares.\"\n    },\n    {\n        \"title\": \"UK Retail Sales Jump 3.1% Year-over-Year\",\n        \"body\": \"Retail sales in June in the UK were up 3.1% from the year previous, according to the British Retail Consortium. Hot weather prompted increased levels of spending on items such as food, sports equipment and electric fans. However, with many hedge funds expecting this to be an irregular purple-patch for struggling high street brands, short interest has been peaked, preempting a decline in share price to come after this run of form.\",\n        \"data_shows\": \"The UK Consumer Staples industry rose significantly by On Loan Value throughout June, starting at $3.4 billion and rising to a 2-year high of $4.8 billion at the end of the month.\"\n    },\n    {\n        \"title\": \"EU to Target Cars and Bourbon in Tariff Countermeasures\",\n        \"body\": \"The European Union has finalized a list of countermeasures to target US goods worth 72 billion euros, including Boeing aircraft, automobiles and bourbon, if it decides to retaliate.\",\n        \"data_shows\": \"The US automobile industry has seen borrowing costs rise steadily in the past month from a low of 97.6 bps in mid-June to 154 bps yesterday.\"\n    }\n]\n\nHARD_TO_BORROW_DATA = [\n    {\"ticker\": \"FFIE\", \"name\": \"FARADAY FUTURE INTELLIGENT\", \"industry\": \"Auto Manufacturers\", \"fee\": \"50,000+\", \"momentum\": \"+1,098 BPS\", \"momentum_direction\": \"up\"},\n    {\"ticker\": \"GME\", \"name\": \"GAMESTOP CORP\", \"industry\": \"Retail - Apparel & Specialty\", \"fee\": \"30,000 to 49,999\", \"momentum\": \"+1,845 BPS\", \"momentum_direction\": \"up\"},\n    {\"ticker\": \"BBAI\", \"name\": \"BIGBEAR.AI HOLDINGS, INC.\", \"industry\": \"Application Software\", \"fee\": \"10,000 to 29,999\", \"momentum\": \"+2,112 BPS\", \"momentum_direction\": \"up\"},\n    {\"ticker\": \"PLUG\", \"name\": \"PLUG POWER INC\", \"industry\": \"Electrical Equipment\", \"fee\": \"1,000 to 9,999\", \"momentum\": \"+25 BPS\", \"momentum_direction\": \"up\"},\n    {\"ticker\": \"RIOT\", \"name\": \"RIOT PLATFORMS, INC.\", \"industry\": \"Financial Services\", \"fee\": \"<1,000\", \"momentum\": \"+18 BPS\", \"momentum_direction\": \"up\"}\n]\n\nSHORT_SQUEEZE_DATA = [\n    {\"ticker\": \"DJT\", \"name\": \"Trump Media & Technology Group Corp.\", \"industry\": \"Media & Publishing\", \"price\": \"$51.25\", \"price_wow\": \"+3.5%\", \"price_direction\": \"up\", \"score\": \"99.2\", \"score_wow\": \"+0.10\", \"score_direction\": \"up\"},\n    {\"ticker\": \"GME\", \"name\": \"GameStop Corp.\", \"industry\": \"Retail - Apparel & Specialty\", \"price\": \"$24.75\", \"price_wow\": \"-2.9%\", \"price_direction\": \"down\", \"score\": \"98.5\", \"score_wow\": \"-0.20\", \"score_direction\": \"down\"},\n    {\"ticker\": \"AMC\", \"name\": \"AMC Entertainment Holdings, Inc.\", \"industry\": \"Entertainment\", \"price\": \"$4.60\", \"price_wow\": \"+2.2%\", \"price_direction\": \"up\", \"score\": \"94.8\", \"score_wow\": \"-0.40\", \"score_direction\": \"down\"},\n    {\"ticker\": \"RIVN\", \"name\": \"Rivian Automotive, Inc.\", \"industry\": \"Auto Manufacturers\", \"price\": \"$16.10\", \"price_wow\": \"+2.2%\", \"price_direction\": \"up\", \"score\": \"89.1\", \"score_wow\": \"+0.60\", \"score_direction\": \"up\"}\n]\n\nKEY_TAKEAWAYS = [\n    \"The sharp decline in Meta's on-loan value from a recent peak could indicate that investors are closing out short positions, possibly after profiting from short-term volatility related to recent company announcements.\",\n    \"Despite strong UK retail sales figures, a significant rise in the On Loan Value for the UK Consumer Staples industry may suggest some investors are skeptical about the sustainability of the trend and are positioning for a potential reversal.\",\n    \"Steadily increasing borrowing costs in the US automobile industry could be signaling that market participants are proactively hedging against risks associated with potential EU tariff countermeasures.\"\n]\n\n# --- HTML GENERATION FUNCTIONS ---\n\ndef get_arrow_svg(direction):\n    \"\"\"Returns the SVG for an up or down arrow.\"\"\"\n    if direction == \"up\":\n        return '<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 7l5 5-5 5m5-5H6\" /></svg>'\n    else: # down\n        return '<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 17l-5-5 5-5m-5 5h12\" /></svg>'\n\ndef generate_market_notes_html(notes):\n    \"\"\"Generates the HTML for the Market Notes section.\"\"\"\n    fee_change_val = notes['fee_change'].replace('-', '')\n    util_change_val = notes['utilization_change'].replace('+', '')\n    \n    fee_arrow_svg = get_arrow_svg(notes['fee_direction'])\n    util_arrow_svg = get_arrow_svg(notes['utilization_direction'])\n\n    return f\"\"\"\n            <!-- Market Notes Section -->\n            <section>\n                <h2 class=\"text-2xl font-bold text-slate-800 mb-4 flex items-center\">\n                    <span class=\"text-2xl mr-3\">ðŸ“ˆ</span> Market Notes\n                </h2>\n                <div class=\"grid grid-cols-1 sm:grid-cols-2 gap-4 text-center bg-slate-50 p-4 rounded-lg\">\n                    <div class=\"p-2\">\n                        <p class=\"text-sm text-slate-500\">Average Fee</p>\n                        <p class=\"text-xl font-semibold text-slate-700 flex items-center justify-center\">\n                            {notes['fee']} \n                            <span class=\"arrow-{notes['fee_direction']} ml-2 flex items-center text-base\">\n                                {fee_arrow_svg}\n                                {fee_change_val}\n                            </span>\n                        </p>\n                    </div>\n                    <div class=\"p-2\">\n                        <p class=\"text-sm text-slate-500\">Average Utilization</p>\n                        <p class=\"text-xl font-semibold text-slate-700 flex items-center justify-center\">\n                            {notes['utilization']}\n                            <span class=\"arrow-{notes['utilization_direction']} ml-2 flex items-center text-base\">\n                                {util_arrow_svg}\n                                {util_change_val}\n                            </span>\n                        </p>\n                    </div>\n                </div>\n            </section>\n    \"\"\"\n\ndef generate_headlines_html(headlines_data):\n    \"\"\"Generates the HTML for the Major Headlines section.\"\"\"\n    articles_html = \"\"\n    for headline in headlines_data:\n        articles_html += f\"\"\"\n                    <!-- Headline -->\n                    <article>\n                        <h3 class=\"font-bold text-lg text-slate-800\">{headline['title']}</h3>\n                        <p class=\"mt-2 text-slate-600\">{headline['body']}</p>\n                        <div class=\"mt-4 border-l-4 border-purple-700 pl-4\">\n                            <p class=\"font-semibold text-slate-700\">What Our Data Shows:</p>\n                            <p class=\"mt-1 text-slate-600\">{headline['data_shows']}</p>\n                        </div>\n                    </article>\n        \"\"\"\n    return f\"\"\"\n            <!-- Major Headlines Section -->\n            <section>\n                <h2 class=\"text-2xl font-bold text-slate-800 mb-6 flex items-center\">\n                    <span class=\"text-2xl mr-3\">ðŸ”¥</span> Major Headlines & What Our Data Shows\n                </h2>\n                <div class=\"space-y-8\">\n                    {articles_html}\n                </div>\n            </section>\n    \"\"\"\n\ndef generate_htb_table_html(data):\n    \"\"\"Generates the HTML for the Hard-to-Borrow table.\"\"\"\n    rows_html = \"\"\n    for i, row in enumerate(data):\n        bg_class = \"bg-slate-50\" if i % 2 != 0 else \"\"\n        rows_html += f\"\"\"\n                            <tr class=\"{bg_class}\">\n                                <td class=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900\">{row['ticker']}</td>\n                                <td class=\"px-6 py-4 whitespace-nowrap text-sm text-slate-500\">{row['name']}</td>\n                                <td class=\"px-6 py-4 whitespace-nowrap text-sm text-slate-500\">{row['industry']}</td>\n                                <td class=\"px-6 py-4 whitespace-nowrap text-sm text-slate-500\">{row['fee']}</td>\n                                <td class=\"px-6 py-4 whitespace-nowrap text-sm text-slate-500 arrow-{row['momentum_direction']}\">{row['momentum']}</td>\n                            </tr>\n        \"\"\"\n    return f\"\"\"\n                    <!-- Hard-to-Borrow Table -->\n                    <table class=\"min-w-full divide-y divide-slate-200\">\n                        <thead class=\"bg-slate-50\">\n                            <tr>\n                                <th scope=\"col\" class=\"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">Ticker</th>\n                                <th scope=\"col\" class=\"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">Name</th>\n                                <th scope=\"col\" class=\"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">Industry</th>\n                                <th scope=\"col\" class=\"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">Fee (BPS)</th>\n                                <th scope=\"col\" class=\"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">Momentum (WoW)</th>\n                            </tr>\n                        </thead>\n                        <tbody class=\"bg-white divide-y divide-slate-200\">\n                            {rows_html}\n                        </tbody>\n                    </table>\n    \"\"\"\n\ndef generate_squeeze_table_html(data):\n    \"\"\"Generates the HTML for the Short Squeeze table.\"\"\"\n    rows_html = \"\"\n    for i, row in enumerate(data):\n        bg_class = \"bg-slate-50\" if i % 2 != 0 else \"\"\n        rows_html += f\"\"\"\n                            <tr class=\"{bg_class}\">\n                                <td class=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900\">{row['ticker']}</td>\n                                <td class=\"px-6 py-4 whitespace-nowrap text-sm text-slate-500\">{row['name']}</td>\n                                <td class=\"px-6 py-4 whitespace-nowrap text-sm text-slate-500\">{row['industry']}</td>\n                                <td class=\"px-6 py-4 whitespace-nowrap text-sm text-slate-500\">{row['price']}</td>\n                                <td class=\"px-6 py-4 whitespace-nowrap text-sm text-slate-500 arrow-{row['price_direction']}\">{row['price_wow']}</td>\n                                <td class=\"px-6 py-4 whitespace-nowrap text-sm text-slate-500\">{row['score']}</td>\n                                <td class=\"px-6 py-4 whitespace-nowrap text-sm text-slate-500 arrow-{row['score_direction']}\">{row['score_wow']}</td>\n                            </tr>\n        \"\"\"\n    return f\"\"\"\n                    <!-- Market Technicals & Squeeze Metrics Table -->\n                    <table class=\"min-w-full divide-y divide-slate-200\">\n                        <thead class=\"bg-slate-50\">\n                            <tr>\n                                <th scope=\"col\" class=\"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">Ticker</th>\n                                <th scope=\"col\" class=\"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">Company Name</th>\n                                <th scope=\"col\" class=\"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">Industry</th>\n                                <th scope=\"col\" class=\"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">Price</th>\n                                <th scope=\"col\" class=\"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">Price (WoW)</th>\n                                <th scope=\"col\" class=\"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">Short Squeeze Score</th>\n                                <th scope=\"col\" class=\"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">Score (WoW)</th>\n                            </tr>\n                        </thead>\n                        <tbody class=\"bg-white divide-y divide-slate-200\">\n                            {rows_html}\n                        </tbody>\n                    </table>\n    \"\"\"\n\ndef generate_takeaways_html(takeaways_data):\n    \"\"\"Generates the HTML for the Key Takeaways section.\"\"\"\n    list_items_html = \"\"\n    for item in takeaways_data:\n        list_items_html += f\"<li>{item}</li>\\n\"\n    \n    return f\"\"\"\n            <!-- Key Takeaways Section -->\n            <section>\n                <h2 class=\"text-2xl font-bold text-slate-800 mb-4 flex items-center\">\n                    <span class=\"text-2xl mr-3\">ðŸ’¡</span> Key Takeaways\n                </h2>\n                <ul class=\"space-y-3 list-disc list-inside text-slate-700\">\n                    {list_items_html}\n                </ul>\n            </section>\n    \"\"\"\n\ndef create_report_html(date, market_notes, headlines, htb_data, squeeze_data, takeaways):\n    \"\"\"Assembles the full HTML document from all the pieces.\"\"\"\n    \n    # Generate HTML for each section\n    market_notes_section = generate_market_notes_html(market_notes)\n    headlines_section = generate_headlines_html(headlines)\n    htb_table_section = generate_htb_table_html(htb_data)\n    squeeze_table_section = generate_squeeze_table_html(squeeze_data)\n    takeaways_section = generate_takeaways_html(takeaways)\n\n    # Assemble the final HTML\n    full_html = f\"\"\"\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>EquiLend D&A Daily Digest - {date}</title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n    <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap\" rel=\"stylesheet\">\n    <style>\n        body {{\n            font-family: 'Inter', sans-serif;\n        }}\n        /* Simple styling for up/down arrows */\n        .arrow-up {{ color: #16a34a; }} /* Green */\n        .arrow-down {{ color: #dc2626; }} /* Red */\n    </style>\n</head>\n<body class=\"bg-slate-100\">\n\n    <div class=\"container mx-auto p-4 sm:p-6 md:p-8 max-w-4xl\">\n        \n        <!-- Header Section -->\n        <header class=\"bg-sky-600 text-white p-6 rounded-t-xl\">\n            <h1 class=\"text-3xl md:text-4xl font-bold\">EquiLend D&A Daily Digest</h1>\n            <p class=\"text-lg text-sky-200 mt-1\">{date}</p>\n        </header>\n\n        <div class=\"bg-white rounded-b-xl shadow-md p-6 sm:p-8 space-y-8\">\n\n            {market_notes_section}\n\n            <hr class=\"border-slate-200\">\n\n            {headlines_section}\n\n            <hr class=\"border-slate-200\">\n\n            <!-- Tables Section -->\n            <section>\n                <h2 class=\"text-2xl font-bold text-slate-800 mb-4 flex items-center\">\n                    <span class=\"text-2xl mr-3\">ðŸ“Š</span> Today's Specials & Hard-to-Borrow\n                </h2>\n                <div class=\"overflow-x-auto mb-8\">\n                    {htb_table_section}\n                </div>\n\n                <h2 class=\"text-2xl font-bold text-slate-800 mb-4 flex items-center\">\n                    <span class=\"text-2xl mr-3\">ðŸ“‰</span> Market Technicals & Squeeze Metrics\n                </h2>\n                <div class=\"overflow-x-auto\">\n                    {squeeze_table_section}\n                </div>\n            </section>\n\n            <hr class=\"border-slate-200\">\n\n            {takeaways_section}\n\n        </div>\n\n        <!-- Footer -->\n        <footer class=\"text-center mt-8\">\n            <p class=\"text-sm text-slate-500\">Source: EquiLend Data & Analytics</p>\n        </footer>\n\n    </div>\n\n</body>\n</html>\n\"\"\"\n    return full_html\n\n# --- MAIN EXECUTION ---\nif __name__ == \"__main__\":\n    # Generate the full HTML content\n    report_html = create_report_html(\n        REPORT_DATE,\n        MARKET_NOTES,\n        HEADLINES,\n        HARD_TO_BORROW_DATA,\n        SHORT_SQUEEZE_DATA,\n        KEY_TAKEAWAYS\n    )\n\n    # Write the HTML to a file\n    file_name = f\"daily_digest_{REPORT_DATE.replace(' ', '_').replace(',', '')}.html\"\n    with open(file_name, \"w\", encoding=\"utf-8\") as f:\n        f.write(report_html)\n\n    print(f\"Report successfully generated: {os.path.abspath(file_name)}\")","outputs":[],"execution_count":null,"metadata":{}}],"metadata":{"colab":{"from_bard":true},"kernelspec":{"display_name":"Python 3","name":"python3"}},"nbformat":4,"nbformat_minor":0}