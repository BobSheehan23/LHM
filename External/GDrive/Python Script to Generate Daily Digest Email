{"cells":[{"cell_type":"code","source":"import pandas as pd\nfrom datetime import datetime\n\n# --- Configuration ---\n# Define the input CSV file and the desired output HTML file name.\n# The script will automatically parse the date from the CSV filename.\ncsv_filename = 'DailyDD_2025-07-11_bsheehan.csv'\noutput_html_filename = f\"EquiLend_Daily_Digest_{datetime.now().strftime('%Y-%m-%d')}.html\"\n\n# --- Data Loading and Preparation ---\ntry:\n    # Read the raw data from the CSV file into a pandas DataFrame.\n    df = pd.read_csv(csv_filename)\n    print(f\"Successfully loaded data from {csv_filename}\")\nexcept FileNotFoundError:\n    print(f\"Error: The file '{csv_filename}' was not found. Please ensure it is in the same directory as the script.\")\n    exit()\n\n# --- Table Filtering Logic ---\n# 1. Specials Table: Filter for securities with positive week-over-week fee momentum.\n#    Then, sort by the highest fee to get the top names.\nspecials_df = df[df['Fee_WoW'] > 0].sort_values(by='Fee_bps', ascending=False).head(5)\nprint(f\"Filtered down to {len(specials_df)} securities for the 'Specials' table.\")\n\n# 2. Market Technicals Table: Filter for securities with a Short Squeeze Score > 70.\n#    Then, sort by the highest score to feature the most at-risk names.\ntechnicals_df = df[df['ShortSqueezeScore'] > 70].sort_values(by='ShortSqueezeScore', ascending=False).head(4)\nprint(f\"Filtered down to {len(technicals_df)} securities for the 'Market Technicals' table.\")\n\n\n# --- HTML Generation Functions ---\n\ndef generate_specials_rows(df):\n    \"\"\"Generates the HTML table rows for the 'Specials' table.\"\"\"\n    rows_html = \"\"\n    for i, row in df.iterrows():\n        # Alternate row colors for readability, a common email design practice.\n        bg_color = \"#F8F9FA\" if i % 2 != 0 else \"\" \n        rows_html += f\"\"\"\n        <tr style=\"background-color: {bg_color};\">\n            <td style=\"padding: 12px 15px; text-align: left; border-bottom: 1px solid #DDDDDD;\">{row['Ticker']}</td>\n            <td style=\"padding: 12px 15px; text-align: left; border-bottom: 1px solid #DDDDDD;\">{row['CompanyName']}</td>\n            <td style=\"padding: 12px 15px; text-align: left; border-bottom: 1px solid #DDDDDD;\">{row['Industry']}</td>\n            <td style=\"padding: 12px 15px; text-align: left; border-bottom: 1px solid #DDDDDD;\">{row['Fee_bps']:,.0f}+</td>\n            <td style=\"padding: 12px 15px; text-align: left; border-bottom: 1px solid #DDDDDD; color: #008A00;\">+{row['Fee_WoW']:,.0f} BPS</td>\n        </tr>\n        \"\"\"\n    return rows_html\n\ndef generate_technicals_rows(df):\n    \"\"\"Generates the HTML table rows for the 'Market Technicals' table.\"\"\"\n    rows_html = \"\"\n    for i, row in df.iterrows():\n        bg_color = \"#F8F9FA\" if i % 2 != 0 else \"\"\n        # Determine color for price and score changes: green for positive, red for negative.\n        price_change_color = \"#008A00\" if row['Price_WoW'] > 0 else \"#D90000\"\n        score_change_color = \"#008A00\" if row['Score_WoW'] > 0 else \"#D90000\"\n        price_sign = \"+\" if row['Price_WoW'] > 0 else \"\"\n        score_sign = \"+\" if row['Score_WoW'] > 0 else \"\"\n\n        rows_html += f\"\"\"\n        <tr style=\"background-color: {bg_color};\">\n            <td style=\"padding: 12px 15px; text-align: left; border-bottom: 1px solid #DDDDDD;\">{row['Ticker']}</td>\n            <td style=\"padding: 12px 15px; text-align: left; border-bottom: 1px solid #DDDDDD;\">{row['CompanyName']}</td>\n            <td style=\"padding: 12px 15px; text-align: left; border-bottom: 1px solid #DDDDDD;\">{row['Industry']}</td>\n            <td style=\"padding: 12px 15px; text-align: left; border-bottom: 1px solid #DDDDDD;\">${row['Price']:,.2f}</td>\n            <td style=\"padding: 12px 15px; text-align: left; border-bottom: 1px solid #DDDDDD; color: {price_change_color};\">{price_sign}{row['Price_WoW']:.1f}%</td>\n            <td style=\"padding: 12px 15px; text-align: left; border-bottom: 1px solid #DDDDDD;\">{row['ShortSqueezeScore']:.2f}</td>\n            <td style=\"padding: 12px 15px; text-align: left; border-bottom: 1px solid #DDDDDD; color: {score_change_color};\">{score_sign}{row['Score_WoW']:.2f}</td>\n        </tr>\n        \"\"\"\n    return rows_html\n\n# --- Main HTML Template ---\n# This uses an f-string to build the entire HTML document.\n# All styles are inlined and the layout is table-based for maximum email client compatibility.\n\nhtml_template = f\"\"\"\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n<title>EquiLend D&A Daily Digest</title>\n</head>\n<body style=\"font-family: Arial, Helvetica, sans-serif; background-color: #F4F4F4; color: #000000; margin: 0; padding: 0;\">\n\n<table role=\"presentation\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"background-color: #F4F4F4;\">\n  <tr>\n    <td>\n      <table align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"800\" style=\"max-width: 800px; margin: 20px auto; background-color: #FFFFFF; border: 1px solid #DDDDDD; border-radius: 8px; overflow: hidden;\">\n        \n        <!-- Header -->\n        <tr>\n          <td style=\"background-color: #0078D4; color: #FFFFFF; padding: 20px 30px;\">\n            <h1 style=\"margin: 0; font-family: Arial, Helvetica, sans-serif; font-size: 28px; color: #FFFFFF;\">EquiLend D&A Daily Digest</h1>\n            <p style=\"margin: 5px 0 0; font-family: Arial, Helvetica, sans-serif; font-size: 16px; color: #FFFFFF; font-weight: bold;\">{datetime.now().strftime('%B %d, %Y')}</p>\n          </td>\n        </tr>\n\n        <!-- Content -->\n        <tr>\n          <td style=\"padding: 20px 30px;\">\n            \n            <!-- Market Notes Section -->\n            <table role=\"presentation\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"margin-bottom: 25px; border-bottom: 1px solid #EEEEEE; padding-bottom: 25px;\">\n              <tr>\n                <td>\n                  <h2 style=\"font-family: Arial, Helvetica, sans-serif; font-size: 14px; font-weight: bold; color: #0078D4; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px;\">ðŸ“ˆ Market Notes</h2>\n                  <ul style=\"list-style-type: none; padding-left: 0; margin: 0; font-family: Arial, Helvetica, sans-serif; font-size: 16px; line-height: 1.7;\">\n                    <li style=\"margin-bottom: 8px;\"><strong>Fee All:</strong> 49.4 bps <span style=\"color: #008A00;\">â–²4.75%</span></li>\n                    <li><strong>Utilization:</strong> 7% <span style=\"color: #008A00;\">â–²0.26%</span></li>\n                  </ul>\n                </td>\n              </tr>\n            </table>\n\n            <!-- Headlines Section -->\n            <table role=\"presentation\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"margin-bottom: 25px; border-bottom: 1px solid #EEEEEE; padding-bottom: 25px;\">\n              <tr>\n                <td>\n                  <h2 style=\"font-family: Arial, Helvetica, sans-serif; font-size: 14px; font-weight: bold; color: #0078D4; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px;\">ðŸ”¥ Major Headlines & What Our Data Shows</h2>\n                  \n                  <h3 style=\"font-family: Arial, Helvetica, sans-serif; font-size: 20px; color: #000000; margin-top: 0; margin-bottom: 10px;\">S&P 500 AND NASDAQ HIT RECORD HIGHS AMID STRONG MARKET PERFORMANCE</h3>\n                  <p style=\"font-family: Arial, Helvetica, sans-serif; font-size: 16px; line-height: 1.7; margin: 0 0 1em 0; color: #000000;\">U.S. stock markets continued their upward trajectory, with the S&P 500 and Nasdaq reaching new record highs, driven by strong performances in tech and airline stocks. Delta Airlines' robust earnings boosted airline stocks, while Nvidia's stock pushed its market cap above $4 trillion, reflecting ongoing AI-driven market optimism. The Dow Jones Industrial Average also rose 0.19%, closing at 44,541. Investors largely shrugged off earlier tariff concerns, supported by a quiet macro environment with minimal economic data releases.</p>\n                  <div style=\"background-color: #F8F9FA; border-left: 3px solid #742785; padding: 15px; margin-top: 15px; font-family: Arial, Helvetica, sans-serif; font-size: 15px; line-height: 1.6;\">\n                    <strong style=\"color: #742785; font-weight: bold;\">What Our Data Shows:</strong> While broad market indices continue to reach new highs, our data shows a contrasting trend in the securities lending market. The average cost to borrow U.S. equities has steadily increased from 45.7 bps in mid-May to 107.5 bps as of yesterday, marking a one-year high. This divergence may indicate that some market participants are increasing short positions or hedges despite the overall market optimism.\n                  </div>\n\n                  <table role=\"presentation\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"margin-top: 30px;\"><tr><td>\n                    <h3 style=\"font-family: Arial, Helvetica, sans-serif; font-size: 20px; color: #000000; margin-top: 0; margin-bottom: 10px;\">BITCOIN SURGES TO RECORD HIGH ABOVE $113,000</h3>\n                    <p style=\"font-family: Arial, Helvetica, sans-serif; font-size: 16px; line-height: 1.7; margin: 0 0 1em 0; color: #000000;\">Bitcoin hit a new all-time high of $113,734.64, up approximately 21% year-to-date, driven by momentum buying in the cryptocurrency space. Ethereum also saw significant gains, lifting the broader crypto market. This surge reflects growing investor enthusiasm for digital assets, with posts on X highlighting the U.S. Treasuryâ€™s cancellation of crypto broker reporting rules as a potential catalyst for the rally. The crypto marketâ€™s strength contrasts with traditional markets, signaling a shift in investor risk appetite.</p>\n                    <div style=\"background-color: #F8F9FA; border-left: 3px solid #742785; padding: 15px; margin-top: 15px; font-family: Arial, Helvetica, sans-serif; font-size: 15px; line-height: 1.6;\">\n                      <strong style=\"color: #742785; font-weight: bold;\">What Our Data Shows:</strong> Coinciding with the heightened interest in digital assets, our data indicates a notable decrease in bearish sentiment for a key traditional market sector. Borrowing costs in U.S. Diversified Financials have declined by 36% over the past two weeks, falling from a recent peak of 63.2 bps on June 24th. This could suggest a rotation of focus and risk appetite among investors.\n                    </div>\n                  </td></tr></table>\n\n                  <table role=\"presentation\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"margin-top: 30px;\"><tr><td>\n                    <h3 style=\"font-family: Arial, Helvetica, sans-serif; font-size: 20px; color: #000000; margin-top: 0; margin-bottom: 10px;\">LILLY GAINS FDA APPROVAL FOR MODIFIED ALZHEIMER'S DRUG DOSING AMID SAFETY CONCERNS</h3>\n                    <p style=\"font-family: Arial, Helvetica, sans-serif; font-size: 16px; line-height: 1.7; margin: 0 0 1em 0; color: #000000;\">Eli Lilly has received FDA approval for a modified dosing schedule for its Alzheimer's drug, Kisunla, aimed at mitigating safety concerns. The updated label allows for a new dosing regimen, a key development for one of the most closely watched drugs in the pharmaceutical industry. This decision follows intense scrutiny and debate over the drug's safety profile and is a significant event for the company and the broader Alzheimer's treatment landscape.</p>\n                    <div style=\"background-color: #F8F9FA; border-left: 3px solid #742785; padding: 15px; margin-top: 15px; font-family: Arial, Helvetica, sans-serif; font-size: 15px; line-height: 1.6;\">\n                      <strong style=\"color: #742785; font-weight: bold;\">What Our Data Shows:</strong> This theme of positioning ahead of major regulatory decisions is visible across the sector. In a recent example, Capricor Therapeutics saw borrowing costs rise to an exceptional 5,934 bps and utilization hold above 99% in the days leading up to an unfavorable FDA announcement. Such extreme metrics can signal heightened investor skepticism surrounding a binary event.\n                    </div>\n                  </td></tr></table>\n                </td>\n              </tr>\n            </table>\n            \n            <!-- Tables Section -->\n            <table role=\"presentation\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"margin-bottom: 25px; border-bottom: 1px solid #EEEEEE; padding-bottom: 25px;\">\n              <tr>\n                <td>\n                  <h2 style=\"font-family: Arial, Helvetica, sans-serif; font-size: 14px; font-weight: bold; color: #0078D4; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px;\">ðŸ“Š Today's Specials & Hard-to-Borrow</h2>\n                  <table role=\"presentation\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"width: 100%; border-collapse: collapse; margin-top: 20px; font-family: Arial, Helvetica, sans-serif; font-size: 14px;\">\n                    <caption style=\"font-size: 18px; font-weight: bold; color: #000000; text-align: left; margin-bottom: 15px; caption-side: top;\">Specials with Fee Momentum</caption>\n                    <thead>\n                      <tr>\n                        <th style=\"background-color: #0078D4; color: #FFFFFF; font-weight: bold; text-transform: uppercase; font-size: 12px; padding: 12px 15px; text-align: left; border-bottom: 1px solid #DDDDDD;\">Ticker</th>\n                        <th style=\"background-color: #0078D4; color: #FFFFFF; font-weight: bold; text-transform: uppercase; font-size: 12px; padding: 12px 15px; text-align: left; border-bottom: 1px solid #DDDDDD;\">Name</th>\n                        <th style=\"background-color: #0078D4; color: #FFFFFF; font-weight: bold; text-transform: uppercase; font-size: 12px; padding: 12px 15px; text-align: left; border-bottom: 1px solid #DDDDDD;\">Industry</th>\n                        <th style=\"background-color: #0078D4; color: #FFFFFF; font-weight: bold; text-transform: uppercase; font-size: 12px; padding: 12px 15px; text-align: left; border-bottom: 1px solid #DDDDDD;\">Fee (BPS)</th>\n                        <th style=\"background-color: #0078D4; color: #FFFFFF; font-weight: bold; text-transform: uppercase; font-size: 12px; padding: 12px 15px; text-align: left; border-bottom: 1px solid #DDDDDD;\">Momentum (WoW)</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      {generate_specials_rows(specials_df)}\n                    </tbody>\n                  </table>\n                  \n                  <table role=\"presentation\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"width: 100%; border-collapse: collapse; margin-top: 40px; font-family: Arial, Helvetica, sans-serif; font-size: 14px;\">\n                    <caption style=\"font-size: 18px; font-weight: bold; color: #000000; text-align: left; margin-bottom: 15px; caption-side: top;\">Market Technicals & Short Squeeze Risk</caption>\n                    <thead>\n                      <tr>\n                        <th style=\"background-color: #0078D4; color: #FFFFFF; font-weight: bold; text-transform: uppercase; font-size: 12px; padding: 12px 15px; text-align: left; border-bottom: 1px solid #DDDDDD;\">Ticker</th>\n                        <th style=\"background-color: #0078D4; color: #FFFFFF; font-weight: bold; text-transform: uppercase; font-size: 12px; padding: 12px 15px; text-align: left; border-bottom: 1px solid #DDDDDD;\">Company Name</th>\n                        <th style=\"background-color: #0078D4; color: #FFFFFF; font-weight: bold; text-transform: uppercase; font-size: 12px; padding: 12px 15px; text-align: left; border-bottom: 1px solid #DDDDDD;\">Industry</th>\n                        <th style=\"background-color: #0078D4; color: #FFFFFF; font-weight: bold; text-transform: uppercase; font-size: 12px; padding: 12px 15px; text-align: left; border-bottom: 1px solid #DDDDDD;\">Price</th>\n                        <th style=\"background-color: #0078D4; color: #FFFFFF; font-weight: bold; text-transform: uppercase; font-size: 12px; padding: 12px 15px; text-align: left; border-bottom: 1px solid #DDDDDD;\">Price (WoW)</th>\n                        <th style=\"background-color: #0078","outputs":[],"execution_count":null,"metadata":{}}],"metadata":{"colab":{"from_bard":true},"kernelspec":{"display_name":"Python 3","name":"python3"}},"nbformat":4,"nbformat_minor":0}