{"cells":[{"cell_type":"code","source":["import requests\n","import json\n","\n","def connect_to_orbisa_api(api_key: str, endpoint_url: str, params: dict = None):\n","    \"\"\"\n","    Connects to a specified Orbisa API endpoint, handles authentication,\n","    and retrieves data.\n","\n","    This function is designed for making GET requests and assumes the API uses\n","    a Bearer Token for authentication, which is a common industry standard.\n","\n","    Args:\n","        api_key (str): Your unique API key provided by Orbisa/EquiLend.\n","        endpoint_url (str): The full URL of the API endpoint you wish to query.\n","                           (e.g., \"https://api.orbisa.com/v1/data/securities-lending\")\n","        params (dict, optional): A dictionary of query parameters to filter the\n","                                 request (e.g., {'ticker': 'AAPL'}). Defaults to None.\n","\n","    Returns:\n","        dict: The JSON data returned from the API as a Python dictionary.\n","              Returns None if an error occurs during the request.\n","    \"\"\"\n","    if not api_key or api_key == \"YOUR_API_KEY_HERE\":\n","        print(\"❌ ERROR: API key is not set. Please replace 'YOUR_API_KEY_HERE' with your actual key.\")\n","        return None\n","\n","    # --- 1. Set Authentication Headers ---\n","    # The 'Authorization' header securely transmits your API key to the server.\n","    # The 'Bearer' scheme is a standard way to handle token-based authentication.\n","    headers = {\n","        'Authorization': f'Bearer {api_key}',\n","        'Content-Type': 'application/json'\n","    }\n","\n","    print(f\"▶️  Attempting to connect to: {endpoint_url}\")\n","\n","    # --- 2. Make the API Request with Error Handling ---\n","    try:\n","        # 'requests.get' sends the HTTP request to the server.\n","        # We include headers for authentication and params for filtering.\n","        # A timeout is added as a best practice to prevent the script from hanging indefinitely.\n","        response = requests.get(endpoint_url, headers=headers, params=params, timeout=30)\n","\n","        # This line is crucial. It will automatically raise an exception (HTTPError)\n","        # if the API returns a non-successful status code (e.g., 401 Unauthorized, 404 Not Found).\n","        response.raise_for_status()\n","\n","        # --- 3. Process a Successful Response ---\n","        print(f\"✅ Success! Received response with Status Code: {response.status_code}\")\n","        # 'response.json()' parses the JSON content from the response into a Python dictionary.\n","        return response.json()\n","\n","    except requests.exceptions.HTTPError as http_err:\n","        # Catches errors returned by the API server (4xx or 5xx status codes).\n","        print(f\"❌ HTTP Error Occurred: {http_err}\")\n","        print(f\"   Status Code: {response.status_code}\")\n","        print(f\"   Response Body: {response.text}\")\n","    except requests.exceptions.ConnectionError as conn_err:\n","        # Catches network-related errors (e.g., DNS failure, refused connection).\n","        print(f\"❌ Connection Error Occurred: {conn_err}\")\n","    except requests.exceptions.Timeout as timeout_err:\n","        # Catches errors where the request took too long to complete.\n","        print(f\"❌ Timeout Error Occurred: {timeout_err}\")\n","    except requests.exceptions.RequestException as req_err:\n","        # A catch-all for any other error from the 'requests' library.\n","        print(f\"❌ An unexpected error occurred: {req_err}\")\n","\n","    return None\n","\n","# --- Example of How to Use the Function ---\n","if __name__ == \"__main__\":\n","    # --- Configuration ---\n","    # IMPORTANT: Replace these placeholder values with your actual credentials.\n","    MY_API_KEY = \"YOUR_API_KEY_HERE\"\n","\n","    # This is an example endpoint. You will need to get the correct URLs\n","    # from the official Orbisa API documentation for the data you need.\n","    TARGET_ENDPOINT_URL = \"https://api.orbisa.com/v1/data/sample-endpoint\"\n","\n","    # Optional: Define parameters to filter your query.\n","    # For example, to get short interest data for a specific stock.\n","    query_params = {\n","        'ticker': 'TSLA',\n","        'exchange': 'NASDAQ',\n","        'startDate': '2025-01-01'\n","    }\n","\n","    # --- Function Call ---\n","    # Call the function with your configuration to get the data.\n","    api_data = connect_to_orbisa_api(MY_API_KEY, TARGET_ENDPOINT_URL, params=query_params)\n","\n","    # --- Display Results ---\n","    if api_data:\n","        print(\"\\n--- API Data Received ---\")\n","        # 'json.dumps' with an indent makes the output readable.\n","        print(json.dumps(api_data, indent=4))\n","        print(\"------------------------\")"],"outputs":[{"output_type":"stream","name":"stdout","text":["❌ ERROR: API key is not set. Please replace 'YOUR_API_KEY_HERE' with your actual key.\n"]}],"execution_count":2,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"r0O5Gvw3Lk2L","executionInfo":{"status":"ok","timestamp":1752014564842,"user_tz":240,"elapsed":16,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"9d400746-db85-4e6f-9fbf-9f783f87ce37"}},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"29ead721","executionInfo":{"status":"ok","timestamp":1752015272784,"user_tz":240,"elapsed":8,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"3785d8ae-cdcd-4b03-c402-afd0d7cf025e"},"source":["import json\n","\n","file_path = \"/content/orbisa_config.json\"\n","\n","try:\n","    with open(file_path, 'r') as f:\n","        config_data = json.load(f)\n","\n","    if 'api_key' in config_data:\n","        api_key_value = config_data['api_key']\n","        if api_key_value and api_key_value != \"YOUR_API_KEY_HERE\":\n","            print(f\"✅ The file '{file_path}' contains an API key.\")\n","        else:\n","            print(f\"⚠️ The file '{file_path}' contains an 'api_key' field, but it is empty or still contains the placeholder 'YOUR_API_KEY_HERE'.\")\n","    else:\n","        print(f\"❌ The file '{file_path}' does not contain an 'api_key' field.\")\n","\n","except FileNotFoundError:\n","    print(f\"❌ Error: The file '{file_path}' was not found.\")\n","except json.JSONDecodeError:\n","    print(f\"❌ Error: Could not decode JSON from '{file_path}'. Please ensure it's a valid JSON file.\")\n","except Exception as e:\n","    print(f\"❌ An unexpected error occurred: {e}\")"],"execution_count":3,"outputs":[{"output_type":"stream","name":"stdout","text":["✅ The file '/content/orbisa_config.json' contains an API key.\n"]}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"157f6866","executionInfo":{"status":"ok","timestamp":1752016694519,"user_tz":240,"elapsed":195,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"48345052-28c1-45d8-c700-0cafdc67356e"},"source":["# Load the configuration data from the JSON file\n","file_path = \"/content/orbisa_config.json\"\n","try:\n","    with open(file_path, 'r') as f:\n","        config_data = json.load(f)\n","\n","    MY_API_KEY = config_data.get('api_key', \"YOUR_API_KEY_HERE\")\n","    TARGET_ENDPOINT_URL = \"https://api.orbisa.com/v1/data/sample-endpoint\" # Replace with your actual endpoint\n","    query_params = {\n","        'ticker': 'TSLA',\n","        'exchange': 'NASDAQ',\n","        'startDate': '2025-01-01'\n","    } # Replace with your actual parameters\n","\n","    # Call the function to get the data\n","    api_data = connect_to_orbisa_api(MY_API_KEY, TARGET_ENDPOINT_URL, params=query_params)\n","\n","    # Display the results\n","    if api_data:\n","        print(\"\\n--- API Data Received ---\")\n","        print(json.dumps(api_data, indent=4))\n","        print(\"------------------------\")\n","\n","except FileNotFoundError:\n","    print(f\"❌ Error: The file '{file_path}' was not found.\")\n","except json.JSONDecodeError:\n","    print(f\"❌ Error: Could not decode JSON from '{file_path}'. Please ensure it's a valid JSON file.\")\n","except Exception as e:\n","    print(f\"❌ An unexpected error occurred: {e}\")"],"execution_count":4,"outputs":[{"output_type":"stream","name":"stdout","text":["▶️  Attempting to connect to: https://api.orbisa.com/v1/data/sample-endpoint\n","❌ HTTP Error Occurred: 403 Client Error: Forbidden for url: https://api.orbisa.com/v1/data/sample-endpoint?ticker=TSLA&exchange=NASDAQ&startDate=2025-01-01\n","   Status Code: 403\n","   Response Body: {\"message\":\"Forbidden\"}\n"]}]}],"metadata":{"colab":{"provenance":[]},"kernelspec":{"display_name":"Python 3","name":"python3"}},"nbformat":4,"nbformat_minor":0}