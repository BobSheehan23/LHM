{"cells":[{"cell_type":"code","metadata":{"id":"5a45e314","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1754567852000,"user_tz":240,"elapsed":10857,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"cfeaddc7-8f96-412e-ea98-32ec61833af9"},"source":["!pip install python-docx"],"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Collecting python-docx\n","  Downloading python_docx-1.2.0-py3-none-any.whl.metadata (2.0 kB)\n","Requirement already satisfied: lxml>=3.1.0 in /usr/local/lib/python3.11/dist-packages (from python-docx) (5.4.0)\n","Requirement already satisfied: typing_extensions>=4.9.0 in /usr/local/lib/python3.11/dist-packages (from python-docx) (4.14.1)\n","Downloading python_docx-1.2.0-py3-none-any.whl (252 kB)\n","\u001b[2K   \u001b[90mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\u001b[0m \u001b[32m253.0/253.0 kB\u001b[0m \u001b[31m4.3 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hInstalling collected packages: python-docx\n","Successfully installed python-docx-1.2.0\n"]}]},{"cell_type":"code","source":["from google.colab import files\n","\n","uploaded = files.upload()\n","\n","for fn in uploaded.keys():\n","  print('User uploaded file \"{name}\" with length {length} bytes'.format(\n","      name=fn, length=len(uploaded[fn])))"],"metadata":{"id":"xUqeCwg0CEJw"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["import pandas as pd\n","import docx\n","from datetime import datetime\n","import re\n","import numpy as np\n","\n","# --- Configuration ---\n","# The script will read all content from this file.\n","# Ensure it is in the same directory as the script.\n","CONTENT_DOC_PATH = 'daily_content.docx'\n","OUTPUT_HTML_PATH = f\"equilend_daily_digest_{datetime.now().strftime('%Y_%m_%d')}.html\"\n","\n","# --- 1. DOCX Content Parsing ---\n","\n","def parse_daily_content(doc_path):\n","    \"\"\"\n","    Parses the .docx file for all text content, including market notes, headlines, key takeaways,\n","    and the content of the \"Hot & Getting Hotter\" and \"Squeeze Metrics\" tables.\n","    \"\"\"\n","    try:\n","        document = docx.Document(doc_path)\n","    except Exception as e:\n","        print(f\"Error opening or parsing DOCX file: {e}\")\n","        return None\n","\n","    content = {'market_notes': {}, 'headlines': [], 'key_takeaways': [], 'ht_borrow_table': [], 'squeeze_table': []}\n","    paras = [p.text.strip() for p in document.paragraphs if p.text.strip()]\n","    print(\"Parsed Paragraphs (for debugging):\")\n","    for i, p in enumerate(paras):\n","        print(f\"Paragraph {i}: {p}\")\n","\n","\n","    # --- Parse Market Notes from Table ---\n","    try:\n","        # Assuming Market Notes is Table 2\n","        market_notes_table_index = 1 # 0-indexed\n","        if len(document.tables) > market_notes_table_index:\n","            market_notes_table = document.tables[market_notes_table_index]\n","            print(f\"Identified Table {market_notes_table_index + 1} as potential Market Notes table.\")\n","\n","            # Assuming the table has 2 rows and 2 columns with merged cells in the first row\n","            print(\"Market Notes Table Content (for debugging):\")\n","            if len(market_notes_table.rows) >= 2 and len(market_notes_table.rows[0].cells) >= 2:\n","                # Extract data from the first row (merged cells)\n","                cell1_text = market_notes_table.rows[0].cells[0].text.strip()\n","                cell2_text = market_notes_table.rows[0].cells[1].text.strip()\n","\n","                # Parse the text to extract the values\n","                # Example format: \"Average Fee:\\n74.9 bps\\n+93.8%\\nOn Loan Value:\\n$3.05T\\n+1.02%\"\n","                # and \"Average Utilization:\\n7.11%\\n+0.11%\\nTotal Lendable Value:\\n$42.9T \\n+0.90%\"\n","\n","                # Parse Cell 1\n","                lines1 = cell1_text.split('\\n')\n","                print(f\"Cell 1 Lines: {lines1}\")\n","                if len(lines1) >= 4:\n","                    content['market_notes']['avg_fee_bps'] = lines1[1].replace('bps', '').strip()\n","                    change_match = re.search(r'([+-]?\\d+\\.?\\d*)%?', lines1[2])\n","                    content['market_notes']['avg_fee_change'] = float(change_match.group(1).replace('+','')) if change_match else 0.0\n","                    content['market_notes']['on_loan_value'] = lines1[4].replace('$', '').strip()\n","                    change_match = re.search(r'([+-]?\\d+\\.?\\d*)%?', lines1[5])\n","                    content['market_notes']['on_loan_value_change'] = float(change_match.group(1).replace('+','')) if change_match else 0.0\n","\n","                # Parse Cell 2\n","                lines2 = cell2_text.split('\\n')\n","                print(f\"Cell 2 Lines: {lines2}\")\n","                if len(lines2) >= 4:\n","                    content['market_notes']['avg_util_percent'] = lines2[1].replace('%', '').strip()\n","                    change_match = re.search(r'([+-]?\\d+\\.?\\d*)%?', lines2[2])\n","                    content['market_notes']['avg_util_change'] = float(change_match.group(1).replace('+','')) if change_match else 0.0\n","                    content['market_notes']['lendable_value'] = lines2[4].replace('$', '').strip()\n","                    change_match = re.search(r'([+-]?\\d+\\.?\\d*)%?', lines2[5])\n","                    content['market_notes']['lendable_value_change'] = float(change_match.group(1).replace('+','')) if change_match else 0.0\n","\n","\n","        else:\n","            print(f\"Warning: Could not find Table {market_notes_table_index + 1} for Market Notes.\")\n","\n","    except Exception as e:\n","        print(f\"Warning: Could not parse Market Notes from table. Error: {e}\")\n","\n","\n","    # --- Parse Headlines ---\n","    # This part remains the same as it parses from paragraphs\n","    try:\n","        headline_start_index = -1\n","        for i, p_text in enumerate(paras):\n","            if 'major headlines' in p_text.lower():\n","                headline_start_index = i + 1\n","                break\n","\n","        if headline_start_index != -1:\n","            i = headline_start_index\n","            while i < len(paras):\n","                end_of_block_idx = -1\n","                # Find the next data insight line\n","                for j in range(i + 1, len(paras)):\n","                    if 'what our data shows' in paras[j].lower():\n","                        end_of_block_idx = j\n","                        break\n","\n","                if end_of_block_idx != -1:\n","                    title = paras[i].rstrip(':').rstrip('.')\n","                    description = \"\\n\".join(paras[i+1:end_of_block_idx])\n","                    data_insight_raw = paras[end_of_block_idx]\n","                    data_insight = re.sub(r'[\\starbullet\\s]*What our data shows:\\s?', '', data_insight_raw, flags=re.IGNORECASE).strip()\n","\n","                    content['headlines'].append({\n","                        'title': title,\n","                        'description': description,\n","                        'data_insight': data_insight\n","                    })\n","                    i = end_of_block_idx + 1\n","                else:\n","                    break # No more headline blocks found\n","    except Exception as e:\n","        print(f\"Warning: Could not parse Headlines. Error: {e}\")\n","\n","    # --- Parse Tables (Hot & Getting Hotter and Squeeze Metrics) ---\n","    try:\n","        # Assuming Hot & Getting Hotter is Table 3 and Squeeze Metrics is Table 4\n","        ht_borrow_table_index = 2 # 0-indexed\n","        squeeze_table_index = 3 # 0-indexed\n","\n","        if len(document.tables) > ht_borrow_table_index:\n","            ht_borrow_table = document.tables[ht_borrow_table_index]\n","            print(f\"Identified Table {ht_borrow_table_index + 1} as 'Hot & Getting Hotter'.\")\n","            if ht_borrow_table.rows:\n","                 for r_idx, row in enumerate(ht_borrow_table.rows[1:]): # Skip header row\n","                        cells = [cell.text.strip() for cell in row.cells]\n","                        if len(cells) >= 5: # Ensure enough columns\n","                            content['ht_borrow_table'].append({\n","                                'TICKER': cells[0],\n","                                'Security Description': cells[1],\n","                                'Industry': cells[2],\n","                                'Price': cells[3],\n","                                'Fee 1 Week Diff (BPS)': cells[4]\n","                            })\n","            print(f\"Parsed {len(content['ht_borrow_table'])} rows for 'Hot & Getting Hotter'.\")\n","        else:\n","            print(f\"Warning: Could not find Table {ht_borrow_table_index + 1} for 'Hot & Getting Hotter'.\")\n","\n","\n","        if len(document.tables) > squeeze_table_index:\n","            squeeze_table = document.tables[squeeze_table_index]\n","            print(f\"Identified Table {squeeze_table_index + 1} as 'Squeeze Metrics'.\")\n","            if squeeze_table.rows:\n","                 for r_idx, row in enumerate(squeeze_table.rows[1:]): # Skip header row\n","                        cells = [cell.text.strip() for cell in row.cells]\n","                        if len(cells) >= 6: # Ensure enough columns\n","                            content['squeeze_table'].append({\n","                                'TICKER': cells[0],\n","                                'Security Description': cells[1],\n","                                'Industry': cells[2],\n","                                'Price': cells[3],\n","                                'Short Squeeze Score (SSS)': cells[4],\n","                                'SSS WoW': cells[5]\n","                            })\n","            print(f\"Parsed {len(content['squeeze_table'])} rows for 'Squeeze Metrics'.\")\n","        else:\n","            print(f\"Warning: Could not find Table {squeeze_table_index + 1} for 'Squeeze Metrics'.\")\n","\n","\n","    except Exception as e:\n","        print(f\"Warning: Could not parse Hot & Getting Hotter or Squeeze Metrics tables from DOCX. Error: {e}\")\n","\n","\n","    # --- Parse Key Takeaways ---\n","    # This part remains the same as it parses from paragraphs\n","    try:\n","        takeaways_start_index = -1\n","        for i, p_text in enumerate(paras):\n","            if 'key takeaways' in p_text.lower():\n","                takeaways_start_index = i + 1\n","                break\n","        if takeaways_start_index != -1:\n","            for i in range(takeaways_start_index, len(paras)):\n","                line = paras[i].lstrip('-â€¢* ').strip()\n","                if not line: continue\n","                content['key_takeaways'].append(line)\n","    except Exception as e:\n","        print(f\"Warning: Could not parse Key Takeaways. Error: {e}\")\n","\n","    return content\n","\n","# --- 2. Table Parsing (Modified to use parsed data) ---\n","\n","def generate_table_html(table_data, table_type):\n","    \"\"\"\n","    Generates HTML for a table from parsed data.\n","    \"\"\"\n","    html = \"\"\n","\n","    def format_change(value, unit=' BPS', decimal_places=0):\n","        try:\n","            # Handle potential non-numeric values or empty strings\n","            if pd.isna(value) or value == '':\n","                return ''\n","\n","            cleaned_value = str(value).replace(',', '').strip()\n","            val = float(cleaned_value)\n","            color = '#16a34a' if val > 0 else '#dc2626'\n","            sign = '+' if val > 0 else ''\n","            format_string = f'{{val:,.{decimal_places}f}}{{unit}}' if decimal_places > 0 else f'{{val:,.0f}}{{unit}}'\n","            return f'<span style=\"color:{color}; font-size:14px;\">{sign}{format_string.format(val=val, unit=unit)}</span>'\n","        except (ValueError, TypeError):\n","            return str(value).strip() if pd.notna(value) else ''\n","\n","\n","    if table_type == 'ht_borrow':\n","        for row in table_data:\n","            price_value = row.get(\"Price\", \"\")\n","            formatted_price = f\"${price_value}\" if price_value != \"\" else \"\"\n","            html += f\"\"\"\n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">{row.get(\"TICKER\", \"\")}</td>\n","                <td style=\"padding:2px 4px;\">{row.get(\"Security Description\", \"\")}</td>\n","                <td style=\"padding:2px 4px;\">{row.get(\"Industry\", \"\")}</td>\n","                <td style=\"padding:2px 4px;\">{formatted_price}</td>\n","                <td style=\"padding:2px 4px;\">{format_change(row.get(\"Fee 1 Week Diff (BPS)\"))}</td>\n","            </tr>\"\"\"\n","    elif table_type == 'squeeze':\n","        for row in table_data:\n","            price_value = row.get(\"Price\", \"\")\n","            formatted_price = f\"${price_value}\" if price_value != \"\" else \"\"\n","            html += f\"\"\"\n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">{row.get(\"TICKER\", \"\")}</td>\n","                <td style=\"padding:2px 4px;\">{row.get(\"Security Description\", \"\")}</td>\n","                <td style=\"padding:2px 4px;\">{row.get(\"Industry\", \"\")}</td>\n","                <td style=\"padding:2px 4px;\">{formatted_price}</td>\n","                <td style=\"padding:2px 4px;\">{row.get(\"Short Squeeze Score (SSS)\", \"\")}</td>\n","                <td style=\"padding:2px 4px;\">{format_change(row.get(\"SSS WoW\"), unit=\"\", decimal_places=0)}</td>\n","            </tr>\"\"\"\n","\n","    return html\n","\n","\n","# --- 3. HTML Generation ---\n","\n","def create_digest_html(content):\n","    \"\"\"\n","    Generates the final HTML for the digest by populating a template.\n","    \"\"\"\n","    if not content:\n","        return \"<h1>Error: Could not generate content.</h1>\"\n","\n","    ht_borrow_table = generate_table_html(content.get('ht_borrow_table', []), 'ht_borrow')\n","    squeeze_table = generate_table_html(content.get('squeeze_table', []), 'squeeze')\n","\n","    def format_market_note_change(value):\n","        color = '#16a34a' if value >= 0 else '#dc2626'\n","        sign = '+' if value >= 0 else ''\n","        return f'<span style=\"color:{color}; font-size:14px;\">{sign}{value:.2f}%</span>'\n","\n","    market_notes = content.get('market_notes', {})\n","    avg_fee_bps = market_notes.get('avg_fee_bps', 'N/A')\n","    # Ensure avg_fee_change is a number before formatting\n","    avg_fee_change_value = market_notes.get('avg_fee_change', 0)\n","    avg_fee_change = format_market_note_change(avg_fee_change_value) if isinstance(avg_fee_change_value, (int, float)) else 'N/A'\n","\n","    avg_util_percent = market_notes.get('avg_util_percent', 'N/A')\n","    # Ensure avg_util_change is a number before formatting\n","    avg_util_change_value = market_notes.get('avg_util_change', 0)\n","    avg_util_change = format_market_note_change(avg_util_change_value) if isinstance(avg_util_change_value, (int, float)) else 'N/A'\n","\n","    on_loan_value = market_notes.get('on_loan_value', 'N/A')\n","    # Ensure on_loan_value_change is a number before formatting\n","    on_loan_value_change_value = market_notes.get('on_loan_value_change', 0)\n","    on_loan_value_change = format_market_note_change(on_loan_value_change_value) if isinstance(on_loan_value_change_value, (int, float)) else 'N/A'\n","\n","    lendable_value = market_notes.get('lendable_value', 'N/A')\n","    # Ensure lendable_value_change is a number before formatting\n","    lendable_value_change_value = market_notes.get('lendable_value_change', 0)\n","    lendable_value_change = format_market_note_change(lendable_value_change_value) if isinstance(lendable_value_change_value, (int, float)) else 'N/A'\n","\n","\n","    headlines_html = \"\"\n","    for headline in content.get('headlines', []):\n","        headlines_html += f\"\"\"\n","        <div style=\"margin-top:20px;\">\n","            <strong style=\"font-size:16px;\">{headline['title']}</strong>\n","            <p style=\"margin:5px 0 0; white-space: pre-wrap;\">{headline['description']}</p>\n","            <ul style=\"margin:10px 0 0; padding-left:20px; color:#334155; list-style-type: disc;\">\n","              <li><strong>What Our Data Shows:</strong> {headline['data_insight']}</li>\n","            </ul>\n","        </div>\n","        \"\"\"\n","\n","    takeaways_html = \"\".join([f\"<li>{item}</li>\" for item in content.get('key_takeaways', [])])\n","\n","    html_template = f\"\"\"\n","<!DOCTYPE html>\n","<html lang=\"en\">\n","<head>\n","  <meta charset=\"UTF-8\">\n","  <title>EquiLend D&A Daily Digest - {datetime.now().strftime('%B %d, %Y')}</title>\n","</head>\n","<body style=\"margin:0; padding:0; font-family: Arial, sans-serif; background-color:#f1f5f9;\">\n","  <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"#f1f5f9\">\n","    <tr>\n","      <td align=\"center\">\n","        <table width=\"800\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"#ffffff\" style=\"margin:20px 0; border-radius:4px; overflow:hidden;\">\n","          <!-- Header -->\n","          <tr>\n","            <td bgcolor=\"#0284c7\" style=\"padding:20px; text-align:center;\">\n","              <h1 style=\"margin:0; font-size:24px; color:#ffffff;\">EquiLend D&amp;A Daily Digest</h1>\n","              <p style=\"margin:5px 0 0; font-size:16px; color:#bae6fd;\">{datetime.now().strftime('%B %d, %Y')}</p>\n","            </td>\n","          </tr>\n","          <!-- Content -->\n","          <tr>\n","            <td style=\"padding:20px; color:#334155; font-size:14px; line-height:1.5;\">\n","\n","              <!-- Market Notes -->\n","              <h2 style=\"font-size:18px; margin-bottom:10px; color:#0284c7;\">&#x1F4BC; Market Notes</h2>\n","              <table width=\"100%\" cellpadding=\"5\" cellspacing=\"0\" border=\"0\" bgcolor=\"#f8fafc\" style=\"margin-bottom:20px;\">\n","                <tr>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Average Fee</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      {avg_fee_bps} bps {avg_fee_change}\n","                    </p>\n","                  </td>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Average Utilization</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      {avg_util_percent}% {avg_util_change}\n","                    </p>\n","                  </td>\n","                </tr>\n","                <tr>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">On Loan Value</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      ${on_loan_value} {on_loan_value_change}\n","                    </p>\n","                  </td>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Total Lendable Value</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      ${lendable_value} {lendable_value_change}\n","                    </p>\n","                  </td>\n","                </tr>\n","              </table>\n","\n","              <!-- Headlines -->\n","              <h2 style=\"font-size:18px; margin-bottom:10px; color:#0284c7;\">&#x1F4F0; Major Headlines and What Our Data Shows</h2>\n","              {headlines_html}\n","\n","              <!-- Tables Section -->\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F525; Hot & Getting Hotter</h2>\n","              <div style=\"font-size:14px; font-style:italic; color:#334155; margin-bottom:10px; padding-left:5px;\">Top 5 Stocks with fees > 50,000 bps & rising</div>\n","              <table cellpadding=\"0\" cellspacing=\"0\" border=\"1\" style=\"border-collapse:collapse; margin-bottom:20px; border-color:#dddddd; font-size:12px;\" width=\"100%\">\n","                <thead>\n","                  <tr bgcolor=\"#0284c7\" style=\"color:#ffffff; font-weight:bold; text-align:left;\">\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Ticker</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Company Name</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Industry</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Price</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Fee 1 WoW (bps)</th>\n","                  </tr>\n","                </thead>\n","                <tbody>\n","                  {ht_borrow_table}\n","                </tbody>\n","              </table>\n","\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F52C; Market Technicals & Squeeze Metrics</h2>\n","              <table cellpadding=\"0\" cellspacing=\"0\" border=\"1\" style=\"border-collapse:collapse; border-color:#dddddd; font-size:12px;\" width=\"100%\">\n","                <thead>\n","                  <tr bgcolor=\"#0284c7\" style=\"color:#ffffff; font-weight:bold; text-align:left;\">\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Ticker</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Company Name</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Industry</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Price</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Short Squeeze Score (SSS)</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">SSS WoW</th>\n","                  </tr>\n","                </thead>\n","                <tbody>\n","                  {squeeze_table}\n","                </tbody>\n","              </table>\n","\n","              <!-- Key Takeaways -->\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F4A1; Key Takeaways</h2>\n","              <ul style=\"padding-left:20px; color:#334155; font-size:14px; margin:0;\">\n","                {takeaways_html}\n","              </ul>\n","\n","            </td>\n","          </tr>\n","          <!-- Footer -->\n","          <tr>\n","            <td align=\"center\" style=\"padding:10px; font-size:12px; color:#64748b;\">\n","              Source: EquiLend Data &amp; Analytics\n","            </td>\n","          </tr>\n","        </table>\n","      </td>\n","    </tr>\n","  </table>\n","</body>\n","</html>\n","    \"\"\"\n","    return html_template\n","\n","# --- Main Execution ---\n","if __name__ == \"__main__\":\n","    print(\"Starting daily digest generation...\")\n","\n","    # 1. Parse content from the Word document\n","    print(f\"Reading content from '{CONTENT_DOC_PATH}'...\")\n","    parsed_content = parse_daily_content(CONTENT_DOC_PATH)\n","\n","    # 2. Generate the final HTML file\n","    print(\"Generating final HTML digest...\")\n","    final_html = create_digest_html(parsed_content)\n","\n","    # 3. Save the HTML to a file\n","    with open(OUTPUT_HTML_PATH, 'w', encoding='utf-8') as f:\n","        f.write(final_html)\n","\n","    print(f\"\\nSuccessfully generated digest: {OUTPUT_HTML_PATH}\")\n","\n","    from IPython.display import display, HTML\n","import os\n","\n","# Define the path to the generated HTML file\n","html_file_path = OUTPUT_HTML_PATH # Using the variable defined in the previous cell\n","\n","# Check if the file exists before attempting to read it\n","if os.path.exists(html_file_path):\n","    # Read the content of the HTML file\n","    with open(html_file_path, 'r', encoding='utf-8') as f:\n","        html_content = f.read()\n","\n","    # Display the HTML content\n","    display(HTML(html_content))\n","else:\n","    print(f\"Error: The HTML file '{html_file_path}' was not found.\")"],"outputs":[{"output_type":"stream","name":"stdout","text":["Starting daily digest generation...\n","Reading content from 'daily_content.docx'...\n","Parsed Paragraphs (for debugging):\n","Paragraph 0: ðŸ“ˆMarket Notes:\n","Paragraph 1: ðŸ“°Major Headlines & What Our Data Shows:\n","Paragraph 2: Oil Prices Decline Amid OPEC+ Production and Demand Concerns\n","Paragraph 3: Crude oil prices have fallen, with reports indicating that profits for major energy companies like Exxon Mobil and Chevron have dropped to their lowest levels in four years. This is occurring as OPEC+ ramps up production, and concerns about a slowing global economy may be signaling a demand reduction. This dynamic highlights the potential for a softening global economic environment impacting commodity markets.\n","Paragraph 4: What our data shows: With the Middle Eastern conflict generating oil supply concerns and the added effect of tariffs, the energy sector as a whole has been notably volatile throughout the past few months. Our data highlights this, with a 2-year high in on-loan quantity being reached at the start of July at 8.57 billion shares globally. In turn, as these geopolitical and tariff issues have reduced, we have since seen this loan volume begin to fall, with a reduction of 15% compared to the early July heights of 7.27 billion shares.\n","Paragraph 5: Chips and Semiconductors Underdogs Struggle to Keep Pace\n","Paragraph 6: With uncertainty surrounding access for semiconductor producers to key markets such as China, smaller players in the field are increasingly struggling to compete with market leaders like Nvidia. Tariffs on semiconductors will be announced within the next week or so, but in the meantime, companies including Super Micro and Advanced Micro Devices have lowered fiscal year sales forecasts and are falling in extended trading.\n","Paragraph 7: What our data shows: On the contrary, some firms are benefitting from opening gaps in the semiconductor market, with others struggling and tariffs to be imposed on overseas opposition. Wall Street analysts appear bullish regarding Rigetti Computing (RGTI) in particular, with strong buy recommendations. Consequently, we have seen a downfall in short interest in RGTI in our data, with borrowing costs hitting a two-year low at 44 bps, a significant fall from over 640 bps at the start of April.\n","Paragraph 8: European Equities Rise despite fresh tariff threats\n","Paragraph 9: The STOXX 600 index continues to rise as investors â€˜bought the dipâ€™ created by recent market weakness, despite the announcement from Trump that markets such as semiconductors and pharmaceuticals will have fresh tariffs announced in â€˜the next week or soâ€™.\n","Paragraph 10: What our data shows: In response to the worst of the tariff fallout between the E.U. and the U.S. in the past, our data shows an expected cooling in the European equity market. Short interest in this field has declined significantly as the volume of shares on loan has reduced to 190 billion, from the peak tariff values of around 250 billion. In parallel, following fluctuation throughout the tariff discussions, borrowing costs have returned to ~40 bps, the same fee seen as this time last year.\n","Paragraph 11: ðŸ”¥ Hot & Getting Hotter\n","Paragraph 12: Top stocks with fees > 50,000 & rising\n","Paragraph 13: ðŸ”¬Market Technicals & Squeeze Metrics\n","Paragraph 14: ðŸ’¡Key Takeaways\n","Paragraph 15: Key takeaways 1\n","Paragraph 16: Key takeaways 2\n","Paragraph 17: Key takeaways 3\n","Identified Table 2 as potential Market Notes table.\n","Market Notes Table Content (for debugging):\n","Cell 1 Lines: ['Average Fee:', '74.9 bps', '+93.8%', 'On Loan Value:', '$3.05T', '+1.02%']\n","Cell 2 Lines: ['Average Utilization:', '7.11%', '+0.11%', 'Total Lendable Value:', '$42.9T ', '+0.90%']\n","Identified Table 3 as 'Hot & Getting Hotter'.\n","Parsed 5 rows for 'Hot & Getting Hotter'.\n","Identified Table 4 as 'Squeeze Metrics'.\n","Parsed 5 rows for 'Squeeze Metrics'.\n","Generating final HTML digest...\n","\n","Successfully generated digest: equilend_daily_digest_2025_08_07.html\n"]},{"output_type":"display_data","data":{"text/plain":["<IPython.core.display.HTML object>"],"text/html":["\n","<!DOCTYPE html>\n","<html lang=\"en\">\n","<head>\n","  <meta charset=\"UTF-8\">\n","  <title>EquiLend D&A Daily Digest - August 07, 2025</title>\n","</head>\n","<body style=\"margin:0; padding:0; font-family: Arial, sans-serif; background-color:#f1f5f9;\">\n","  <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"#f1f5f9\">\n","    <tr>\n","      <td align=\"center\">\n","        <table width=\"800\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"#ffffff\" style=\"margin:20px 0; border-radius:4px; overflow:hidden;\">\n","          <!-- Header -->\n","          <tr>\n","            <td bgcolor=\"#0284c7\" style=\"padding:20px; text-align:center;\">\n","              <h1 style=\"margin:0; font-size:24px; color:#ffffff;\">EquiLend D&amp;A Daily Digest</h1>\n","              <p style=\"margin:5px 0 0; font-size:16px; color:#bae6fd;\">August 07, 2025</p>\n","            </td>\n","          </tr>\n","          <!-- Content -->\n","          <tr>\n","            <td style=\"padding:20px; color:#334155; font-size:14px; line-height:1.5;\">\n","\n","              <!-- Market Notes -->\n","              <h2 style=\"font-size:18px; margin-bottom:10px; color:#0284c7;\">&#x1F4BC; Market Notes</h2>\n","              <table width=\"100%\" cellpadding=\"5\" cellspacing=\"0\" border=\"0\" bgcolor=\"#f8fafc\" style=\"margin-bottom:20px;\">\n","                <tr>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Average Fee</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      74.9 bps <span style=\"color:#16a34a; font-size:14px;\">+93.80%</span>\n","                    </p>\n","                  </td>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Average Utilization</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      7.11% <span style=\"color:#16a34a; font-size:14px;\">+0.11%</span>\n","                    </p>\n","                  </td>\n","                </tr>\n","                <tr>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">On Loan Value</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      $3.05T <span style=\"color:#16a34a; font-size:14px;\">+1.02%</span>\n","                    </p>\n","                  </td>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Total Lendable Value</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      $42.9T <span style=\"color:#16a34a; font-size:14px;\">+0.90%</span>\n","                    </p>\n","                  </td>\n","                </tr>\n","              </table>\n","\n","              <!-- Headlines -->\n","              <h2 style=\"font-size:18px; margin-bottom:10px; color:#0284c7;\">&#x1F4F0; Major Headlines and What Our Data Shows</h2>\n","              \n","        <div style=\"margin-top:20px;\">\n","            <strong style=\"font-size:16px;\">Oil Prices Decline Amid OPEC+ Production and Demand Concerns</strong>\n","            <p style=\"margin:5px 0 0; white-space: pre-wrap;\">Crude oil prices have fallen, with reports indicating that profits for major energy companies like Exxon Mobil and Chevron have dropped to their lowest levels in four years. This is occurring as OPEC+ ramps up production, and concerns about a slowing global economy may be signaling a demand reduction. This dynamic highlights the potential for a softening global economic environment impacting commodity markets.</p>\n","            <ul style=\"margin:10px 0 0; padding-left:20px; color:#334155; list-style-type: disc;\">\n","              <li><strong>What Our Data Shows:</strong> With the Middle Eastern conflict generating oil supply concerns and the added effect of tariffs, the energy sector as a whole has been notably volatile throughout the past few months. Our data highlights this, with a 2-year high in on-loan quantity being reached at the start of July at 8.57 billion shares globally. In turn, as these geopolitical and tariff issues have reduced, we have since seen this loan volume begin to fall, with a reduction of 15% compared to the early July heights of 7.27 billion shares.</li>\n","            </ul>\n","        </div>\n","        \n","        <div style=\"margin-top:20px;\">\n","            <strong style=\"font-size:16px;\">Chips and Semiconductors Underdogs Struggle to Keep Pace</strong>\n","            <p style=\"margin:5px 0 0; white-space: pre-wrap;\">With uncertainty surrounding access for semiconductor producers to key markets such as China, smaller players in the field are increasingly struggling to compete with market leaders like Nvidia. Tariffs on semiconductors will be announced within the next week or so, but in the meantime, companies including Super Micro and Advanced Micro Devices have lowered fiscal year sales forecasts and are falling in extended trading.</p>\n","            <ul style=\"margin:10px 0 0; padding-left:20px; color:#334155; list-style-type: disc;\">\n","              <li><strong>What Our Data Shows:</strong> On the contrary, some firms are benefitting from opening gaps in the semiconductor market, with others struggling and tariffs to be imposed on overseas opposition. Wall Street analysts appear bullish regarding Rigetti Computing (RGTI) in particular, with strong buy recommendations. Consequently, we have seen a downfall in short interest in RGTI in our data, with borrowing costs hitting a two-year low at 44 bps, a significant fall from over 640 bps at the start of April.</li>\n","            </ul>\n","        </div>\n","        \n","        <div style=\"margin-top:20px;\">\n","            <strong style=\"font-size:16px;\">European Equities Rise despite fresh tariff threats</strong>\n","            <p style=\"margin:5px 0 0; white-space: pre-wrap;\">The STOXX 600 index continues to rise as investors â€˜bought the dipâ€™ created by recent market weakness, despite the announcement from Trump that markets such as semiconductors and pharmaceuticals will have fresh tariffs announced in â€˜the next week or soâ€™.</p>\n","            <ul style=\"margin:10px 0 0; padding-left:20px; color:#334155; list-style-type: disc;\">\n","              <li><strong>What Our Data Shows:</strong> In response to the worst of the tariff fallout between the E.U. and the U.S. in the past, our data shows an expected cooling in the European equity market. Short interest in this field has declined significantly as the volume of shares on loan has reduced to 190 billion, from the peak tariff values of around 250 billion. In parallel, following fluctuation throughout the tariff discussions, borrowing costs have returned to ~40 bps, the same fee seen as this time last year.</li>\n","            </ul>\n","        </div>\n","        \n","\n","              <!-- Tables Section -->\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F525; Hot & Getting Hotter</h2>\n","              <div style=\"font-size:14px; font-style:italic; color:#334155; margin-bottom:10px; padding-left:5px;\">Top 5 Stocks with fees > 50,000 bps & rising</div>\n","              <table cellpadding=\"0\" cellspacing=\"0\" border=\"1\" style=\"border-collapse:collapse; margin-bottom:20px; border-color:#dddddd; font-size:12px;\" width=\"100%\">\n","                <thead>\n","                  <tr bgcolor=\"#0284c7\" style=\"color:#ffffff; font-weight:bold; text-align:left;\">\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Ticker</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Company Name</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Industry</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Price</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Fee 1 WoW (bps)</th>\n","                  </tr>\n","                </thead>\n","                <tbody>\n","                  \n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">ABVE</td>\n","                <td style=\"padding:2px 4px;\">ABOVE FOOD IN</td>\n","                <td style=\"padding:2px 4px;\">Food, Bev, Tobacco</td>\n","                <td style=\"padding:2px 4px;\">$$1.72</td>\n","                <td style=\"padding:2px 4px;\"><span style=\"color:#16a34a; font-size:14px;\">+15,567 BPS</span></td>\n","            </tr>\n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">WBUY</td>\n","                <td style=\"padding:2px 4px;\">WEBUY GLOBAL</td>\n","                <td style=\"padding:2px 4px;\">Food & Staples</td>\n","                <td style=\"padding:2px 4px;\">$$3.50</td>\n","                <td style=\"padding:2px 4px;\"><span style=\"color:#16a34a; font-size:14px;\">+5,447 BPS</span></td>\n","            </tr>\n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">PAPL</td>\n","                <td style=\"padding:2px 4px;\">PINEAPPLE FINâ€™L</td>\n","                <td style=\"padding:2px 4px;\">Diversified Fin</td>\n","                <td style=\"padding:2px 4px;\">$$4.31</td>\n","                <td style=\"padding:2px 4px;\"><span style=\"color:#16a34a; font-size:14px;\">+12,527 BPS</span></td>\n","            </tr>\n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">BMGL</td>\n","                <td style=\"padding:2px 4px;\">BASEL MEDICAL</td>\n","                <td style=\"padding:2px 4px;\">Providers & Srvc</td>\n","                <td style=\"padding:2px 4px;\">$$2.02</td>\n","                <td style=\"padding:2px 4px;\"><span style=\"color:#16a34a; font-size:14px;\">+4,660 BPS</span></td>\n","            </tr>\n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">BGL</td>\n","                <td style=\"padding:2px 4px;\">BLUE GOLD</td>\n","                <td style=\"padding:2px 4px;\">Metals &Mining</td>\n","                <td style=\"padding:2px 4px;\">$$12.35</td>\n","                <td style=\"padding:2px 4px;\"><span style=\"color:#16a34a; font-size:14px;\">+2,895 BPS</span></td>\n","            </tr>\n","                </tbody>\n","              </table>\n","\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F52C; Market Technicals & Squeeze Metrics</h2>\n","              <table cellpadding=\"0\" cellspacing=\"0\" border=\"1\" style=\"border-collapse:collapse; border-color:#dddddd; font-size:12px;\" width=\"100%\">\n","                <thead>\n","                  <tr bgcolor=\"#0284c7\" style=\"color:#ffffff; font-weight:bold; text-align:left;\">\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Ticker</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Company Name</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Industry</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Price</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Short Squeeze Score (SSS)</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">SSS WoW</th>\n","                  </tr>\n","                </thead>\n","                <tbody>\n","                  \n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">ABVE</td>\n","                <td style=\"padding:2px 4px;\">ABOVE FOOD</td>\n","                <td style=\"padding:2px 4px;\">Food, Bev, Tobacco</td>\n","                <td style=\"padding:2px 4px;\">$$1.72</td>\n","                <td style=\"padding:2px 4px;\">100</td>\n","                <td style=\"padding:2px 4px;\"><span style=\"color:#16a34a; font-size:14px;\">+1</span></td>\n","            </tr>\n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">WBUY</td>\n","                <td style=\"padding:2px 4px;\">WEBUY GLOBAL</td>\n","                <td style=\"padding:2px 4px;\">Food & Staples</td>\n","                <td style=\"padding:2px 4px;\">$$3.50</td>\n","                <td style=\"padding:2px 4px;\">99</td>\n","                <td style=\"padding:2px 4px;\"><span style=\"color:#16a34a; font-size:14px;\">+2</span></td>\n","            </tr>\n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">PAPL</td>\n","                <td style=\"padding:2px 4px;\">PINEAPPLE FINâ€™L</td>\n","                <td style=\"padding:2px 4px;\">Diversified Finâ€™l</td>\n","                <td style=\"padding:2px 4px;\">$$4.31</td>\n","                <td style=\"padding:2px 4px;\">98</td>\n","                <td style=\"padding:2px 4px;\"><span style=\"color:#16a34a; font-size:14px;\">+3</span></td>\n","            </tr>\n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">BMGL</td>\n","                <td style=\"padding:2px 4px;\">BASEL MEDICAL</td>\n","                <td style=\"padding:2px 4px;\">Providers & Services</td>\n","                <td style=\"padding:2px 4px;\">$$2.02</td>\n","                <td style=\"padding:2px 4px;\">96</td>\n","                <td style=\"padding:2px 4px;\"><span style=\"color:#16a34a; font-size:14px;\">+4</span></td>\n","            </tr>\n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">BGL</td>\n","                <td style=\"padding:2px 4px;\">BLUE GOLD</td>\n","                <td style=\"padding:2px 4px;\">Metals & Mining</td>\n","                <td style=\"padding:2px 4px;\">$$12.35</td>\n","                <td style=\"padding:2px 4px;\">96</td>\n","                <td style=\"padding:2px 4px;\"><span style=\"color:#16a34a; font-size:14px;\">+5</span></td>\n","            </tr>\n","                </tbody>\n","              </table>\n","\n","              <!-- Key Takeaways -->\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F4A1; Key Takeaways</h2>\n","              <ul style=\"padding-left:20px; color:#334155; font-size:14px; margin:0;\">\n","                <li>Key takeaways 1</li><li>Key takeaways 2</li><li>Key takeaways 3</li>\n","              </ul>\n","\n","            </td>\n","          </tr>\n","          <!-- Footer -->\n","          <tr>\n","            <td align=\"center\" style=\"padding:10px; font-size:12px; color:#64748b;\">\n","              Source: EquiLend Data &amp; Analytics\n","            </td>\n","          </tr>\n","        </table>\n","      </td>\n","    </tr>\n","  </table>\n","</body>\n","</html>\n","    "]},"metadata":{}}],"execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":1000},"id":"wSnKPQ-ySmOQ","executionInfo":{"status":"ok","timestamp":1754541175142,"user_tz":240,"elapsed":867,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"775bbaee-caef-40f8-e28c-e9647ab0f2ef"}},{"cell_type":"markdown","metadata":{"id":"0b97dcae"},"source":["# Task\n","Explain the selected code, then add a cell to the end that would automatically generate the HTML in a Gmail email."]},{"cell_type":"markdown","metadata":{"id":"7135a8bd"},"source":["## Update configuration\n","\n","### Subtask:\n","Add variables for the sender's Gmail address, recipient(s) email address(es), and potentially a password or App Password for authentication.\n"]},{"cell_type":"markdown","metadata":{"id":"b92bfe6e"},"source":["**Reasoning**:\n","The subtask is to add variables for sender email, recipient emails, and password for Gmail authentication. This can be done by adding a new code cell and defining the required variables.\n","\n"]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"12275c53","executionInfo":{"status":"ok","timestamp":1754673313197,"user_tz":240,"elapsed":7,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"009e3779-c102-4f8d-e611-243b8c00e7f1"},"source":["# --- Gmail Configuration ---\n","SENDER_EMAIL = 'bobsheehan23@gmail.com'  # Replace with your Gmail address\n","RECIPIENT_EMAILS = 'bob.sheehan@equilend.com,rsheehan@equilend.com' # Replace with recipient email addresses\n","GMAIL_PASSWORD = '.2389nice' # Replace with your Gmail password or App Password\n","\n","print(\"Gmail configuration variables defined.\")"],"execution_count":11,"outputs":[{"output_type":"stream","name":"stdout","text":["Gmail configuration variables defined.\n"]}]},{"cell_type":"markdown","metadata":{"id":"d56b979c"},"source":["## Implement email sending function\n","\n","### Subtask:\n","Create a new function that takes the sender's email, recipient(s) email(s), subject, and HTML body as input.\n"]},{"cell_type":"markdown","metadata":{"id":"a2b1d05b"},"source":["**Reasoning**:\n","Define the `send_gmail_email` function with the specified parameters and add placeholder print statements.\n","\n"]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"2373c273","executionInfo":{"status":"ok","timestamp":1754673316061,"user_tz":240,"elapsed":45,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"28d68024-c978-4a83-cec3-c5bf8fbb42a0"},"source":["import smtplib\n","from email.mime.text import MIMEText\n","\n","def send_gmail_email(sender_email, recipient_emails, subject, html_body):\n","    \"\"\"\n","    Placeholder function to send an email via Gmail.\n","\n","    Args:\n","        sender_email: The email address of the sender.\n","        recipient_emails: A string of comma-separated recipient email addresses.\n","        subject: The subject of the email.\n","        html_body: The HTML content of the email body.\n","    \"\"\"\n","    print(f\"Attempting to send email from: {sender_email}\")\n","    print(f\"To recipients: {recipient_emails}\")\n","    print(f\"With subject: {subject}\")\n","    print(\"Email body (first 100 characters):\")\n","    print(html_body[:100] + '...')\n","    print(\"\\nPlaceholder function called. Actual email sending logic will be added later.\")\n","\n","print(\"send_gmail_email function defined.\")"],"execution_count":12,"outputs":[{"output_type":"stream","name":"stdout","text":["send_gmail_email function defined.\n"]}]},{"cell_type":"markdown","metadata":{"id":"1a06781f"},"source":["## Configure smtp connection\n","\n","### Subtask:\n","Inside the email sending function, establish a secure connection to Gmail's SMTP server (`smtp.gmail.com`) using `smtplib`.\n"]},{"cell_type":"markdown","metadata":{"id":"5f235dc6"},"source":["**Reasoning**:\n","Modify the `send_gmail_email` function to establish a secure connection to Gmail's SMTP server using `smtplib.SMTP_SSL`.\n","\n"]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"f389ee00","executionInfo":{"status":"ok","timestamp":1754673322321,"user_tz":240,"elapsed":18,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"6c656344-ab46-409e-db60-bee8974afb58"},"source":["import smtplib\n","from email.mime.text import MIMEText\n","\n","def send_gmail_email(sender_email, recipient_emails, subject, html_body):\n","    \"\"\"\n","    Placeholder function to send an email via Gmail.\n","\n","    Args:\n","        sender_email: The email address of the sender.\n","        recipient_emails: A string of comma-separated recipient email addresses.\n","        subject: The subject of the email.\n","        html_body: The HTML content of the email body.\n","    \"\"\"\n","    print(f\"Attempting to send email from: {sender_email}\")\n","    print(f\"To recipients: {recipient_emails}\")\n","    print(f\"With subject: {subject}\")\n","    print(\"Email body (first 100 characters):\")\n","    print(html_body[:100] + '...')\n","\n","    try:\n","        # Establish a secure connection to Gmail's SMTP server\n","        server = smtplib.SMTP_SSL('smtp.gmail.com', 465)\n","        print(\"Successfully connected to Gmail SMTP server.\")\n","        # The rest of the email sending logic will be added here later\n","        server.quit()\n","        print(\"SMTP server connection closed.\")\n","    except Exception as e:\n","        print(f\"Error connecting to Gmail SMTP server: {e}\")\n","        print(\"Please ensure you have a stable internet connection and Gmail SMTP is accessible.\")\n","\n","print(\"send_gmail_email function updated with SMTP connection logic.\")"],"execution_count":13,"outputs":[{"output_type":"stream","name":"stdout","text":["send_gmail_email function updated with SMTP connection logic.\n"]}]},{"cell_type":"markdown","metadata":{"id":"ab7eaecf"},"source":["## Login to gmail account\n","\n","### Subtask:\n","Log in to the sender's Gmail account using the provided credentials.\n"]},{"cell_type":"markdown","metadata":{"id":"9314c6fd"},"source":["**Reasoning**:\n","Implement the login logic within the `send_gmail_email` function using a try-except block as instructed.\n","\n"]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"89a40766","executionInfo":{"status":"ok","timestamp":1754673328937,"user_tz":240,"elapsed":7,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"b9cef67c-1580-44df-b84f-62ff5f54a38e"},"source":["import smtplib\n","from email.mime.text import MIMEText\n","\n","def send_gmail_email(sender_email, recipient_emails, subject, html_body):\n","    \"\"\"\n","    Sends an email via Gmail using the provided details.\n","\n","    Args:\n","        sender_email: The email address of the sender.\n","        recipient_emails: A string of comma-separated recipient email addresses.\n","        subject: The subject of the email.\n","        html_body: The HTML content of the email body.\n","    \"\"\"\n","    print(f\"Attempting to send email from: {sender_email}\")\n","    print(f\"To recipients: {recipient_emails}\")\n","    print(f\"With subject: {subject}\")\n","    print(\"Email body (first 100 characters):\")\n","    print(html_body[:100] + '...')\n","\n","    try:\n","        # Establish a secure connection to Gmail's SMTP server\n","        server = smtplib.SMTP_SSL('smtp.gmail.com', 465)\n","        print(\"Successfully connected to Gmail SMTP server.\")\n","\n","        try:\n","            # Log in to the Gmail account\n","            server.login(sender_email, GMAIL_PASSWORD)\n","            print(\"Successfully logged in to Gmail account.\")\n","        except smtplib.AuthenticationError:\n","            print(\"Error: Authentication failed. Please check your email address and password/App Password.\")\n","            server.quit()\n","            return\n","        except Exception as e:\n","            print(f\"Error during login: {e}\")\n","            server.quit()\n","            return\n","\n","        # The rest of the email sending logic will be added here later\n","\n","        server.quit()\n","        print(\"SMTP server connection closed.\")\n","    except Exception as e:\n","        print(f\"Error connecting to Gmail SMTP server: {e}\")\n","        print(\"Please ensure you have a stable internet connection and Gmail SMTP is accessible.\")\n","\n","print(\"send_gmail_email function updated with login logic.\")"],"execution_count":15,"outputs":[{"output_type":"stream","name":"stdout","text":["send_gmail_email function updated with login logic.\n"]}]},{"cell_type":"markdown","metadata":{"id":"22f56409"},"source":["## Create email message\n","\n","### Subtask:\n","Construct the email message using the `email.mime.text` module, setting the subject, sender, recipient(s), and the HTML body.\n"]},{"cell_type":"markdown","metadata":{"id":"042a496a"},"source":["**Reasoning**:\n","Construct the email message using MIMEText, setting the subject, sender, and recipient headers as instructed.\n","\n"]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"77f14f4a","executionInfo":{"status":"ok","timestamp":1754673335235,"user_tz":240,"elapsed":7,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"f46b9b72-d8f9-45b2-a0b4-769e75e5dfa0"},"source":["import smtplib\n","from email.mime.text import MIMEText\n","\n","def send_gmail_email(sender_email, recipient_emails, subject, html_body):\n","    \"\"\"\n","    Sends an email via Gmail using the provided details.\n","\n","    Args:\n","        sender_email: The email address of the sender.\n","        recipient_emails: A string of comma-separated recipient email addresses.\n","        subject: The subject of the email.\n","        html_body: The HTML content of the email body.\n","    \"\"\"\n","    print(f\"Attempting to send email from: {sender_email}\")\n","    print(f\"To recipients: {recipient_emails}\")\n","    print(f\"With subject: {subject}\")\n","    print(\"Email body (first 100 characters):\")\n","    print(html_body[:100] + '...')\n","\n","    try:\n","        # Establish a secure connection to Gmail's SMTP server\n","        server = smtplib.SMTP_SSL('smtp.gmail.com', 465)\n","        print(\"Successfully connected to Gmail SMTP server.\")\n","\n","        try:\n","            # Log in to the Gmail account\n","            server.login(sender_email, GMAIL_PASSWORD)\n","            print(\"Successfully logged in to Gmail account.\")\n","        except smtplib.AuthenticationError:\n","            print(\"Error: Authentication failed. Please check your email address and password/App Password.\")\n","            server.quit()\n","            return\n","        except Exception as e:\n","            print(f\"Error during login: {e}\")\n","            server.quit()\n","            return\n","\n","        # Create the email message\n","        msg = MIMEText(html_body, 'html')\n","        msg['Subject'] = subject\n","        msg['From'] = sender_email\n","        msg['To'] = recipient_emails\n","\n","        # The rest of the email sending logic will be added here later\n","\n","        server.quit()\n","        print(\"SMTP server connection closed.\")\n","    except Exception as e:\n","        print(f\"Error connecting to Gmail SMTP server: {e}\")\n","        print(\"Please ensure you have a stable internet connection and Gmail SMTP is accessible.\")\n","\n","print(\"send_gmail_email function updated with MIMEText message construction.\")"],"execution_count":16,"outputs":[{"output_type":"stream","name":"stdout","text":["send_gmail_email function updated with MIMEText message construction.\n"]}]},{"cell_type":"markdown","metadata":{"id":"c19aba36"},"source":["**Reasoning**:\n","Send the constructed email message using the SMTP server and handle potential exceptions during sending.\n","\n"]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"0f0ff41c","executionInfo":{"status":"ok","timestamp":1754673310648,"user_tz":240,"elapsed":43,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"ec3971b0-3fab-438e-904a-967dbe2cdccc"},"source":["import smtplib\n","from email.mime.text import MIMEText\n","\n","def send_gmail_email(sender_email, recipient_emails, subject, html_body):\n","    \"\"\"\n","    Sends an email via Gmail using the provided details.\n","\n","    Args:\n","        sender_email: The email address of the sender.\n","        recipient_emails: A string of comma-separated recipient email addresses.\n","        subject: The subject of the email.\n","        html_body: The HTML content of the email body.\n","    \"\"\"\n","    print(f\"Attempting to send email from: {sender_email}\")\n","    print(f\"To recipients: {recipient_emails}\")\n","    print(f\"With subject: {subject}\")\n","    print(\"Email body (first 100 characters):\")\n","    print(html_body[:100] + '...')\n","\n","    try:\n","        # Establish a secure connection to Gmail's SMTP server\n","        server = smtplib.SMTP_SSL('smtp.gmail.com', 465)\n","        print(\"Successfully connected to Gmail SMTP server.\")\n","\n","        try:\n","            # Log in to the Gmail account\n","            server.login(sender_email, GMAIL_PASSWORD)\n","            print(\"Successfully logged in to Gmail account.\")\n","        except smtplib.AuthenticationError:\n","            print(\"Error: Authentication failed. Please check your email address and password/App Password.\")\n","            server.quit()\n","            return\n","        except Exception as e:\n","            print(f\"Error during login: {e}\")\n","            server.quit()\n","            return\n","\n","        # Create the email message\n","        msg = MIMEText(html_body, 'html')\n","        msg['Subject'] = subject\n","        msg['From'] = sender_email\n","        msg['To'] = recipient_emails\n","\n","        try:\n","            # Send the email\n","            server.sendmail(sender_email, recipient_emails.split(','), msg.as_string())\n","            print(\"Email sent successfully!\")\n","        except smtplib.SMTPRecipientsRefused:\n","            print(f\"Error: All recipients refused. Please check recipient email addresses: {recipient_emails}\")\n","        except smtplib.SMTPSenderRefused:\n","            print(f\"Error: Sender address refused. Please check sender email address: {sender_email}\")\n","        except smtplib.SMTPDataError as e:\n","             print(f\"SMTP Data Error: {e}\")\n","        except Exception as e:\n","            print(f\"Error sending email: {e}\")\n","        finally:\n","             server.quit()\n","             print(\"SMTP server connection closed.\")\n","\n","    except Exception as e:\n","        print(f\"Error connecting to Gmail SMTP server: {e}\")\n","        print(\"Please ensure you have a stable internet connection and Gmail SMTP is accessible.\")\n","\n","print(\"send_gmail_email function updated to send the email.\")"],"execution_count":9,"outputs":[{"output_type":"stream","name":"stdout","text":["send_gmail_email function updated to send the email.\n"]}]},{"cell_type":"markdown","metadata":{"id":"6e0bc952"},"source":["## Close smtp connection\n","\n","### Subtask:\n","Close the connection to the SMTP server.\n"]},{"cell_type":"markdown","metadata":{"id":"923a54ba"},"source":["**Reasoning**:\n","Ensure the SMTP server connection is closed properly by placing the `server.quit()` call in a `finally` block within the main `try...except` block that handles the SMTP connection.\n","\n"]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"b9a03269","executionInfo":{"status":"ok","timestamp":1754673339600,"user_tz":240,"elapsed":15,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"e4ab518d-dc9c-463e-d488-8fa9d6c4943a"},"source":["import smtplib\n","from email.mime.text import MIMEText\n","\n","def send_gmail_email(sender_email, recipient_emails, subject, html_body):\n","    \"\"\"\n","    Sends an email via Gmail using the provided details.\n","\n","    Args:\n","        sender_email: The email address of the sender.\n","        recipient_emails: A string of comma-separated recipient email addresses.\n","        subject: The subject of the email.\n","        html_body: The HTML content of the email body.\n","    \"\"\"\n","    print(f\"Attempting to send email from: {sender_email}\")\n","    print(f\"To recipients: {recipient_emails}\")\n","    print(f\"With subject: {subject}\")\n","    print(\"Email body (first 100 characters):\")\n","    print(html_body[:100] + '...')\n","\n","    server = None # Initialize server to None\n","    try:\n","        # Establish a secure connection to Gmail's SMTP server\n","        server = smtplib.SMTP_SSL('smtp.gmail.com', 465)\n","        print(\"Successfully connected to Gmail SMTP server.\")\n","\n","        try:\n","            # Log in to the Gmail account\n","            server.login(sender_email, GMAIL_PASSWORD)\n","            print(\"Successfully logged in to Gmail account.\")\n","        except smtplib.AuthenticationError:\n","            print(\"Error: Authentication failed. Please check your email address and password/App Password.\")\n","            return\n","        except Exception as e:\n","            print(f\"Error during login: {e}\")\n","            return\n","\n","        # Create the email message\n","        msg = MIMEText(html_body, 'html')\n","        msg['Subject'] = subject\n","        msg['From'] = sender_email\n","        msg['To'] = recipient_emails\n","\n","        try:\n","            # Send the email\n","            server.sendmail(sender_email, recipient_emails.split(','), msg.as_string())\n","            print(\"Email sent successfully!\")\n","        except smtplib.SMTPRecipientsRefused:\n","            print(f\"Error: All recipients refused. Please check recipient email addresses: {recipient_emails}\")\n","        except smtplib.SMTPSenderRefused:\n","            print(f\"Error: Sender address refused. Please check sender email address: {sender_email}\")\n","        except smtplib.SMTPDataError as e:\n","             print(f\"SMTP Data Error: {e}\")\n","        except Exception as e:\n","            print(f\"Error sending email: {e}\")\n","\n","    except Exception as e:\n","        print(f\"Error connecting to Gmail SMTP server: {e}\")\n","        print(\"Please ensure you have a stable internet connection and Gmail SMTP is accessible.\")\n","    finally:\n","        if server:\n","            server.quit()\n","            print(\"SMTP server connection closed.\")\n","\n","\n","print(\"send_gmail_email function updated to ensure connection closure.\")\n"],"execution_count":18,"outputs":[{"output_type":"stream","name":"stdout","text":["send_gmail_email function updated to ensure connection closure.\n"]}]},{"cell_type":"markdown","metadata":{"id":"698a9ea4"},"source":["## Integrate into main execution\n","\n","### Subtask:\n","Call the new email sending function in the main execution block after generating the HTML content.\n"]},{"cell_type":"markdown","metadata":{"id":"855b9a32"},"source":["**Reasoning**:\n","The subtask is to call the `send_gmail_email` function in the main execution block after the HTML content is generated and saved. This requires modifying the `if __name__ == \"__main__\":` block to include this function call with the appropriate arguments.\n","\n"]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":228},"id":"0bf45ba8","executionInfo":{"status":"error","timestamp":1754673344799,"user_tz":240,"elapsed":48,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"f2515429-6a19-4118-a36b-ff48b0856127"},"source":["# --- Main Execution ---\n","if __name__ == \"__main__\":\n","    print(\"Starting daily digest generation...\")\n","\n","    # 1. Parse content from the Word document\n","    print(f\"Reading content from '{CONTENT_DOC_PATH}'...\")\n","    parsed_content = parse_daily_content(CONTENT_DOC_PATH)\n","\n","    # 2. Generate the final HTML file\n","    print(\"Generating final HTML digest...\")\n","    final_html = create_digest_html(parsed_content)\n","\n","    # 3. Save the HTML to a file\n","    with open(OUTPUT_HTML_PATH, 'w', encoding='utf-8') as f:\n","        f.write(final_html)\n","\n","    print(f\"\\nSuccessfully generated digest: {OUTPUT_HTML_PATH}\")\n","\n","    # 4. Send the HTML as an email\n","    email_subject = f\"EquiLend D&A Daily Digest - {datetime.now().strftime('%B %d, %Y')}\"\n","    print(f\"Attempting to send email with subject: {email_subject}\")\n","    send_gmail_email(SENDER_EMAIL, RECIPIENT_EMAILS, email_subject, final_html)\n","\n","    # Display the HTML content in the notebook (optional)\n","    from IPython.display import display, HTML\n","    import os\n","\n","    # Define the path to the generated HTML file\n","    html_file_path = OUTPUT_HTML_PATH # Using the variable defined in the previous cell\n","\n","    # Check if the file exists before attempting to read it\n","    if os.path.exists(html_file_path):\n","        # Read the content of the HTML file\n","        with open(html_file_path, 'r', encoding='utf-8') as f:\n","            html_content = f.read()\n","\n","        # Display the HTML content\n","        display(HTML(html_content))\n","    else:\n","        print(f\"Error: The HTML file '{html_file_path}' was not found.\")\n"],"execution_count":19,"outputs":[{"output_type":"stream","name":"stdout","text":["Starting daily digest generation...\n"]},{"output_type":"error","ename":"NameError","evalue":"name 'CONTENT_DOC_PATH' is not defined","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mNameError\u001b[0m                                 Traceback (most recent call last)","\u001b[0;32m/tmp/ipython-input-3282025458.py\u001b[0m in \u001b[0;36m<cell line: 0>\u001b[0;34m()\u001b[0m\n\u001b[1;32m      4\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      5\u001b[0m     \u001b[0;31m# 1. Parse content from the Word document\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m----> 6\u001b[0;31m     \u001b[0mprint\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34mf\"Reading content from '{CONTENT_DOC_PATH}'...\"\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m      7\u001b[0m     \u001b[0mparsed_content\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mparse_daily_content\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mCONTENT_DOC_PATH\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      8\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;31mNameError\u001b[0m: name 'CONTENT_DOC_PATH' is not defined"]}]},{"cell_type":"markdown","metadata":{"id":"773f137a"},"source":["**Reasoning**:\n","The previous code block failed because `CONTENT_DOC_PATH`, `OUTPUT_HTML_PATH`, `SENDER_EMAIL`, `RECIPIENT_EMAILS`, and `GMAIL_PASSWORD` were not defined in the current execution context. These variables were defined in an earlier cell that was not executed in the current runtime. I need to include the configuration variables and the function definitions from the previous cells in this code block to make it executable.\n","\n"]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":352},"id":"wmWhLOlwrr8Y","executionInfo":{"status":"ok","timestamp":1754673397943,"user_tz":240,"elapsed":344,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"add96784-e767-4f15-b4b3-df1d1f46a5ba"},"source":["import pandas as pd\n","import docx\n","from datetime import datetime\n","import re\n","import numpy as np\n","import smtplib\n","from email.mime.text import MIMEText\n","import os\n","from IPython.display import display, HTML\n","\n","\n","# --- Configuration ---\n","# The script will read all content from this file.\n","# Ensure it is in the same directory as the script.\n","CONTENT_DOC_PATH = 'daily_content.docx'\n","OUTPUT_HTML_PATH = f\"equilend_daily_digest_{datetime.now().strftime('%Y_%m_%d')}.html\"\n","\n","# --- Gmail Configuration ---\n","SENDER_EMAIL = 'your_gmail_address@gmail.com'  # Replace with your Gmail address\n","RECIPIENT_EMAILS = 'recipient1@example.com,recipient2@example.com' # Replace with recipient email addresses\n","GMAIL_PASSWORD = 'your_app_password' # Replace with your Gmail password or App Password\n","\n","\n","# --- 1. DOCX Content Parsing ---\n","\n","def parse_daily_content(doc_path):\n","    \"\"\"\n","    Parses the .docx file for all text content, including market notes, headlines, key takeaways,\n","    and the content of the \"Hot & Getting Hotter\" and \"Squeeze Metrics\" tables.\n","    \"\"\"\n","    try:\n","        document = docx.Document(doc_path)\n","    except Exception as e:\n","        print(f\"Error opening or parsing DOCX file: {e}\")\n","        return None\n","\n","    content = {'market_notes': {}, 'headlines': [], 'key_takeaways': [], 'ht_borrow_table': [], 'squeeze_table': []}\n","    paras = [p.text.strip() for p in document.paragraphs if p.text.strip()]\n","    print(\"Parsed Paragraphs (for debugging):\")\n","    for i, p in enumerate(paras):\n","        print(f\"Paragraph {i}: {p}\")\n","\n","\n","    # --- Parse Market Notes from Table ---\n","    try:\n","        # Assuming Market Notes is Table 2\n","        market_notes_table_index = 1 # 0-indexed\n","        if len(document.tables) > market_notes_table_index:\n","            market_notes_table = document.tables[market_notes_table_index]\n","            print(f\"Identified Table {market_notes_table_index + 1} as potential Market Notes table.\")\n","\n","            # Assuming the table has 2 rows and 2 columns with merged cells in the first row\n","            print(\"Market Notes Table Content (for debugging):\")\n","            if len(market_notes_table.rows) >= 2 and len(market_notes_table.rows[0].cells) >= 2:\n","                # Extract data from the first row (merged cells)\n","                cell1_text = market_notes_table.rows[0].cells[0].text.strip()\n","                cell2_text = market_notes_table.rows[0].cells[1].text.strip()\n","\n","                # Parse the text to extract the values\n","                # Example format: \"Average Fee:\\n74.9 bps\\n+93.8%\\nOn Loan Value:\\n$3.05T\\n+1.02%\"\n","                # and \"Average Utilization:\\n7.11%\\n+0.11%\\nTotal Lendable Value:\\n$42.9T \\n+0.90%\"\n","\n","                # Parse Cell 1\n","                lines1 = cell1_text.split('\\n')\n","                print(f\"Cell 1 Lines: {lines1}\")\n","                if len(lines1) >= 4:\n","                    content['market_notes']['avg_fee_bps'] = lines1[1].replace('bps', '').strip()\n","                    change_match = re.search(r'([+-]?\\d+\\.?\\d*)%?', lines1[2])\n","                    content['market_notes']['avg_fee_change'] = float(change_match.group(1).replace('+','')) if change_match else 0.0\n","                    content['market_notes']['on_loan_value'] = lines1[4].replace('$', '').strip()\n","                    change_match = re.search(r'([+-]?\\d+\\.?\\d*)%?', lines1[5])\n","                    content['market_notes']['on_loan_value_change'] = float(change_match.group(1).replace('+','')) if change_match else 0.0\n","\n","                # Parse Cell 2\n","                lines2 = cell2_text.split('\\n')\n","                print(f\"Cell 2 Lines: {lines2}\")\n","                if len(lines2) >= 4:\n","                    content['market_notes']['avg_util_percent'] = lines2[1].replace('%', '').strip()\n","                    change_match = re.search(r'([+-]?\\d+\\.?\\d*)%?', lines2[2])\n","                    content['market_notes']['avg_util_change'] = float(change_match.group(1).replace('+','')) if change_match else 0.0\n","                    content['market_notes']['lendable_value'] = lines2[4].replace('$', '').strip()\n","                    change_match = re.search(r'([+-]?\\d+\\.?\\d*)%?', lines2[5])\n","                    content['market_notes']['lendable_value_change'] = float(change_match.group(1).replace('+','')) if change_match else 0.0\n","\n","\n","        else:\n","            print(f\"Warning: Could not find Table {market_notes_table_index + 1} for Market Notes.\")\n","\n","    except Exception as e:\n","        print(f\"Warning: Could not parse Market Notes from table. Error: {e}\")\n","\n","\n","    # --- Parse Headlines ---\n","    # This part remains the same as it parses from paragraphs\n","    try:\n","        headline_start_index = -1\n","        for i, p_text in enumerate(paras):\n","            if 'major headlines' in p_text.lower():\n","                headline_start_index = i + 1\n","                break\n","\n","        if headline_start_index != -1:\n","            i = headline_start_index\n","            while i < len(paras):\n","                end_of_block_idx = -1\n","                # Find the next data insight line\n","                for j in range(i + 1, len(paras)):\n","                    if 'what our data shows' in paras[j].lower():\n","                        end_of_block_idx = j\n","                        break\n","\n","                if end_of_block_idx != -1:\n","                    title = paras[i].rstrip(':').rstrip('.')\n","                    description = \"\\n\".join(paras[i+1:end_of_block_idx])\n","                    data_insight_raw = paras[end_of_block_idx]\n","                    data_insight = re.sub(r'[\\starbullet\\s]*What our data shows:\\s?', '', data_insight_raw, flags=re.IGNORECASE).strip()\n","\n","                    content['headlines'].append({\n","                        'title': title,\n","                        'description': description,\n","                        'data_insight': data_insight\n","                    })\n","                    i = end_of_block_idx + 1\n","                else:\n","                    break # No more headline blocks found\n","    except Exception as e:\n","        print(f\"Warning: Could not parse Headlines. Error: {e}\")\n","\n","    # --- Parse Tables (Hot & Getting Hotter and Squeeze Metrics) ---\n","    try:\n","        # Assuming Hot & Getting Hotter is Table 3 and Squeeze Metrics is Table 4\n","        ht_borrow_table_index = 2 # 0-indexed\n","        squeeze_table_index = 3 # 0-indexed\n","\n","        if len(document.tables) > ht_borrow_table_index:\n","            ht_borrow_table = document.tables[ht_borrow_table_index]\n","            print(f\"Identified Table {ht_borrow_table_index + 1} as 'Hot & Getting Hotter'.\")\n","            if ht_borrow_table.rows:\n","                 for r_idx, row in enumerate(ht_borrow_table.rows[1:]): # Skip header row\n","                        cells = [cell.text.strip() for cell in row.cells]\n","                        if len(cells) >= 5: # Ensure enough columns\n","                            content['ht_borrow_table'].append({\n","                                'TICKER': cells[0],\n","                                'Security Description': cells[1],\n","                                'Industry': cells[2],\n","                                'Price': cells[3],\n","                                'Fee 1 Week Diff (BPS)': cells[4]\n","                            })\n","            print(f\"Parsed {len(content['ht_borrow_table'])} rows for 'Hot & Getting Hotter'.\")\n","        else:\n","            print(f\"Warning: Could not find Table {ht_borrow_table_index + 1} for 'Hot & Getting Hotter'.\")\n","\n","\n","        if len(document.tables) > squeeze_table_index:\n","            squeeze_table = document.tables[squeeze_table_index]\n","            print(f\"Identified Table {squeeze_table_index + 1} as 'Squeeze Metrics'.\")\n","            if squeeze_table.rows:\n","                 for r_idx, row in enumerate(squeeze_table.rows[1:]): # Skip header row\n","                        cells = [cell.text.strip() for cell in row.cells]\n","                        if len(cells) >= 6: # Ensure enough columns\n","                            content['squeeze_table'].append({\n","                                'TICKER': cells[0],\n","                                'Security Description': cells[1],\n","                                'Industry': cells[2],\n","                                'Price': cells[3],\n","                                'Short Squeeze Score (SSS)': cells[4],\n","                                'SSS WoW': cells[5]\n","                            })\n","            print(f\"Parsed {len(content['squeeze_table'])} rows for 'Squeeze Metrics'.\")\n","        else:\n","            print(f\"Warning: Could not find Table {squeeze_table_index + 1} for 'Squeeze Metrics'.\")\n","\n","\n","    except Exception as e:\n","        print(f\"Warning: Could not parse Hot & Getting Hotter or Squeeze Metrics tables from DOCX. Error: {e}\")\n","\n","\n","    # --- Parse Key Takeaways ---\n","    # This part remains the same as it parses from paragraphs\n","    try:\n","        takeaways_start_index = -1\n","        for i, p_text in enumerate(enumerate(paras)):\n","            if 'key takeaways' in p_text.lower():\n","                takeaways_start_index = i + 1\n","                break\n","        if takeaways_start_index != -1:\n","            for i in range(takeaways_start_index, len(paras)):\n","                line = paras[i].lstrip('-â€¢* ').strip()\n","                if not line: continue\n","                content['key_takeaways'].append(line)\n","    except Exception as e:\n","        print(f\"Warning: Could not parse Key Takeaways. Error: {e}\")\n","\n","    return content\n","\n","# --- 2. Table Parsing (Modified to use parsed data) ---\n","\n","def generate_table_html(table_data, table_type):\n","    \"\"\"\n","    Generates HTML for a table from parsed data.\n","    \"\"\"\n","    html = \"\"\n","\n","    def format_change(value, unit=' BPS', decimal_places=0):\n","        try:\n","            # Handle potential non-numeric values or empty strings\n","            if pd.isna(value) or value == '':\n","                return ''\n","\n","            cleaned_value = str(value).replace(',', '').strip()\n","            val = float(cleaned_value)\n","            color = '#16a34a' if val > 0 else '#dc2626'\n","            sign = '+' if val > 0 else ''\n","            format_string = f'{{val:,.{decimal_places}f}}{{unit}}' if decimal_places > 0 else f'{{val:,.0f}}{{unit}}'\n","            return f'<span style=\"color:{color}; font-size:14px;\">{sign}{format_string.format(val=val, unit=unit)}</span>'\n","        except (ValueError, TypeError):\n","            return str(value).strip() if pd.notna(value) else ''\n","\n","\n","    if table_type == 'ht_borrow':\n","        for row in table_data:\n","            price_value = row.get(\"Price\", \"\")\n","            formatted_price = f\"${price_value}\" if price_value != \"\" else \"\"\n","            html += f\"\"\"\n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">{row.get(\"TICKER\", \"\")}</td>\n","                <td style=\"padding:2px 4px;\">{row.get(\"Security Description\", \"\")}</td>\n","                <td style=\"padding:2px 4px;\">{row.get(\"Industry\", \"\")}</td>\n","                <td style=\"padding:2px 4px;\">{formatted_price}</td>\n","                <td style=\"padding:2px 4px;\">{format_change(row.get(\"Fee 1 Week Diff (BPS)\"))}</td>\n","            </tr>\"\"\"\n","    elif table_type == 'squeeze':\n","        for row in table_data:\n","            price_value = row.get(\"Price\", \"\")\n","            formatted_price = f\"${price_value}\" if price_value != \"\" else \"\"\n","            html += f\"\"\"\n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">{row.get(\"TICKER\", \"\")}</td>\n","                <td style=\"padding:2px 4px;\">{row.get(\"Security Description\", \"\")}</td>\n","                <td style=\"padding:2px 4px;\">{row.get(\"Industry\", \"\")}</td>\n","                <td style=\"padding:2px 4px;\">{formatted_price}</td>\n","                <td style=\"padding:2px 4px;\">{row.get(\"Short Squeeze Score (SSS)\", \"\")}</td>\n","                <td style=\"padding:2px 4px;\">{format_change(row.get(\"SSS WoW\"), unit=\"\", decimal_places=0)}</td>\n","            </tr>\"\"\"\n","\n","    return html\n","\n","\n","# --- 3. HTML Generation ---\n","\n","def create_digest_html(content):\n","    \"\"\"\n","    Generates the final HTML for the digest by populating a template.\n","    \"\"\"\n","    if not content:\n","        return \"<h1>Error: Could not generate content.</h1>\"\n","\n","    ht_borrow_table = generate_table_html(content.get('ht_borrow_table', []), 'ht_borrow')\n","    squeeze_table = generate_table_html(content.get('squeeze_table', []), 'squeeze')\n","\n","    def format_market_note_change(value):\n","        color = '#16a34a' if value >= 0 else '#dc2626'\n","        sign = '+' if value >= 0 else ''\n","        return f'<span style=\"color:{color}; font-size:14px;\">{sign}{value:.2f}%</span>'\n","\n","    market_notes = content.get('market_notes', {})\n","    avg_fee_bps = market_notes.get('avg_fee_bps', 'N/A')\n","    # Ensure avg_fee_change is a number before formatting\n","    avg_fee_change_value = market_notes.get('avg_fee_change', 0)\n","    avg_fee_change = format_market_note_change(avg_fee_change_value) if isinstance(avg_fee_change_value, (int, float)) else 'N/A'\n","\n","    avg_util_percent = market_notes.get('avg_util_percent', 'N/A')\n","    # Ensure avg_util_change is a number before formatting\n","    avg_util_change_value = market_notes.get('avg_util_change', 0)\n","    avg_util_change = format_market_note_change(avg_util_change_value) if isinstance(avg_util_change_value, (int, float)) else 'N/A'\n","\n","    on_loan_value = market_notes.get('on_loan_value', 'N/A')\n","    # Ensure on_loan_value_change is a number before formatting\n","    on_loan_value_change_value = market_notes.get('on_loan_value_change', 0)\n","    on_loan_value_change = format_market_note_change(on_loan_value_change_value) if isinstance(on_loan_value_change_value, (int, float)) else 'N/A'\n","\n","    lendable_value = market_notes.get('lendable_value', 'N/A')\n","    # Ensure lendable_value_change is a number before formatting\n","    lendable_value_change_value = market_notes.get('lendable_value_change', 0)\n","    lendable_value_change = format_market_note_change(lendable_value_change_value) if isinstance(lendable_value_change_value, (int, float)) else 'N/A'\n","\n","\n","    headlines_html = \"\"\n","    for headline in content.get('headlines', []):\n","        headlines_html += f\"\"\"\n","        <div style=\"margin-top:20px;\">\n","            <strong style=\"font-size:16px;\">{headline['title']}</strong>\n","            <p style=\"margin:5px 0 0; white-space: pre-wrap;\">{headline['description']}</p>\n","            <ul style=\"margin:10px 0 0; padding-left:20px; color:#334155; list-style-type: disc;\">\n","              <li><strong>What Our Data Shows:</strong> {headline['data_insight']}</li>\n","            </ul>\n","        </div>\n","        \"\"\"\n","\n","    takeaways_html = \"\".join([f\"<li>{item}</li>\" for item in content.get('key_takeaways', [])])\n","\n","    html_template = f\"\"\"\n","<!DOCTYPE html>\n","<html lang=\"en\">\n","<head>\n","  <meta charset=\"UTF-8\">\n","  <title>EquiLend D&A Daily Digest - {datetime.now().strftime('%B %d, %Y')}</title>\n","</head>\n","<body style=\"margin:0; padding:0; font-family: Arial, sans-serif; background-color:#f1f5f9;\">\n","  <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"#f1f5f9\">\n","    <tr>\n","      <td align=\"center\">\n","        <table width=\"800\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"#ffffff\" style=\"margin:20px 0; border-radius:4px; overflow:hidden;\">\n","          <!-- Header -->\n","          <tr>\n","            <td bgcolor=\"#0284c7\" style=\"padding:20px; text-align:center;\">\n","              <h1 style=\"margin:0; font-size:24px; color:#ffffff;\">EquiLend D&amp;A Daily Digest</h1>\n","              <p style=\"margin:5px 0 0; font-size:16px; color:#bae6fd;\">{datetime.now().strftime('%B %d, %Y')}</p>\n","            </td>\n","          </tr>\n","          <!-- Content -->\n","          <tr>\n","            <td style=\"padding:20px; color:#334155; font-size:14px; line-height:1.5;\">\n","\n","              <!-- Market Notes -->\n","              <h2 style=\"font-size:18px; margin-bottom:10px; color:#0284c7;\">&#x1F4BC; Market Notes</h2>\n","              <table width=\"100%\" cellpadding=\"5\" cellspacing=\"0\" border=\"0\" bgcolor=\"#f8fafc\" style=\"margin-bottom:20px;\">\n","                <tr>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Average Fee</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      {avg_fee_bps} bps {avg_fee_change}\n","                    </p>\n","                  </td>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Average Utilization</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      {avg_util_percent}% {avg_util_change}\n","                    </p>\n","                  </td>\n","                </tr>\n","                <tr>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">On Loan Value</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      ${on_loan_value} {on_loan_value_change}\n","                    </p>\n","                  </td>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Total Lendable Value</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      ${lendable_value} {lendable_value_change}\n","                    </p>\n","                  </td>\n","                </tr>\n","              </table>\n","\n","              <!-- Headlines -->\n","              <h2 style=\"font-size:18px; margin-bottom:10px; color:#0284c7;\">&#x1F4F0; Major Headlines and What Our Data Shows</h2>\n","              {headlines_html}\n","\n","              <!-- Tables Section -->\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F525; Hot & Getting Hotter</h2>\n","              <div style=\"font-size:14px; font-style:italic; color:#334155; margin-bottom:10px; padding-left:5px;\">Top 5 Stocks with fees > 50,000 bps & rising</div>\n","              <table cellpadding=\"0\" cellspacing=\"0\" border=\"1\" style=\"border-collapse:collapse; margin-bottom:20px; border-color:#dddddd; font-size:12px;\" width=\"100%\">\n","                <thead>\n","                  <tr bgcolor=\"#0284c7\" style=\"color:#ffffff; font-weight:bold; text-align:left;\">\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Ticker</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Company Name</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Industry</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Price</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Fee 1 WoW (bps)</th>\n","                  </tr>\n","                </thead>\n","                <tbody>\n","                  {ht_borrow_table}\n","                </tbody>\n","              </table>\n","\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F52C; Market Technicals & Squeeze Metrics</h2>\n","              <table cellpadding=\"0\" cellspacing=\"0\" border=\"1\" style=\"border-collapse:collapse; border-color:#dddddd; font-size:12px;\" width=\"100%\">\n","                <thead>\n","                  <tr bgcolor=\"#0284c7\" style=\"color:#ffffff; font-weight:bold; text-align:left;\">\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Ticker</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Company Name</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Industry</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Price</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Short Squeeze Score (SSS)</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">SSS WoW</th>\n","                  </tr>\n","                </thead>\n","                <tbody>\n","                  {squeeze_table}\n","                </tbody>\n","              </table>\n","\n","              <!-- Key Takeaways -->\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F4A1; Key Takeaways</h2>\n","              <ul style=\"padding-left:20px; color:#334155; font-size:14px; margin:0;\">\n","                {takeaways_html}\n","              </ul>\n","\n","            </td>\n","          </tr>\n","          <!-- Footer -->\n","          <tr>\n","            <td align=\"center\" style=\"padding:10px; font-size:12px; color:#64748b;\">\n","              Source: EquiLend Data &amp; Analytics\n","            </td>\n","          </tr>\n","        </table>\n","      </td>\n","    </tr>\n","  </table>\n","</body>\n","</html>\n","    \"\"\"\n","    return html_template\n","\n","# --- Gmail Sending Function ---\n","def send_gmail_email(sender_email, recipient_emails, subject, html_body):\n","    \"\"\"\n","    Sends an email via Gmail using the provided details.\n","\n","    Args:\n","        sender_email: The email address of the sender.\n","        recipient_emails: A string of comma-separated recipient email addresses.\n","        subject: The subject of the email.\n","        html_body: The HTML content of the email body.\n","    \"\"\"\n","    print(f\"Attempting to send email from: {sender_email}\")\n","    print(f\"To recipients: {recipient_emails}\")\n","    print(f\"With subject: {subject}\")\n","    print(\"Email body (first 100 characters):\")\n","    print(html_body[:100] + '...')\n","\n","    server = None # Initialize server to None\n","    try:\n","        # Establish a secure connection to Gmail's SMTP server\n","        server = smtplib.SMTP_SSL('smtp.gmail.com', 465)\n","        print(\"Successfully connected to Gmail SMTP server.\")\n","\n","        try:\n","            # Log in to the Gmail account\n","            server.login(sender_email, GMAIL_PASSWORD)\n","            print(\"Successfully logged in to Gmail account.\")\n","        except smtplib.AuthenticationError:\n","            print(\"Error: Authentication failed. Please check your email address and password/App Password.\")\n","            return\n","        except Exception as e:\n","            print(f\"Error during login: {e}\")\n","            return\n","\n","        # Create the email message\n","        msg = MIMEText(html_body, 'html')\n","        msg['Subject'] = subject\n","        msg['From'] = sender_email\n","        msg['To'] = recipient_emails\n","\n","        try:\n","            # Send the email\n","            server.sendmail(sender_email, recipient_emails.split(','), msg.as_string())\n","            print(\"Email sent successfully!\")\n","        except smtplib.SMTPRecipientsRefused:\n","            print(f\"Error: All recipients refused. Please check recipient email addresses: {recipient_emails}\")\n","        except smtplib.SMTPSenderRefused:\n","            print(f\"Error: Sender address refused. Please check sender email address: {sender_email}\")\n","        except smtplib.SMTPDataError as e:\n","             print(f\"SMTP Data Error: {e}\")\n","        except Exception as e:\n","            print(f\"Error sending email: {e}\")\n","\n","    except Exception as e:\n","        print(f\"Error connecting to Gmail SMTP server: {e}\")\n","        print(\"Please ensure you have a stable internet connection and Gmail SMTP is accessible.\")\n","    finally:\n","        if server:\n","            server.quit()\n","            print(\"SMTP server connection closed.\")\n","\n","\n","# --- Main Execution ---\n","if __name__ == \"__main__\":\n","    print(\"Starting daily digest generation...\")\n","\n","    # 1. Parse content from the Word document\n","    print(f\"Reading content from '{CONTENT_DOC_PATH}'...\")\n","    parsed_content = parse_daily_content(CONTENT_DOC_PATH)\n","\n","    # 2. Generate the final HTML file\n","    print(\"Generating final HTML digest...\")\n","    final_html = create_digest_html(parsed_content)\n","\n","    # 3. Save the HTML to a file\n","    with open(OUTPUT_HTML_PATH, 'w', encoding='utf-8') as f:\n","        f.write(final_html)\n","\n","    print(f\"\\nSuccessfully generated digest: {OUTPUT_HTML_PATH}\")\n","\n","    # 4. Send the HTML as an email\n","    email_subject = f\"EquiLend D&A Daily Digest - {datetime.now().strftime('%B %d, %Y')}\"\n","    print(f\"Attempting to send email with subject: {email_subject}\")\n","    send_gmail_email(SENDER_EMAIL, RECIPIENT_EMAILS, email_subject, final_html)\n","\n","    # Display the HTML content in the notebook (optional)\n","    # Check if the file exists before attempting to read it\n","    if os.path.exists(OUTPUT_HTML_PATH):\n","        # Read the content of the HTML file\n","        with open(OUTPUT_HTML_PATH, 'r', encoding='utf-8') as f:\n","            html_content = f.read()\n","\n","        # Display the HTML content\n","        display(HTML(html_content))\n","    else:\n","        print(f\"Error: The HTML file '{OUTPUT_HTML_PATH}' was not found.\")\n"],"execution_count":22,"outputs":[{"output_type":"stream","name":"stdout","text":["Starting daily digest generation...\n","Reading content from 'daily_content.docx'...\n","Error opening or parsing DOCX file: Package not found at 'daily_content.docx'\n","Generating final HTML digest...\n","\n","Successfully generated digest: equilend_daily_digest_2025_08_08.html\n","Attempting to send email with subject: EquiLend D&A Daily Digest - August 08, 2025\n","Attempting to send email from: your_gmail_address@gmail.com\n","To recipients: recipient1@example.com,recipient2@example.com\n","With subject: EquiLend D&A Daily Digest - August 08, 2025\n","Email body (first 100 characters):\n","<h1>Error: Could not generate content.</h1>...\n","Successfully connected to Gmail SMTP server.\n","Error connecting to Gmail SMTP server: module 'smtplib' has no attribute 'AuthenticationError'\n","Please ensure you have a stable internet connection and Gmail SMTP is accessible.\n","SMTP server connection closed.\n"]},{"output_type":"display_data","data":{"text/plain":["<IPython.core.display.HTML object>"],"text/html":["<h1>Error: Could not generate content.</h1>"]},"metadata":{}}]},{"cell_type":"markdown","metadata":{"id":"98561fa3"},"source":["**Reasoning**:\n","The code failed because the `docx` module was not found. Although a previous cell attempted to install `python-docx`, it was not executed in the current runtime. I need to add a cell to install `python-docx` before attempting to import it again.\n","\n"]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"go7GL16qrtDt","executionInfo":{"status":"ok","timestamp":1754673411318,"user_tz":240,"elapsed":4806,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"9a2854bd-2cb8-4a64-ecdf-ab65eeb797da"},"source":["!pip install python-docx"],"execution_count":24,"outputs":[{"output_type":"stream","name":"stdout","text":["Requirement already satisfied: python-docx in /usr/local/lib/python3.11/dist-packages (1.2.0)\n","Requirement already satisfied: lxml>=3.1.0 in /usr/local/lib/python3.11/dist-packages (from python-docx) (5.4.0)\n","Requirement already satisfied: typing_extensions>=4.9.0 in /usr/local/lib/python3.11/dist-packages (from python-docx) (4.14.1)\n"]}]},{"cell_type":"markdown","metadata":{"id":"c7ad39b6"},"source":["**Reasoning**:\n","The `python-docx` library has been successfully installed. Now I can re-execute the code block that defines the variables, functions, and the main execution logic which includes calling the `send_gmail_email` function. This should resolve the `ModuleNotFoundError` and proceed with the rest of the script.\n","\n"]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":1000},"id":"964af71b","executionInfo":{"status":"ok","timestamp":1754673992476,"user_tz":240,"elapsed":459,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"f9a60ae9-4aa9-498e-a458-477845727db0"},"source":["import pandas as pd\n","import docx\n","from datetime import datetime\n","import re\n","import numpy as np\n","import smtplib\n","from email.mime.text import MIMEText\n","import os\n","from IPython.display import display, HTML\n","\n","\n","# --- Configuration ---\n","# The script will read all content from this file.\n","# Ensure it is in the same directory as the script.\n","CONTENT_DOC_PATH = 'daily_content.docx'\n","OUTPUT_HTML_PATH = f\"equilend_daily_digest_{datetime.now().strftime('%Y_%m_%d')}.html\"\n","\n","# --- Gmail Configuration ---\n","SENDER_EMAIL = 'bobsheehan23@gmail.com'  # Replace with your Gmail address\n","RECIPIENT_EMAILS = 'bob.sheehan@equilend.com,rsheehan@equilend.com' # Replace with recipient email addresses\n","# It is highly recommended to use a Gmail App Password instead of your main account password for security.\n","# You can generate an App Password in your Google Account security settings under \"2-Step Verification\".\n","GMAIL_PASSWORD = '.2389nice' # Replace with your Gmail password or App Password\n","\n","\n","# --- 1. Content Parsing (Modified to handle Excel and DOCX) ---\n","\n","def parse_daily_content(doc_path):\n","    \"\"\"\n","    Parses the .docx file for all text content, including market notes, headlines, key takeaways.\n","    It also attempts to read the \"Hot & Getting Hotter\" and \"Squeeze Metrics\" tables from\n","    'fee_table.xlsx' and 'squeeze_table.xlsx' if they exist, otherwise parses them from the DOCX.\n","    \"\"\"\n","    content = {'market_notes': {}, 'headlines': [], 'key_takeaways': [], 'ht_borrow_table': [], 'squeeze_table': []}\n","    paras = []\n","    document = None\n","\n","    try:\n","        document = docx.Document(doc_path)\n","        paras = [p.text.strip() for p in document.paragraphs if p.text.strip()]\n","        print(\"Parsed Paragraphs from DOCX (for debugging):\")\n","        for i, p in enumerate(paras):\n","            print(f\"Paragraph {i}: {p}\")\n","\n","    except Exception as e:\n","        print(f\"Error opening or parsing DOCX file '{doc_path}': {e}\")\n","        print(\"Proceeding to parse only tables from Excel files if available.\")\n","\n","\n","    # --- Parse Market Notes from Table (from DOCX only) ---\n","    if document: # Only attempt DOCX specific parsing if document was opened successfully\n","        try:\n","            # Assuming Market Notes is Table 2\n","            market_notes_table_index = 1 # 0-indexed\n","            if len(document.tables) > market_notes_table_index:\n","                market_notes_table = document.tables[market_notes_table_index]\n","                print(f\"Identified Table {market_notes_table_index + 1} as potential Market Notes table from DOCX.\")\n","\n","                # Assuming the table has 2 rows and 2 columns with merged cells in the first row\n","                print(\"Market Notes Table Content (for debugging):\")\n","                if len(market_notes_table.rows) >= 2 and len(market_notes_table.rows[0].cells) >= 2:\n","                    # Extract data from the first row (merged cells)\n","                    cell1_text = market_notes_table.rows[0].cells[0].text.strip()\n","                    cell2_text = market_notes_table.rows[0].cells[1].text.strip()\n","\n","                    # Parse the text to extract the values\n","                    # Example format: \"Average Fee:\\n74.9 bps\\n+93.8%\\nOn Loan Value:\\n$3.05T\\n+1.02%\"\n","                    # and \"Average Utilization:\\n7.11%\\n+0.11%\\nTotal Lendable Value:\\n$42.9T \\n+0.90%\"\n","\n","                    # Parse Cell 1\n","                    lines1 = cell1_text.split('\\n')\n","                    print(f\"Cell 1 Lines: {lines1}\")\n","                    if len(lines1) >= 4:\n","                        content['market_notes']['avg_fee_bps'] = lines1[1].replace('bps', '').strip()\n","                        change_match = re.search(r'([+-]?\\d+\\.?\\d*)%?', lines1[2])\n","                        content['market_notes']['avg_fee_change'] = float(change_match.group(1).replace('+','')) if change_match else 0.0\n","                        content['market_notes']['on_loan_value'] = lines1[4].replace('$', '').strip()\n","                        change_match = re.search(r'([+-]?\\d+\\.?\\d*)%?', lines1[5])\n","                        content['market_notes']['on_loan_value_change'] = float(change_match.group(1).replace('+','')) if change_match else 0.0\n","\n","                    # Parse Cell 2\n","                    lines2 = cell2_text.split('\\n')\n","                    print(f\"Cell 2 Lines: {lines2}\")\n","                    if len(lines2) >= 4:\n","                        content['market_notes']['avg_util_percent'] = lines2[1].replace('%', '').strip()\n","                        change_match = re.search(r'([+-]?\\d+\\.?\\d*)%?', lines2[2])\n","                        content['market_notes']['avg_util_change'] = float(change_match.group(1).replace('+','')) if change_match else 0.0\n","                        content['market_notes']['lendable_value'] = lines2[4].replace('$', '').strip()\n","                        change_match = re.search(r'([+-]?\\d+\\.?\\d*)%?', lines2[5])\n","                        content['market_notes']['lendable_value_change'] = float(change_match.group(1).replace('+','')) if change_match else 0.0\n","\n","            else:\n","                print(f\"Warning: Could not find Table {market_notes_table_index + 1} for Market Notes in DOCX.\")\n","\n","        except Exception as e:\n","            print(f\"Warning: Could not parse Market Notes from DOCX table. Error: {e}\")\n","\n","\n","    # --- Parse Headlines (from DOCX only) ---\n","    if paras: # Only attempt DOCX specific parsing if paragraphs were read\n","        try:\n","            headline_start_index = -1\n","            for i, p_text in enumerate(paras):\n","                if 'major headlines' in p_text.lower():\n","                    headline_start_index = i + 1\n","                    break\n","\n","            if headline_start_index != -1:\n","                i = headline_start_index\n","                while i < len(paras):\n","                    end_of_block_idx = -1\n","                    # Find the next data insight line\n","                    for j in range(i + 1, len(paras)):\n","                        if 'what our data shows' in paras[j].lower():\n","                            end_of_block_idx = j\n","                            break\n","\n","                    if end_of_block_idx != -1:\n","                        title = paras[i].rstrip(':').rstrip('.')\n","                        description = \"\\n\".join(paras[i+1:end_of_block_idx])\n","                        data_insight_raw = paras[end_of_block_idx]\n","                        data_insight = re.sub(r'[\\starbullet\\s]*What our data shows:\\s?', '', data_insight_raw, flags=re.IGNORECASE).strip()\n","\n","                        content['headlines'].append({\n","                            'title': title,\n","                            'description': description,\n","                            'data_insight': data_insight\n","                        })\n","                        i = end_of_block_idx + 1\n","                    else:\n","                        break # No more headline blocks found\n","        except Exception as e:\n","            print(f\"Warning: Could not parse Headlines from DOCX. Error: {e}\")\n","\n","        # --- Parse Key Takeaways (from DOCX only) ---\n","        try:\n","            takeaways_start_index = -1\n","            for i, p_text in enumerate(paras):\n","                if 'key takeaways' in p_text.lower():\n","                    takeaways_start_index = i + 1\n","                    break\n","            if takeaways_start_index != -1:\n","                for i in range(takeaways_start_index, len(paras)):\n","                    line = paras[i].lstrip('-â€¢* ').strip()\n","                    if not line: continue\n","                    content['key_takeaways'].append(line)\n","        except Exception as e:\n","            print(f\"Warning: Could not parse Key Takeaways from DOCX. Error: {e}\")\n","\n","\n","    # --- Parse Tables (Hot & Getting Hotter and Squeeze Metrics) from Excel or DOCX ---\n","    fee_excel_path = 'fee_table.xlsx'\n","    squeeze_excel_path = 'squeeze_table.xlsx'\n","\n","    # Attempt to read from Excel files first\n","    if os.path.exists(fee_excel_path):\n","        try:\n","            fee_df = pd.read_excel(fee_excel_path)\n","            # Ensure column names match exactly or adjust as needed based on the actual Excel file\n","            # Assuming the Excel columns are 'Ticker', 'Company Name', 'Industry', 'Price', 'Fee 1 WoW (bps)'\n","            content['ht_borrow_table'] = fee_df.rename(columns={\n","                'Ticker': 'TICKER',\n","                'Company Name': 'Security Description',\n","                'Industry': 'Industry',\n","                'Price': 'Price',\n","                'Fee 1 WoW (bps)': 'Fee 1 Week Diff (BPS)'\n","            }).to_dict('records')\n","            print(f\"Parsed {len(content['ht_borrow_table'])} rows for 'Hot & Getting Hotter' from '{fee_excel_path}'.\")\n","            # Add debugging print for fee table data\n","            # print(\"Debugging Fee Table Data (first 5 rows):\")\n","            # for i, row in enumerate(content['ht_borrow_table'][:5]):\n","            #     print(f\"Row {i}: {row}\")\n","\n","        except Exception as e:\n","            print(f\"Warning: Could not read '{fee_excel_path}'. Error: {e}\")\n","    elif document: # Fallback to DOCX if Excel not found and DOCX was opened\n","        try:\n","            # Assuming Hot & Getting Hotter is Table 3 in DOCX\n","            ht_borrow_table_index = 2 # 0-indexed\n","            if len(document.tables) > ht_borrow_table_index:\n","                ht_borrow_table = document.tables[ht_borrow_table_index]\n","                print(f\"Identified Table {ht_borrow_table_index + 1} as 'Hot & Getting Hotter' from DOCX.\")\n","                if ht_borrow_table.rows:\n","                     for r_idx, row in enumerate(ht_borrow_table.rows[1:]): # Skip header row\n","                            cells = [cell.text.strip() for cell in row.cells]\n","                            if len(cells) >= 5: # Ensure enough columns\n","                                content['ht_borrow_table'].append({\n","                                    'TICKER': cells[0],\n","                                    'Security Description': cells[1],\n","                                    'Industry': cells[2],\n","                                    'Price': cells[3],\n","                                    'Fee 1 Week Diff (BPS)': cells[4]\n","                                })\n","                print(f\"Parsed {len(content['ht_borrow_table'])} rows for 'Hot & Getting Hotter' from DOCX.\")\n","            else:\n","                print(f\"Warning: Could not find Table {ht_borrow_table_index + 1} for 'Hot & Getting Hotter' in DOCX.\")\n","\n","        except Exception as e:\n","            print(f\"Warning: Could not parse Hot & Getting Hotter table from DOCX. Error: {e}\")\n","\n","\n","    if os.path.exists(squeeze_excel_path):\n","        try:\n","            squeeze_df = pd.read_excel(squeeze_excel_path)\n","            # Ensure column names match exactly or adjust as needed based on the actual Excel file\n","            # Assuming the Excel columns are 'Ticker', 'Company Name', 'Industry', 'Price', 'Short Squeeze Score (SSS)', 'SSS WoW'\n","            content['squeeze_table'] = squeeze_df.rename(columns={\n","                'Ticker': 'TICKER',\n","                'Company Name': 'Security Description',\n","                'Industry': 'Industry',\n","                'Price': 'Price',\n","                'Short Squeeze Score (SSS)': 'Short Squeeze Score (SSS)',\n","                'SSS WoW': 'SSS WoW'\n","            }).to_dict('records')\n","            print(f\"Parsed {len(content['squeeze_table'])} rows for 'Squeeze Metrics' from '{squeeze_excel_path}'.\")\n","            # Add debugging print for squeeze table data\n","            # print(\"Debugging Squeeze Table Data (first 5 rows):\")\n","            # for i, row in enumerate(content['squeeze_table'][:5]):\n","            #     print(f\"Row {i}: {row}\")\n","\n","        except Exception as e:\n","            print(f\"Warning: Could not read '{squeeze_excel_path}'. Error: {e}\")\n","    elif document: # Fallback to DOCX if Excel not found and DOCX was opened\n","        try:\n","            # Assuming Squeeze Metrics is Table 4 in DOCX\n","            squeeze_table_index = 3 # 0-indexed\n","            if len(document.tables) > squeeze_table_index:\n","                squeeze_table = document.tables[squeeze_table_index]\n","                print(f\"Identified Table {squeeze_table_index + 1} as 'Squeeze Metrics' from DOCX.\")\n","                if squeeze_table.rows:\n","                     for r_idx, row in enumerate(squeeze_table.rows[1:]): # Skip header row\n","                            cells = [cell.text.strip() for cell in row.cells]\n","                            if len(cells) >= 6: # Ensure enough columns\n","                                content['squeeze_table'].append({\n","                                    'TICKER': cells[0],\n","                                    'Security Description': cells[1],\n","                                    'Industry': cells[2],\n","                                    'Price': cells[3],\n","                                    'Short Squeeze Score (SSS)': cells[4],\n","                                    'SSS WoW': cells[5]\n","                                })\n","                print(f\"Parsed {len(content['squeeze_table'])} rows for 'Squeeze Metrics' from DOCX.\")\n","            else:\n","                print(f\"Warning: Could not find Table {squeeze_table_index + 1} for 'Squeeze Metrics' in DOCX.\")\n","\n","        except Exception as e:\n","            print(f\"Warning: Could not parse Squeeze Metrics table from DOCX. Error: {e}\")\n","\n","\n","    return content\n","\n","# --- 2. Table Parsing (Modified to use parsed data) ---\n","\n","def generate_table_html(table_data, table_type):\n","    \"\"\"\n","    Generates HTML for a table from parsed data.\n","    \"\"\"\n","    html = \"\"\n","\n","    def format_change(value, unit=' BPS', decimal_places=0):\n","        try:\n","            # Handle potential non-numeric values or empty strings\n","            if pd.isna(value) or value == '':\n","                return ''\n","\n","            # Attempt to convert to float, handling potential errors\n","            try:\n","                cleaned_value = str(value).replace(',', '').strip()\n","                val = float(cleaned_value)\n","            except ValueError:\n","                # If conversion fails, return the original value as a string\n","                # print(f\"Debug: Could not convert value '{value}' to float in format_change. Returning as string.\") # Removed debug print\n","                return str(value).strip() if pd.notna(value) else ''\n","\n","\n","            color = '#16a34a' if val > 0 else '#dc2626'\n","            sign = '+' if val > 0 else ''\n","            format_string = f'{{val:,.{decimal_places}f}}{{unit}}' if decimal_places > 0 else f'{{val:,.0f}}{{unit}}'\n","            return f'<span style=\"color:{color}; font-size:14px;\">{sign}{format_string.format(val=val, unit=unit)}</span>'\n","        except (ValueError, TypeError):\n","            # print(f\"Debug: Error formatting value '{value}'. Returning as string.\") # Removed debug print\n","            return str(value).strip() if pd.notna(value) else ''\n","\n","\n","    if table_type == 'ht_borrow':\n","        for row in table_data:\n","            price_value = row.get(\"Price\", \"\")\n","            formatted_price = f\"${price_value}\" if price_value != \"\" else \"\"\n","            # Ensure correct keys are used for accessing data from the dictionary\n","            # Debugging print for fee value before formatting\n","            fee_value = row.get(\"Fee 1 Week Diff (BPS)\")\n","            # print(f\"Debug (HT Borrow): Processing Fee 1 Week Diff (BPS) value: '{fee_value}' (Type: {type(fee_value)})\") # Removed debug print\n","            # Double check the key used here matches the renamed column in parse_daily_content\n","            html += f\"\"\"\n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">{row.get(\"TICKER\", \"\")}</td>\n","                <td style=\"padding:2px 4px;\">{row.get(\"Security Description\", \"\")}</td>\n","                <td style=\"padding:2px 4px;\">{row.get(\"Industry\", \"\")}</td>\n","                <td style=\"padding:2px 4px;\">{formatted_price}</td>\n","                <td style=\"padding:2px 4px;\">{format_change(fee_value)}</td>\n","            </tr>\"\"\"\n","    elif table_type == 'squeeze':\n","        for row in table_data:\n","            price_value = row.get(\"Price\", \"\")\n","            formatted_price = f\"${price_value}\" if price_value != \"\" else \"\"\n","            # Ensure correct keys are used for accessing data from the dictionary, and Industry is included\n","            # Debugging print for SSS WoW value before formatting\n","            sss_wow_value = row.get(\"SSS WoW\")\n","            # print(f\"Debug (Squeeze): Processing SSS WoW value: '{sss_wow_value}' (Type: {type(sss_wow_value)})\") # Removed debug print\n","            # Double check the key used here matches the renamed column in parse_daily_content\n","            html += f\"\"\"\n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">{row.get(\"TICKER\", \"\")}</td>\n","                <td style=\"padding:2px 4px;\">{row.get(\"Security Description\", \"\")}</td>\n","                <td style=\"padding:2px 4px;\">{row.get(\"Industry\", \"\")}</td>\n","                <td style=\"padding:2px 4px;\">{formatted_price}</td>\n","                <td style=\"padding:2px 4px;\">{row.get(\"Short Squeeze Score (SSS)\", \"\")}</td>\n","                <td style=\"padding:2px 4px;\">{format_change(sss_wow_value, unit=\"\", decimal_places=0)}</td>\n","            </tr>\"\"\"\n","\n","    return html\n","\n","\n","# --- 3. HTML Generation ---\n","\n","def create_digest_html(content):\n","    \"\"\"\n","    Generates the final HTML for the digest by populating a template.\n","    \"\"\"\n","    if not content:\n","        return \"<h1>Error: Could not generate content.</h1>\"\n","\n","    ht_borrow_table = generate_table_html(content.get('ht_borrow_table', []), 'ht_borrow')\n","    squeeze_table = generate_table_html(content.get('squeeze_table', []), 'squeeze')\n","\n","    def format_market_note_change(value):\n","        color = '#16a34a' if value >= 0 else '#dc2626'\n","        sign = '+' if value >= 0 else ''\n","        return f'<span style=\"color:{color}; font-size:14px;\">{sign}{value:.2f}%</span>'\n","\n","    market_notes = content.get('market_notes', {})\n","    avg_fee_bps = market_notes.get('avg_fee_bps', 'N/A')\n","    # Ensure avg_fee_change is a number before formatting\n","    avg_fee_change_value = market_notes.get('avg_fee_change', 0)\n","    avg_fee_change = format_market_note_change(avg_fee_change_value) if isinstance(avg_fee_change_value, (int, float)) else 'N/A'\n","\n","    avg_util_percent = market_notes.get('avg_util_percent', 'N/A')\n","    # Ensure avg_util_change is a number before formatting\n","    avg_util_change_value = market_notes.get('avg_util_change', 0)\n","    avg_util_change = format_market_note_change(avg_util_change_value) if isinstance(avg_util_change_value, (int, float)) else 'N/A'\n","\n","    on_loan_value = market_notes.get('on_loan_value', 'N/A')\n","    # Ensure on_loan_value_change is a number before formatting\n","    on_loan_value_change_value = market_notes.get('on_loan_value_change', 0)\n","    on_loan_value_change = format_market_note_change(on_loan_value_change_value) if isinstance(on_loan_value_change_value, (int, float)) else 'N/A'\n","\n","    lendable_value = market_notes.get('lendable_value', 'N/A')\n","    # Ensure lendable_value_change is a number before formatting\n","    lendable_value_change_value = market_notes.get('lendable_value_change', 0)\n","    lendable_value_change = format_market_note_change(lendable_value_change_value) if isinstance(lendable_value_change_value, (int, float)) else 'N/A'\n","\n","\n","    headlines_html = \"\"\n","    for headline in content.get('headlines', []):\n","        headlines_html += f\"\"\"\n","        <div style=\"margin-top:20px;\">\n","            <strong style=\"font-size:16px;\">{headline['title']}</strong>\n","            <p style=\"margin:5px 0 0; white-space: pre-wrap;\">{headline['description']}</p>\n","            <ul style=\"margin:10px 0 0; padding-left:20px; color:#334155; list-style-type: disc;\">\n","              <li><strong>What Our Data Shows:</strong> {headline['data_insight']}</li>\n","            </ul>\n","        </div>\n","        \"\"\"\n","\n","    takeaways_html = \"\".join([f\"<li>{item}</li>\" for item in content.get('key_takeaways', [])])\n","\n","    html_template = f\"\"\"\n","<!DOCTYPE html>\n","<html lang=\"en\">\n","<head>\n","  <meta charset=\"UTF-8\">\n","  <title>EquiLend D&A Daily Digest - {datetime.now().strftime('%B %d, %Y')}</title>\n","</head>\n","<body style=\"margin:0; padding:0; font-family: Arial, sans-serif; background-color:#f1f5f9;\">\n","  <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"#f1f5f9\">\n","    <tr>\n","      <td align=\"center\">\n","        <table width=\"800\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"#ffffff\" style=\"margin:20px 0; border-radius:4px; overflow:hidden;\">\n","          <!-- Header -->\n","          <tr>\n","            <td bgcolor=\"#0284c7\" style=\"padding:20px; text-align:center;\">\n","              <h1 style=\"margin:0; font-size:24px; color:#ffffff;\">EquiLend D&amp;A Daily Digest</h1>\n","              <p style=\"margin:5px 0 0; font-size:16px; color:#bae6fd;\">{datetime.now().strftime('%B %d, %Y')}</p>\n","            </td>\n","          </tr>\n","          <!-- Content -->\n","          <tr>\n","            <td style=\"padding:20px; color:#334155; font-size:14px; line-height:1.5;\">\n","\n","              <!-- Market Notes -->\n","              <h2 style=\"font-size:18px; margin-bottom:10px; color:#0284c7;\">&#x1F4BC; Market Notes</h2>\n","              <table width=\"100%\" cellpadding=\"5\" cellspacing=\"0\" border=\"0\" bgcolor=\"#f8fafc\" style=\"margin-bottom:20px;\">\n","                <tr>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Average Fee</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      {avg_fee_bps} bps {avg_fee_change}\n","                    </p>\n","                  </td>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Average Utilization</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      {avg_util_percent}% {avg_util_change}\n","                    </p>\n","                  </td>\n","                </tr>\n","                <tr>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">On Loan Value</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      ${on_loan_value} {on_loan_value_change}\n","                    </p>\n","                  </td>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Total Lendable Value</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      ${lendable_value} {lendable_value_change}\n","                    </p>\n","                  </td>\n","                </tr>\n","              </table>\n","\n","              <!-- Headlines -->\n","              <h2 style=\"font-size:18px; margin-bottom:10px; color:#0284c7;\">&#x1F4F0; Major Headlines and What Our Data Shows</h2>\n","              {headlines_html}\n","\n","              <!-- Tables Section -->\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F525; Hot & Getting Hotter</h2>\n","              <div style=\"font-size:14px; font-style:italic; color:#334155; margin-bottom:10px; padding-left:5px;\">Top 5 Stocks with fees > 50,000 bps & rising</div>\n","              <table cellpadding=\"0\" cellspacing=\"0\" border=\"1\" style=\"border-collapse:collapse; margin-bottom:20px; border-color:#dddddd; font-size:12px;\" width=\"100%\">\n","                <thead>\n","                  <tr bgcolor=\"#0284c7\" style=\"color:#ffffff; font-weight:bold; text-align:left;\">\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Ticker</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Company Name</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Industry</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Price</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Fee 1 WoW (bps)</th>\n","                  </tr>\n","                </thead>\n","                <tbody>\n","                  {ht_borrow_table}\n","                </tbody>\n","              </table>\n","\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F52C; Market Technicals & Squeeze Metrics</h2>\n","              <table cellpadding=\"0\" cellspacing=\"0\" border=\"1\" style=\"border-collapse:collapse; border-color:#dddddd; font-size:12px;\" width=\"100%\">\n","                <thead>\n","                  <tr bgcolor=\"#0284c7\" style=\"color:#ffffff; font-weight:bold; text-align:left;\">\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Ticker</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Company Name</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Industry</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Price</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Short Squeeze Score (SSS)</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">SSS WoW</th>\n","                  </tr>\n","                </thead>\n","                <tbody>\n","                  {squeeze_table}\n","                </tbody>\n","              </table>\n","\n","              <!-- Key Takeaways -->\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F4A1; Key Takeaways</h2>\n","              <ul style=\"padding-left:20px; color:#334155; font-size:14px; margin:0;\">\n","                {takeaways_html}\n","              </ul>\n","\n","            </td>\n","          </tr>\n","          <!-- Footer -->\n","          <tr>\n","            <td align=\"center\" style=\"padding:10px; font-size:12px; color:#64748b;\">\n","              Source: EquiLend Data &amp; Analytics\n","            </td>\n","          </tr>\n","        </table>\n","      </td>\n","    </tr>\n","  </table>\n","</body>\n","</html>\n","    \"\"\"\n","    return html_template\n","\n","# --- Gmail Sending Function ---\n","def send_gmail_email(sender_email, recipient_emails, subject, html_body):\n","    \"\"\"\n","    Sends an email via Gmail using the provided details.\n","\n","    Args:\n","        sender_email: The email address of the sender.\n","        recipient_emails: A string of comma-separated recipient email addresses.\n","        subject: The subject of the email.\n","        html_body: The HTML content of the email body.\n","    \"\"\"\n","    print(f\"Attempting to send email from: {sender_email}\")\n","    print(f\"To recipients: {recipient_emails}\")\n","    print(f\"With subject: {subject}\")\n","    print(\"Email body (first 100 characters):\")\n","    print(html_body[:100] + '...')\n","\n","    server = None # Initialize server to None\n","    try:\n","        # Establish a secure connection to Gmail's SMTP server\n","        server = smtplib.SMTP_SSL('smtp.gmail.com', 465)\n","        print(\"Successfully connected to Gmail SMTP server.\")\n","\n","        try:\n","            # Log in to the Gmail account\n","            server.login(sender_email, GMAIL_PASSWORD)\n","            print(\"Successfully logged in to Gmail account.\")\n","        except smtplib.AuthenticationError:\n","            print(\"Error: Authentication failed. Please check your email address and password/App Password.\")\n","            return\n","        except Exception as e:\n","            print(f\"Error during login: {e}\")\n","            return\n","\n","        # Create the email message\n","        msg = MIMEText(html_body, 'html')\n","        msg['Subject'] = subject\n","        msg['From'] = sender_email\n","        msg['To'] = recipient_emails\n","\n","        try:\n","            # Send the email\n","            server.sendmail(sender_email, recipient_emails.split(','), msg.as_string())\n","            print(\"Email sent successfully!\")\n","        except smtplib.SMTPRecipientsRefused:\n","            print(f\"Error: All recipients refused. Please check recipient email addresses: {recipient_emails}\")\n","        except smtplib.SMTPSenderRefused:\n","            print(f\"Error: Sender address refused. Please check sender email address: {sender_email}\")\n","        except smtplib.SMTPDataError as e:\n","             print(f\"SMTP Data Error: {e}\")\n","        except Exception as e:\n","            print(f\"Error sending email: {e}\")\n","\n","    except Exception as e:\n","        print(f\"Error connecting to Gmail SMTP server: {e}\")\n","        print(\"Please ensure you have a stable internet connection and Gmail SMTP is accessible.\")\n","    finally:\n","        if server:\n","            server.quit()\n","            print(\"SMTP server connection closed.\")\n","\n","\n","# --- Main Execution ---\n","if __name__ == \"__main__\":\n","    print(\"Starting daily digest generation...\")\n","\n","    # 1. Parse content from the Word document and Excel files\n","    print(f\"Reading content from '{CONTENT_DOC_PATH}' and potential Excel files...\")\n","    parsed_content = parse_daily_content(CONTENT_DOC_PATH)\n","\n","    # 2. Generate the final HTML file\n","    print(\"Generating final HTML digest...\")\n","    final_html = create_digest_html(parsed_content)\n","\n","    # 3. Save the HTML to a file\n","    with open(OUTPUT_HTML_PATH, 'w', encoding='utf-8') as f:\n","        f.write(final_html)\n","\n","    print(f\"\\nSuccessfully generated digest: {OUTPUT_HTML_PATH}\")\n","\n","    # 4. Send the HTML as an email\n","    email_subject = f\"EquiLend D&A Daily Digest - {datetime.now().strftime('%B %d, %Y')}\"\n","    print(f\"Attempting to send email with subject: {email_subject}\")\n","    send_gmail_email(SENDER_EMAIL, RECIPIENT_EMAILS, email_subject, final_html)\n","\n","    # Display the HTML content in the notebook (optional)\n","    # Check if the file exists before attempting to read it\n","    if os.path.exists(OUTPUT_HTML_PATH):\n","        # Read the content of the HTML file\n","        with open(OUTPUT_HTML_PATH, 'r', encoding='utf-8') as f:\n","            html_content = f.read()\n","\n","        # Display the HTML content\n","        display(HTML(html_content))\n","    else:\n","        print(f\"Error: The HTML file '{OUTPUT_HTML_PATH}' was not found.\")"],"execution_count":41,"outputs":[{"output_type":"stream","name":"stdout","text":["Starting daily digest generation...\n","Reading content from 'daily_content.docx' and potential Excel files...\n","Parsed Paragraphs from DOCX (for debugging):\n","Paragraph 0: ðŸ“ˆMarket Notes:\n","Paragraph 1: ðŸ“°Major Headlines & What Our Data Shows:\n","Paragraph 2: Paramountâ€™s $8 billion Merger Shifts the Media Landscape\n","Paragraph 3: Paramount Global officially merged with Skydance Media in an $8.4 billion deal today, forming a new entity led by Skydance CEO David Ellison. The merger, approved by the FCC, includes plans for major restructuring, $2 billion in cost cuts, and renewed focus on streaming and film production. Political scrutiny followed a lawsuit settlement with Donald Trump and leadership changes, including the exit of Paramount co-CEO Brian Robbins. The merger marks a major realignment in U.S. media, blending legacy content with tech-driven ambitions.\n","Paragraph 4: What Our Data Shows:Â With Paramount Globalâ€™s merger completing, the final trading day for the companyâ€™s old stocks PARA and PARAA closed yesterday on August 6th, to be replaced by the Paramount Skydance Corporation (PSKY) as of today. Our data has seen significant movements as a result of this merger event, with the borrow cost of PARA rising to 56,500 bps on Friday following the initial announcement and then peaking at 65,000 bps on Tuesday in a rush of activity before yesterdays close. The scale of this borrowing activity in PARA resultingly drove the global fee across securities lending up by 94% day-over-day yesterday, up to 75 bps on average.\n","Paragraph 5: US Stocks Rally Despite Mixed Economic Signals and Ongoing Tariff Uncertainty\n","Paragraph 6: Equity markets saw gains, with the Nasdaq reaching a new record high, driven by strong corporate earnings from companies like Walt Disney and McDonald's. This positive sentiment occurred even as a weak services ISM report pointed to a slowdown in the services sector and rising price pressures. Investors appear to be weighing the positive earnings news against the potential drag on the economy from new tariffs and signs of a cooling labor market.\n","Paragraph 7: What our data shows: The globally recognized brands, McDonalds and Disney, have seen very positive Q2 revenue earnings this year and look set to repeat this in Q3 with strong fiscal 3rd quarter results being announced already. However, our data suggests contrasting market sentiment towards the two companies. Since a peak of over 8.5 million shares on loan in early-March this year, McDonalds Corp. (MCD) have seen short interest plummet, with only 750,000 shares on loan as of this week. Conversely, Walt Disney Company (DIS) have seen shares on loan rise by 28% in the past week, reaching 1.88M shares, indicating potential skepticism towards the movie giant.\n","Paragraph 8: Global Retail Industry Suffers Contrasting Returns\n","Paragraph 9: Tween retailer Claireâ€™s files for bankruptcy for the second time today, putting 1,300 U.S. stores a risk of closure as high-street brands continue to struggle. Meanwhile, online giant Shopify sees strong earnings which fueled a broader stock rally, lifting the shares of Walmart, Amazon and Costco.\n","Paragraph 10: What our data shows: Global luxury fashion holdings company, Capri Holding Ltd (CPRI), are a key example of the volatility in the retail industry, brought about by tariff uncertainty. Since the â€˜Liberation Dayâ€™ tariff announcement, CPRI has seen a peak of 11.75M shares on loan. This has reduced somewhat to around 4.5 million shares on loan currently, however, this value is still up 1,500% year-over-year from only ~200,000 shares on loan in August 2024.\n","Paragraph 11: ðŸ’¡Key Takeaways\n","Paragraph 12: The Paramount-Skydance $80 billion merger shakes up the media landscape with big investments planned for the newly formed company.\n","Paragraph 13: Big names such as Walt Disney and McDonalds drive the Nasdaq to another record high despite remaining concerns surrounding the latest tariff announcements.\n","Paragraph 14: The retail industry sees mixed fortunes as high-street brands stare down the barrel of bankruptcy with online giants profiting as a result.\n","Paragraph 15: EquiLend Data & Analytics\n","Identified Table 2 as potential Market Notes table from DOCX.\n","Market Notes Table Content (for debugging):\n","Parsed 5 rows for 'Hot & Getting Hotter' from 'fee_table.xlsx'.\n","Debugging Fee Table Data (first 5 rows):\n","Row 0: {'TICKER': 'FOXX', 'Security Description': 'FOXX DEVELOPMENT ', 'Industry': 'Tech Hardware & Equip', 'Price': 6.74, 'Fee WoW (bps)': 10247.0}\n","Row 1: {'TICKER': 'ABVE', 'Security Description': 'ABOVE FOOD INGRED', 'Industry': 'Food, Bev, Tobacco', 'Price': 1.6, 'Fee WoW (bps)': 15813.15}\n","Row 2: {'TICKER': 'DGNX', 'Security Description': 'DIGINEX LIMITED', 'Industry': 'Software & Srvcs', 'Price': 46.8, 'Fee WoW (bps)': 16539.29}\n","Row 3: {'TICKER': 'VWAV', 'Security Description': 'VISIONWAVE HOLDINGS', 'Industry': 'Capital Goods', 'Price': 7.17, 'Fee WoW (bps)': 13935.44}\n","Row 4: {'TICKER': 'PAPL', 'Security Description': 'PINEAPPLE FINANCIAL ', 'Industry': \"Diversified Fin'l\", 'Price': 2.86, 'Fee WoW (bps)': 16081.78}\n","Parsed 5 rows for 'Squeeze Metrics' from 'squeeze_table.xlsx'.\n","Debugging Squeeze Table Data (first 5 rows):\n","Row 0: {'TICKER': '3715 TT', 'Security Description': 'DYNAMIC HOLD.', 'Industry': 'Hardware & Equip', 'Price': 3.09, 'Short Squeeze Score (SSS)': 77, 'SSS WoW': 22}\n","Row 1: {'TICKER': '4935 JP', 'Security Description': 'LIBERTA CO', 'Industry': 'Retailing', 'Price': 22.47, 'Short Squeeze Score (SSS)': 75, 'SSS WoW': 27}\n","Row 2: {'TICKER': '8358 TT', 'Security Description': 'CO-TECH DEV ', 'Industry': 'Hardware & Equip', 'Price': 3.79, 'Short Squeeze Score (SSS)': 70, 'SSS WoW': 6}\n","Row 3: {'TICKER': '2334 JP', 'Security Description': 'EOLE INC ', 'Industry': 'Intr Media & Srvcs', 'Price': 26.79, 'Short Squeeze Score (SSS)': 66, 'SSS WoW': 21}\n","Row 4: {'TICKER': '1797 HK', 'Security Description': 'EAST BUY ', 'Industry': 'Food & Staples Retail', 'Price': 3.29, 'Short Squeeze Score (SSS)': 66, 'SSS WoW': 5}\n","Generating final HTML digest...\n","Debug (HT Borrow): Processing Fee 1 Week Diff (BPS) value: 'None' (Type: <class 'NoneType'>)\n","Debug (HT Borrow): Processing Fee 1 Week Diff (BPS) value: 'None' (Type: <class 'NoneType'>)\n","Debug (HT Borrow): Processing Fee 1 Week Diff (BPS) value: 'None' (Type: <class 'NoneType'>)\n","Debug (HT Borrow): Processing Fee 1 Week Diff (BPS) value: 'None' (Type: <class 'NoneType'>)\n","Debug (HT Borrow): Processing Fee 1 Week Diff (BPS) value: 'None' (Type: <class 'NoneType'>)\n","Debug (Squeeze): Processing SSS WoW value: '22' (Type: <class 'int'>)\n","Debug (Squeeze): Processing SSS WoW value: '27' (Type: <class 'int'>)\n","Debug (Squeeze): Processing SSS WoW value: '6' (Type: <class 'int'>)\n","Debug (Squeeze): Processing SSS WoW value: '21' (Type: <class 'int'>)\n","Debug (Squeeze): Processing SSS WoW value: '5' (Type: <class 'int'>)\n","\n","Successfully generated digest: equilend_daily_digest_2025_08_08.html\n","Attempting to send email with subject: EquiLend D&A Daily Digest - August 08, 2025\n","Attempting to send email from: bobsheehan23@gmail.com\n","To recipients: bob.sheehan@equilend.com,rsheehan@equilend.com\n","With subject: EquiLend D&A Daily Digest - August 08, 2025\n","Email body (first 100 characters):\n","\n","<!DOCTYPE html>\n","<html lang=\"en\">\n","<head>\n","  <meta charset=\"UTF-8\">\n","  <title>EquiLend D&A Daily Digest...\n","Successfully connected to Gmail SMTP server.\n","Error connecting to Gmail SMTP server: module 'smtplib' has no attribute 'AuthenticationError'\n","Please ensure you have a stable internet connection and Gmail SMTP is accessible.\n","SMTP server connection closed.\n"]},{"output_type":"display_data","data":{"text/plain":["<IPython.core.display.HTML object>"],"text/html":["\n","<!DOCTYPE html>\n","<html lang=\"en\">\n","<head>\n","  <meta charset=\"UTF-8\">\n","  <title>EquiLend D&A Daily Digest - August 08, 2025</title>\n","</head>\n","<body style=\"margin:0; padding:0; font-family: Arial, sans-serif; background-color:#f1f5f9;\">\n","  <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"#f1f5f9\">\n","    <tr>\n","      <td align=\"center\">\n","        <table width=\"800\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"#ffffff\" style=\"margin:20px 0; border-radius:4px; overflow:hidden;\">\n","          <!-- Header -->\n","          <tr>\n","            <td bgcolor=\"#0284c7\" style=\"padding:20px; text-align:center;\">\n","              <h1 style=\"margin:0; font-size:24px; color:#ffffff;\">EquiLend D&amp;A Daily Digest</h1>\n","              <p style=\"margin:5px 0 0; font-size:16px; color:#bae6fd;\">August 08, 2025</p>\n","            </td>\n","          </tr>\n","          <!-- Content -->\n","          <tr>\n","            <td style=\"padding:20px; color:#334155; font-size:14px; line-height:1.5;\">\n","\n","              <!-- Market Notes -->\n","              <h2 style=\"font-size:18px; margin-bottom:10px; color:#0284c7;\">&#x1F4BC; Market Notes</h2>\n","              <table width=\"100%\" cellpadding=\"5\" cellspacing=\"0\" border=\"0\" bgcolor=\"#f8fafc\" style=\"margin-bottom:20px;\">\n","                <tr>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Average Fee</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      N/A bps <span style=\"color:#16a34a; font-size:14px;\">+0.00%</span>\n","                    </p>\n","                  </td>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Average Utilization</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      N/A% <span style=\"color:#16a34a; font-size:14px;\">+0.00%</span>\n","                    </p>\n","                  </td>\n","                </tr>\n","                <tr>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">On Loan Value</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      $N/A <span style=\"color:#16a34a; font-size:14px;\">+0.00%</span>\n","                    </p>\n","                  </td>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Total Lendable Value</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      $N/A <span style=\"color:#16a34a; font-size:14px;\">+0.00%</span>\n","                    </p>\n","                  </td>\n","                </tr>\n","              </table>\n","\n","              <!-- Headlines -->\n","              <h2 style=\"font-size:18px; margin-bottom:10px; color:#0284c7;\">&#x1F4F0; Major Headlines and What Our Data Shows</h2>\n","              \n","        <div style=\"margin-top:20px;\">\n","            <strong style=\"font-size:16px;\">Paramountâ€™s $8 billion Merger Shifts the Media Landscape</strong>\n","            <p style=\"margin:5px 0 0; white-space: pre-wrap;\">Paramount Global officially merged with Skydance Media in an $8.4 billion deal today, forming a new entity led by Skydance CEO David Ellison. The merger, approved by the FCC, includes plans for major restructuring, $2 billion in cost cuts, and renewed focus on streaming and film production. Political scrutiny followed a lawsuit settlement with Donald Trump and leadership changes, including the exit of Paramount co-CEO Brian Robbins. The merger marks a major realignment in U.S. media, blending legacy content with tech-driven ambitions.</p>\n","            <ul style=\"margin:10px 0 0; padding-left:20px; color:#334155; list-style-type: disc;\">\n","              <li><strong>What Our Data Shows:</strong> With Paramount Globalâ€™s merger completing, the final trading day for the companyâ€™s old stocks PARA and PARAA closed yesterday on August 6th, to be replaced by the Paramount Skydance Corporation (PSKY) as of today. Our data has seen significant movements as a result of this merger event, with the borrow cost of PARA rising to 56,500 bps on Friday following the initial announcement and then peaking at 65,000 bps on Tuesday in a rush of activity before yesterdays close. The scale of this borrowing activity in PARA resultingly drove the global fee across securities lending up by 94% day-over-day yesterday, up to 75 bps on average.</li>\n","            </ul>\n","        </div>\n","        \n","        <div style=\"margin-top:20px;\">\n","            <strong style=\"font-size:16px;\">US Stocks Rally Despite Mixed Economic Signals and Ongoing Tariff Uncertainty</strong>\n","            <p style=\"margin:5px 0 0; white-space: pre-wrap;\">Equity markets saw gains, with the Nasdaq reaching a new record high, driven by strong corporate earnings from companies like Walt Disney and McDonald's. This positive sentiment occurred even as a weak services ISM report pointed to a slowdown in the services sector and rising price pressures. Investors appear to be weighing the positive earnings news against the potential drag on the economy from new tariffs and signs of a cooling labor market.</p>\n","            <ul style=\"margin:10px 0 0; padding-left:20px; color:#334155; list-style-type: disc;\">\n","              <li><strong>What Our Data Shows:</strong> The globally recognized brands, McDonalds and Disney, have seen very positive Q2 revenue earnings this year and look set to repeat this in Q3 with strong fiscal 3rd quarter results being announced already. However, our data suggests contrasting market sentiment towards the two companies. Since a peak of over 8.5 million shares on loan in early-March this year, McDonalds Corp. (MCD) have seen short interest plummet, with only 750,000 shares on loan as of this week. Conversely, Walt Disney Company (DIS) have seen shares on loan rise by 28% in the past week, reaching 1.88M shares, indicating potential skepticism towards the movie giant.</li>\n","            </ul>\n","        </div>\n","        \n","        <div style=\"margin-top:20px;\">\n","            <strong style=\"font-size:16px;\">Global Retail Industry Suffers Contrasting Returns</strong>\n","            <p style=\"margin:5px 0 0; white-space: pre-wrap;\">Tween retailer Claireâ€™s files for bankruptcy for the second time today, putting 1,300 U.S. stores a risk of closure as high-street brands continue to struggle. Meanwhile, online giant Shopify sees strong earnings which fueled a broader stock rally, lifting the shares of Walmart, Amazon and Costco.</p>\n","            <ul style=\"margin:10px 0 0; padding-left:20px; color:#334155; list-style-type: disc;\">\n","              <li><strong>What Our Data Shows:</strong> Global luxury fashion holdings company, Capri Holding Ltd (CPRI), are a key example of the volatility in the retail industry, brought about by tariff uncertainty. Since the â€˜Liberation Dayâ€™ tariff announcement, CPRI has seen a peak of 11.75M shares on loan. This has reduced somewhat to around 4.5 million shares on loan currently, however, this value is still up 1,500% year-over-year from only ~200,000 shares on loan in August 2024.</li>\n","            </ul>\n","        </div>\n","        \n","\n","              <!-- Tables Section -->\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F525; Hot & Getting Hotter</h2>\n","              <div style=\"font-size:14px; font-style:italic; color:#334155; margin-bottom:10px; padding-left:5px;\">Top 5 Stocks with fees > 50,000 bps & rising</div>\n","              <table cellpadding=\"0\" cellspacing=\"0\" border=\"1\" style=\"border-collapse:collapse; margin-bottom:20px; border-color:#dddddd; font-size:12px;\" width=\"100%\">\n","                <thead>\n","                  <tr bgcolor=\"#0284c7\" style=\"color:#ffffff; font-weight:bold; text-align:left;\">\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Ticker</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Company Name</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Industry</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Price</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Fee 1 WoW (bps)</th>\n","                  </tr>\n","                </thead>\n","                <tbody>\n","                  \n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">FOXX</td>\n","                <td style=\"padding:2px 4px;\">FOXX DEVELOPMENT </td>\n","                <td style=\"padding:2px 4px;\">Tech Hardware & Equip</td>\n","                <td style=\"padding:2px 4px;\">$6.74</td>\n","                <td style=\"padding:2px 4px;\"></td>\n","            </tr>\n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">ABVE</td>\n","                <td style=\"padding:2px 4px;\">ABOVE FOOD INGRED</td>\n","                <td style=\"padding:2px 4px;\">Food, Bev, Tobacco</td>\n","                <td style=\"padding:2px 4px;\">$1.6</td>\n","                <td style=\"padding:2px 4px;\"></td>\n","            </tr>\n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">DGNX</td>\n","                <td style=\"padding:2px 4px;\">DIGINEX LIMITED</td>\n","                <td style=\"padding:2px 4px;\">Software & Srvcs</td>\n","                <td style=\"padding:2px 4px;\">$46.8</td>\n","                <td style=\"padding:2px 4px;\"></td>\n","            </tr>\n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">VWAV</td>\n","                <td style=\"padding:2px 4px;\">VISIONWAVE HOLDINGS</td>\n","                <td style=\"padding:2px 4px;\">Capital Goods</td>\n","                <td style=\"padding:2px 4px;\">$7.17</td>\n","                <td style=\"padding:2px 4px;\"></td>\n","            </tr>\n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">PAPL</td>\n","                <td style=\"padding:2px 4px;\">PINEAPPLE FINANCIAL </td>\n","                <td style=\"padding:2px 4px;\">Diversified Fin'l</td>\n","                <td style=\"padding:2px 4px;\">$2.86</td>\n","                <td style=\"padding:2px 4px;\"></td>\n","            </tr>\n","                </tbody>\n","              </table>\n","\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F52C; Market Technicals & Squeeze Metrics</h2>\n","              <table cellpadding=\"0\" cellspacing=\"0\" border=\"1\" style=\"border-collapse:collapse; border-color:#dddddd; font-size:12px;\" width=\"100%\">\n","                <thead>\n","                  <tr bgcolor=\"#0284c7\" style=\"color:#ffffff; font-weight:bold; text-align:left;\">\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Ticker</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Company Name</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Industry</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Price</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Short Squeeze Score (SSS)</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">SSS WoW</th>\n","                  </tr>\n","                </thead>\n","                <tbody>\n","                  \n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">3715 TT</td>\n","                <td style=\"padding:2px 4px;\">DYNAMIC HOLD.</td>\n","                <td style=\"padding:2px 4px;\">Hardware & Equip</td>\n","                <td style=\"padding:2px 4px;\">$3.09</td>\n","                <td style=\"padding:2px 4px;\">77</td>\n","                <td style=\"padding:2px 4px;\"><span style=\"color:#16a34a; font-size:14px;\">+22</span></td>\n","            </tr>\n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">4935 JP</td>\n","                <td style=\"padding:2px 4px;\">LIBERTA CO</td>\n","                <td style=\"padding:2px 4px;\">Retailing</td>\n","                <td style=\"padding:2px 4px;\">$22.47</td>\n","                <td style=\"padding:2px 4px;\">75</td>\n","                <td style=\"padding:2px 4px;\"><span style=\"color:#16a34a; font-size:14px;\">+27</span></td>\n","            </tr>\n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">8358 TT</td>\n","                <td style=\"padding:2px 4px;\">CO-TECH DEV </td>\n","                <td style=\"padding:2px 4px;\">Hardware & Equip</td>\n","                <td style=\"padding:2px 4px;\">$3.79</td>\n","                <td style=\"padding:2px 4px;\">70</td>\n","                <td style=\"padding:2px 4px;\"><span style=\"color:#16a34a; font-size:14px;\">+6</span></td>\n","            </tr>\n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">2334 JP</td>\n","                <td style=\"padding:2px 4px;\">EOLE INC </td>\n","                <td style=\"padding:2px 4px;\">Intr Media & Srvcs</td>\n","                <td style=\"padding:2px 4px;\">$26.79</td>\n","                <td style=\"padding:2px 4px;\">66</td>\n","                <td style=\"padding:2px 4px;\"><span style=\"color:#16a34a; font-size:14px;\">+21</span></td>\n","            </tr>\n","            <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","                <td style=\"padding:2px 4px;\">1797 HK</td>\n","                <td style=\"padding:2px 4px;\">EAST BUY </td>\n","                <td style=\"padding:2px 4px;\">Food & Staples Retail</td>\n","                <td style=\"padding:2px 4px;\">$3.29</td>\n","                <td style=\"padding:2px 4px;\">66</td>\n","                <td style=\"padding:2px 4px;\"><span style=\"color:#16a34a; font-size:14px;\">+5</span></td>\n","            </tr>\n","                </tbody>\n","              </table>\n","\n","              <!-- Key Takeaways -->\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F4A1; Key Takeaways</h2>\n","              <ul style=\"padding-left:20px; color:#334155; font-size:14px; margin:0;\">\n","                <li>The Paramount-Skydance $80 billion merger shakes up the media landscape with big investments planned for the newly formed company.</li><li>Big names such as Walt Disney and McDonalds drive the Nasdaq to another record high despite remaining concerns surrounding the latest tariff announcements.</li><li>The retail industry sees mixed fortunes as high-street brands stare down the barrel of bankruptcy with online giants profiting as a result.</li><li>EquiLend Data & Analytics</li>\n","              </ul>\n","\n","            </td>\n","          </tr>\n","          <!-- Footer -->\n","          <tr>\n","            <td align=\"center\" style=\"padding:10px; font-size:12px; color:#64748b;\">\n","              Source: EquiLend Data &amp; Analytics\n","            </td>\n","          </tr>\n","        </table>\n","      </td>\n","    </tr>\n","  </table>\n","</body>\n","</html>\n","    "]},"metadata":{}}]},{"cell_type":"markdown","metadata":{"id":"a24913df"},"source":["## Add security note\n","\n","### Subtask:\n","Include a note about using App Passwords for security instead of the main Gmail password.\n"]},{"cell_type":"markdown","metadata":{"id":"1f1a079a"},"source":["**Reasoning**:\n","Add a comment next to the GMAIL_PASSWORD variable to explain the use of App Passwords for security.\n","\n"]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"82c0f957","executionInfo":{"status":"ok","timestamp":1754673698351,"user_tz":240,"elapsed":13,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"e28df59b-6b2e-42a7-8f2d-6d0f7521bdf9"},"source":["# --- Configuration ---\n","# The script will read all content from this file.\n","# Ensure it is in the same directory as the script.\n","CONTENT_DOC_PATH = 'daily_content.docx'\n","OUTPUT_HTML_PATH = f\"equilend_daily_digest_{datetime.now().strftime('%Y_%m_%d')}.html\"\n","\n","# --- Gmail Configuration ---\n","SENDER_EMAIL = 'your_gmail_address@gmail.com'  # Replace with your Gmail address\n","RECIPIENT_EMAILS = 'recipient1@example.com,recipient2@example.com' # Replace with recipient email addresses\n","# It is highly recommended to use a Gmail App Password instead of your main account password for security.\n","# You can generate an App Password in your Google Account security settings under \"2-Step Verification\".\n","GMAIL_PASSWORD = '.2389nice' # Replace with your Gmail password or App Password\n","\n","print(\"Configuration variables defined.\")"],"execution_count":34,"outputs":[{"output_type":"stream","name":"stdout","text":["Configuration variables defined.\n"]}]},{"cell_type":"markdown","metadata":{"id":"964b9188"},"source":["## Summary:\n","\n","### Data Analysis Key Findings\n","\n","*   The process successfully defined configuration variables for sending emails via Gmail, including sender email, recipient emails, and a placeholder for the Gmail password or App Password.\n","*   A Python function `send_gmail_email` was progressively developed to handle sending emails via Gmail's SMTP server.\n","*   The `send_gmail_email` function includes steps to establish a secure connection to `smtp.gmail.com` on port 465, log in to the sender's Gmail account with error handling for authentication failures, create an HTML email message using `MIMEText`, and send the email with basic error handling for recipient/sender refusal or data errors.\n","*   The `send_gmail_email` function was updated to ensure the SMTP connection is closed using a `finally` block, guaranteeing cleanup even if errors occur during the process.\n","*   The main execution block was modified to call the `send_gmail_email` function after the HTML content generation, passing the necessary configuration and generated HTML.\n","*   A security note was added to the code comments, recommending the use of Gmail App Passwords instead of the main account password for enhanced security and guiding the user on where to generate one.\n","*   During testing, the script successfully installed the required `python-docx` library but failed to execute fully due to a missing input file (`daily_content.docx`) and an error during the SMTP authentication step, indicating potential issues with the provided credentials or Gmail security settings.\n","\n","### Insights or Next Steps\n","\n","*   The current implementation requires the user to manually replace placeholder values for `SENDER_EMAIL`, `RECIPIENT_EMAILS`, and `GMAIL_PASSWORD`. Consider implementing a more secure method for handling credentials, such as using environment variables or a dedicated secrets management tool.\n","*   The script failed because the `daily_content.docx` file was not found and the Gmail authentication failed. The next step should involve providing the actual DOCX file and ensuring the correct Gmail credentials or App Password are used, along with verifying that less secure app access or App Passwords are correctly configured in the Gmail account settings.\n"]},{"cell_type":"markdown","metadata":{"id":"66905ecf"},"source":["# Task\n","Generate Python code to read the 'Hot Table' sheet from the \"fee_table.xlsx\" file and the 'Squeeze Table' sheet from the \"squeeze_table.xlsx\" file into pandas DataFrames. Then, generate HTML tables from these DataFrames and create an HTML body for a Gmail email containing these tables. Finally, provide Python code to automatically generate and send this email using the Gmail API."]},{"cell_type":"markdown","metadata":{"id":"688c6880"},"source":["## Summary:\n","\n","### Data Analysis Key Findings\n","\n","*   The 'Hot Table' from \"fee\\_table.xlsx\" and the 'Squeeze Table' from \"squeeze\\_table.xlsx\" were successfully read into pandas DataFrames.\n","*   HTML representations of both DataFrames were generated.\n","*   An HTML body containing both tables was constructed for an email.\n","*   The necessary components for sending an email via the Gmail API, including the recipient, sender, subject, and the prepared HTML body, were assembled.\n","\n","### Insights or Next Steps\n","\n","*   The generated HTML body and the assembled email components are ready to be used with the Gmail API for automated email sending.\n","*   Ensure the Gmail API credentials and setup are correctly configured to proceed with sending the email.\n"]},{"cell_type":"markdown","metadata":{"id":"fa464bca"},"source":["# Task\n","Generate Python code to read the 'Hot Table' sheet from the \"fee_table.xlsx\" file and the 'Squeeze Table' sheet from the \"squeeze_table.xlsx\" file into pandas DataFrames. Then, create an HTML table from each DataFrame, ensuring that the 'Ticker', 'Company Name', 'Fee1 WOW (bps)', and 'SSS WOW' columns are included and formatted as percentages. Finally, generate Python code to automatically create an email in Gmail with these two HTML tables in the body."]}],"metadata":{"colab":{"provenance":[]},"kernelspec":{"display_name":"Python 3","name":"python3"}},"nbformat":4,"nbformat_minor":0}