{"cells":[{"cell_type":"code","source":["import pandas as pd\n","from datetime import datetime\n","import re\n","import numpy as np\n","\n","# --- Configuration ---\n","# The output file will be named with today's date.\n","OUTPUT_HTML_PATH = f\"equilend_daily_digest_{datetime.now().strftime('%Y_%m_%d')}.html\"\n","\n","# --- 1. Hardcoded Content and Data ---\n","\n","def get_hardcoded_content():\n","    \"\"\"\n","    Returns all the text content for the digest.\n","    This section can be updated with the day's specific narrative content.\n","    \"\"\"\n","    content = {\n","        'market_notes': {\n","            'avg_fee_bps': '44.77',\n","            'avg_fee_change': -1.58,\n","            'avg_util_percent': '7.08',\n","            'avg_util_change': 0.87,\n","            'on_loan_value': '3.06T',\n","            'on_loan_value_change': 0.84,\n","            'lendable_value': '43.31T',\n","            'lendable_value_change': -0.02\n","        },\n","        'headlines': [\n","            {\n","                'title': 'US and EU Reach Trade Deal:',\n","                'description': 'The U.S. and the European Union reached a new framework agreement: most EU exports to the U.S. will now face a 15% tariff, half of the previously threatened 30–50%. It includes up to $600 billion in EU investment pledges in the U.S. Investors welcomed this as a trade war averted, pushing European and U.S. equity futures higher. Key sectors like pharmaceuticals, automotives and beer companies (e.g. Heineken) stand to benefit.',\n","                'data_insight': 'The positive trade news appears to be reducing hedging demand for sectors most exposed to international tariffs. Our data for the SPDR S&P Kensho New Economies Composite ETF (KOMP), which has significant exposure to global supply chains, shows a one-day decrease in shares on loan of over 1.2 million. A reduction in short interest for a globally-focused ETF like this may indicate increased investor optimism.'\n","            },\n","            {\n","                'title': 'Tesla and Samsung Announce $16.5B Deal:',\n","                'description': 'Elon Musk confirmed a $16.5 billion chip supply agreement with Samsung, which will manufacture Tesla’s AI6 processors at its new Texas fab. Samsung shares soared nearly 7%. This adds momentum in semiconductor competition with TSMC.',\n","                'data_insight': 'The global technology sector has seen a meteoric rise in 2025 with the influx of AI investment and semiconductor supply concerns following the tariff fallouts. This has led to our data seeing a significant upturn in short interest for tech names as borrowing costs have risen to 220 bps, up from between 80 and 90 bps before the April tariff announcements with the volume of shares on loan following a similar trend.'\n","            },\n","            {\n","                'title': 'Wall Street ‘Euphoria’ continues renewed meme-stock frenzy:',\n","                'description': 'A fresh wave of meme-stock mania hit Wall Street last week, with retail traders piling into names like GoPro, Krispy Kreme, and Beyond Meat. GoPro shares surged nearly 50% last week before easing, driven more by hype and social media buzz than fundamentals. Analysts warn the rally echoes the speculative frenzy of 2021, with signs of excessive euphoria, short squeezes, and call-option spikes raising concerns of an overheated market.',\n","                'data_insight': 'There has been significant borrowing interest seen in GoPro Inc. (GPRO) with the durable camera producers, one of the latest trending meme-stocks. Movements in the past week have been substantial, with On Loan Quantity up 150% to 19.9M shares and borrowing costs rising to 113 bps from only 18.'\n","            }\n","        ],\n","        'key_takeaways': [\n","            \"Resolutions in major trade disputes are fueling market rallies and reducing hedging demand in globally exposed sectors.\",\n","            \"Significant corporate deals, like the one between Tesla and Samsung, are adding momentum to the already hot semiconductor and tech sectors, though rising borrowing costs suggest some investor caution remains.\",\n","            \"A renewed meme-stock frenzy, exemplified by names like GoPro, indicates a high level of speculative activity in the market, with borrowing data showing a sharp increase in short-term demand for these volatile stocks.\"\n","        ]\n","    }\n","    return content\n","\n","def get_hardcoded_tables_html():\n","    \"\"\"\n","    Returns HTML for the two data tables using the hardcoded data.\n","    \"\"\"\n","    # Data for \"Hot & Getting Hotter\"\n","    ht_borrow_data = [\n","        {\"TICKER\": \"SLRX\", \"Company Name\": \"SALARIUS PHARMACEUTICALS\", \"Industry\": \"Biotechnology\", \"Price\": \"$0.71\", \"Fee\": \"87853.7\", \"Fee WoW (bps)\": \"6269.88\"},\n","        {\"TICKER\": \"NDRA\", \"Company Name\": \"ENDRA LIFE SCIENCES\", \"Industry\": \"Health Care Equip & Supp\", \"Price\": \"$6.50\", \"Fee\": \"77637.95\", \"Fee WoW (bps)\": \"12141.88\"},\n","        {\"TICKER\": \"CYCC\", \"Company Name\": \"CYCLACEL PHARMA\", \"Industry\": \"Biotechnology\", \"Price\": \"$10.76\", \"Fee\": \"67051.55\", \"Fee WoW (bps)\": \"13979.15\"},\n","        {\"TICKER\": \"NUWE\", \"Company Name\": \"NUWELLIS\", \"Industry\": \"Health Care Equip & Supp\", \"Price\": \"$14.33\", \"Fee\": \"55957.59\", \"Fee WoW (bps)\": \"44976.39\"},\n","        {\"TICKER\": \"HTOO\", \"Company Name\": \"FUSION FUEL GREEN\", \"Industry\": \"Capital Goods\", \"Price\": \"$6.71\", \"Fee\": \"52392.45\", \"Fee WoW (bps)\": \"50877.26\"},\n","    ]\n","\n","    # Data for \"Market Technicals & Squeeze Metrics\"\n","    squeeze_data = [\n","        {\"TICKER\": \"VOR\", \"Company Name\": \"VOR BIOPHARMA\", \"Industry\": \"Biotechnology\", \"Price\": \"$2.09\", \"SSS\": 89, \"SSS WoW\": \"1\"},\n","        {\"TICKER\": \"WOLF\", \"Company Name\": \"WOLFSPEED INC\", \"Industry\": \"Semiconductors & Equip\", \"Price\": \"$1.71\", \"SSS\": 85, \"SSS WoW\": \"57\"},\n","        {\"TICKER\": \"ABVX\", \"Company Name\": \"ABIVAX SPON\", \"Industry\": \"Biotechnology\", \"Price\": \"$68.58\", \"SSS\": 82, \"SSS WoW\": \"49\"},\n","        {\"TICKER\": \"SANA\", \"Company Name\": \"SANA BIOTECHNOLOGY\", \"Industry\": \"Biotechnology\", \"Price\": \"$5.14\", \"SSS\": 75, \"SSS WoW\": \"9\"},\n","        {\"TICKER\": \"AEHR\", \"Company Name\": \"AEHR TEST SYSTEMS\", \"Industry\": \"Semiconductors & Equip\", \"Price\": \"$20.10\", \"SSS\": 76, \"SSS WoW\": \"33\"},\n","    ]\n","\n","    def format_change(value, unit=' BPS'):\n","        try:\n","            cleaned_value = str(value).replace(',', '').strip()\n","            val = float(cleaned_value)\n","            color = '#16a34a' if val > 0 else '#dc2626'\n","            sign = '+' if val > 0 else ''\n","            return f'<span style=\"color:{color}; font-size:14px;\">{sign}{val:,.2f}{unit}</span>'\n","        except (ValueError, TypeError):\n","            return str(value).strip() if pd.notna(value) else ''\n","\n","    ht_borrow_html = \"\"\n","    for row in ht_borrow_data:\n","        fee_val = f\"{float(row.get('Fee', '0').replace(',', '')):,.2f}\"\n","        ht_borrow_html += f\"\"\"\n","        <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","            <td style=\"padding:4px 8px;\">{row.get(\"TICKER\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Company Name\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Industry\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Price\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{fee_val}</td>\n","            <td style=\"padding:4px 8px;\">{format_change(row.get(\"Fee WoW (bps)\"))}</td>\n","        </tr>\"\"\"\n","\n","    squeeze_html = \"\"\n","    for row in squeeze_data:\n","        squeeze_html += f\"\"\"\n","        <tr style=\"font-size:12px; background-color:#ffffff; text-align:left;\">\n","            <td style=\"padding:4px 8px;\">{row.get(\"TICKER\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Company Name\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Industry\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"Price\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{row.get(\"SSS\", \"\")}</td>\n","            <td style=\"padding:4px 8px;\">{format_change(row.get(\"SSS WoW\"), unit=\"\")}</td>\n","        </tr>\"\"\"\n","\n","    return ht_borrow_html, squeeze_html\n","\n","\n","# --- 2. HTML Generation ---\n","\n","def create_digest_html(content, table_html_tuple):\n","    \"\"\"\n","    Generates the final HTML for the digest by populating a template.\n","    \"\"\"\n","    if not content:\n","        return \"<h1>Error: Could not generate content.</h1>\"\n","\n","    ht_borrow_table, squeeze_table = table_html_tuple\n","\n","    def format_market_note_change(value):\n","        color = '#16a34a' if value > 0 else '#dc2626'\n","        sign = '+' if value > 0 else ''\n","        return f'<span style=\"color:{color}; font-size:14px;\">{sign}{value:.2f}%</span>'\n","\n","    market_notes = content.get('market_notes', {})\n","    avg_fee_bps = market_notes.get('avg_fee_bps', 'N/A')\n","    avg_fee_change = format_market_note_change(market_notes.get('avg_fee_change', 0))\n","    avg_util_percent = market_notes.get('avg_util_percent', 'N/A')\n","    avg_util_change = format_market_note_change(market_notes.get('avg_util_change', 0))\n","    on_loan_value = market_notes.get('on_loan_value', 'N/A')\n","    on_loan_value_change = format_market_note_change(market_notes.get('on_loan_value_change', 0))\n","    lendable_value = market_notes.get('lendable_value', 'N/A')\n","    lendable_value_change = format_market_note_change(market_notes.get('lendable_value_change', 0))\n","\n","    headlines_html = \"\"\n","    for headline in content.get('headlines', []):\n","        headlines_html += f\"\"\"\n","        <div style=\"margin-top:20px;\">\n","            <strong style=\"font-size:16px;\">{headline['title']}</strong>\n","            <p style=\"margin:5px 0 0; white-space: pre-wrap;\">{headline['description']}</p>\n","            <ul style=\"margin:10px 0 0; padding-left:20px; color:#334155; list-style-type: disc;\">\n","              <li><strong>What Our Data Shows:</strong> {headline['data_insight']}</li>\n","            </ul>\n","        </div>\n","        \"\"\"\n","\n","    takeaways_html = \"\".join([f\"<li>{item}</li>\" for item in content.get('key_takeaways', [])])\n","\n","    html_template = f\"\"\"\n","<!DOCTYPE html>\n","<html lang=\"en\">\n","<head>\n","  <meta charset=\"UTF-8\">\n","  <title>EquiLend D&A Daily Digest - July 28, 2025</title>\n","</head>\n","<body style=\"margin:0; padding:0; font-family: Arial, sans-serif; background-color:#f1f5f9;\">\n","  <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"#f1f5f9\">\n","    <tr>\n","      <td align=\"center\">\n","        <table width=\"800\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"#ffffff\" style=\"margin:20px 0; border-radius:4px; overflow:hidden;\">\n","          <!-- Header -->\n","          <tr>\n","            <td bgcolor=\"#0284c7\" style=\"padding:20px; text-align:center;\">\n","              <h1 style=\"margin:0; font-size:24px; color:#ffffff;\">EquiLend D&amp;A Daily Digest</h1>\n","              <p style=\"margin:5px 0 0; font-size:16px; color:#bae6fd;\">July 28, 2025</p>\n","            </td>\n","          </tr>\n","          <!-- Content -->\n","          <tr>\n","            <td style=\"padding:20px; color:#333333; font-size:14px; line-height:1.5;\">\n","\n","              <!-- Market Notes -->\n","              <h2 style=\"font-size:18px; margin-bottom:10px; color:#0284c7;\">&#x1F4BC; Market Notes</h2>\n","              <table width=\"100%\" cellpadding=\"5\" cellspacing=\"0\" border=\"0\" bgcolor=\"#f8fafc\" style=\"margin-bottom:20px;\">\n","                <tr>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Average Fee</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      {avg_fee_bps} bps {avg_fee_change}\n","                    </p>\n","                  </td>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Average Utilization</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      {avg_util_percent}% {avg_util_change}\n","                    </p>\n","                  </td>\n","                </tr>\n","                <tr>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">On Loan Value</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      ${on_loan_value} {on_loan_value_change}\n","                    </p>\n","                  </td>\n","                  <td align=\"center\" width=\"50%\">\n","                    <p style=\"margin:0; font-size:12px; color:#64748b;\">Total Lendable Value</p>\n","                    <p style=\"margin:5px 0 0; font-size:18px; font-weight:bold; color:#334155;\">\n","                      ${lendable_value} {lendable_value_change}\n","                    </p>\n","                  </td>\n","                </tr>\n","              </table>\n","\n","              <!-- Headlines -->\n","              <h2 style=\"font-size:18px; margin-bottom:10px; color:#0284c7;\">&#x1F4F0; Major Headlines and What Our Data Shows</h2>\n","              {headlines_html}\n","\n","              <!-- Tables Section -->\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F525; Hot & Getting Hotter</h2>\n","              <table cellpadding=\"0\" cellspacing=\"0\" border=\"1\" style=\"border-collapse:collapse; margin-bottom:20px; border-color:#dddddd; font-size:12px;\" width=\"100%\">\n","                <thead>\n","                  <tr bgcolor=\"#0284c7\" style=\"color:#ffffff; font-weight:bold; text-align:left;\">\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Ticker</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Company Name</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Industry</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Price</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Fee (BPS)</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Fee WoW (bps)</th>\n","                  </tr>\n","                </thead>\n","                <tbody>\n","                  {ht_borrow_table}\n","                </tbody>\n","              </table>\n","\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F52C; Market Technicals & Squeeze Metrics</h2>\n","              <table cellpadding=\"0\" cellspacing=\"0\" border=\"1\" style=\"border-collapse:collapse; border-color:#dddddd; font-size:12px;\" width=\"100%\">\n","                <thead>\n","                  <tr bgcolor=\"#0284c7\" style=\"color:#ffffff; font-weight:bold; text-align:left;\">\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Ticker</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Company Name</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Industry</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">Price</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">SSS</th>\n","                    <th style=\"padding:5px 8px; white-space: nowrap;\">SSS Week Diff</th>\n","                  </tr>\n","                </thead>\n","                <tbody>\n","                  {squeeze_table}\n","                </tbody>\n","              </table>\n","\n","              <!-- Key Takeaways -->\n","              <h2 style=\"font-size:18px; margin:20px 0 10px; color:#0284c7;\">&#x1F4A1; Key Takeaways</h2>\n","              <ul style=\"padding-left:20px; color:#334155; font-size:14px; margin:0;\">\n","                {takeaways_html}\n","              </ul>\n","\n","            </td>\n","          </tr>\n","          <!-- Footer -->\n","          <tr>\n","            <td align=\"center\" style=\"padding:10px; font-size:12px; color:#64748b;\">\n","              Source: EquiLend Data &amp; Analytics\n","            </td>\n","          </tr>\n","        </table>\n","      </td>\n","    </tr>\n","  </table>\n","</body>\n","</html>\n","    \"\"\"\n","    return html_template\n","\n","# --- Main Execution ---\n","if __name__ == \"__main__\":\n","    print(\"Starting daily digest generation...\")\n","\n","    # 1. Get hardcoded content\n","    print(\"Loading hardcoded content...\")\n","    hardcoded_content = get_hardcoded_content()\n","\n","    # 2. Get HTML for the hardcoded tables\n","    print(\"Generating tables from hardcoded data...\")\n","    table_html = get_hardcoded_tables_html()\n","\n","    # 3. Generate the final HTML file\n","    print(\"Generating final HTML digest...\")\n","    final_html = create_digest_html(hardcoded_content, table_html)\n","\n","    # 4. Save the HTML to a file\n","    with open(OUTPUT_HTML_PATH, 'w', encoding='utf-8') as f:\n","        f.write(final_html)\n","\n","    print(f\"\\nSuccessfully generated digest: {OUTPUT_HTML_PATH}\")\n","    print(\"This version is fully hardcoded and does not depend on external files.\")"],"outputs":[{"output_type":"stream","name":"stdout","text":["Starting daily digest generation...\n","Loading hardcoded content...\n","Generating tables from hardcoded data...\n","Generating final HTML digest...\n","\n","Successfully generated digest: equilend_daily_digest_2025_07_28.html\n","This version is fully hardcoded and does not depend on external files.\n"]}],"execution_count":2,"metadata":{"id":"DXpFS1qqD9X5","executionInfo":{"status":"ok","timestamp":1753706668844,"user_tz":240,"elapsed":38,"user":{"displayName":"Bob Sheehan","userId":"08159093702253523584"}},"outputId":"9a45e28b-0aab-434c-c4b1-c6a79be8a1cc","colab":{"base_uri":"https://localhost:8080/"}}}],"metadata":{"colab":{"provenance":[]},"kernelspec":{"display_name":"Python 3","name":"python3"}},"nbformat":4,"nbformat_minor":0}